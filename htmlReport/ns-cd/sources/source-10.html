<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > CustomerController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.controller</a>
</div>

<h1>Coverage Summary for Class: CustomerController (org.thingsboard.server.controller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">CustomerController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.controller;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.JsonNode;
&nbsp;import com.fasterxml.jackson.databind.node.ObjectNode;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.media.ArraySchema;
&nbsp;import io.swagger.v3.oas.annotations.media.Schema;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.security.access.prepost.PreAuthorize;
&nbsp;import org.springframework.web.bind.annotation.GetMapping;
&nbsp;import org.springframework.web.bind.annotation.PathVariable;
&nbsp;import org.springframework.web.bind.annotation.RequestBody;
&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestMethod;
&nbsp;import org.springframework.web.bind.annotation.RequestParam;
&nbsp;import org.springframework.web.bind.annotation.ResponseBody;
&nbsp;import org.springframework.web.bind.annotation.ResponseStatus;
&nbsp;import org.springframework.web.bind.annotation.RestController;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.Customer;
&nbsp;import org.thingsboard.server.common.data.NameConflictStrategy;
&nbsp;import org.thingsboard.server.common.data.NameConflictPolicy;
&nbsp;import org.thingsboard.server.common.data.UniquifyStrategy;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardException;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.page.PageData;
&nbsp;import org.thingsboard.server.common.data.page.PageLink;
&nbsp;import org.thingsboard.server.config.annotations.ApiOperation;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.entitiy.customer.TbCustomerService;
&nbsp;import org.thingsboard.server.service.security.permission.Operation;
&nbsp;import org.thingsboard.server.service.security.permission.Resource;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.UUID;
&nbsp;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.CUSTOMER_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.CUSTOMER_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.CUSTOMER_TEXT_SEARCH_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.HOME_DASHBOARD;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.NAME_CONFLICT_POLICY_DESC;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.UNIQUIFY_SEPARATOR_DESC;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_DATA_PARAMETERS;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_NUMBER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_SIZE_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_ORDER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_PROPERTY_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.UNIQUIFY_STRATEGY_DESC;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.UUID_WIKI_LINK;
&nbsp;
&nbsp;@RestController
&nbsp;@TbCoreComponent
&nbsp;@RequiredArgsConstructor
&nbsp;@RequestMapping(&quot;/api&quot;)
&nbsp;public class CustomerController extends BaseController {
&nbsp;
&nbsp;    private final TbCustomerService tbCustomerService;
&nbsp;
&nbsp;    public static final String IS_PUBLIC = &quot;isPublic&quot;;
&nbsp;    public static final String CUSTOMER_SECURITY_CHECK = &quot;If the user has the authority of &#39;Tenant Administrator&#39;, the server checks that the customer is owned by the same tenant. &quot; +
&nbsp;            &quot;If the user has the authority of &#39;Customer User&#39;, the server checks that the user belongs to the customer.&quot;;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Customer (getCustomerById)&quot;,
&nbsp;            notes = &quot;Get the Customer object based on the provided Customer Id. &quot;
&nbsp;                    + CUSTOMER_SECURITY_CHECK + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customer/{customerId}&quot;, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public Customer getCustomerById(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.READ);</b>
<b class="nc">&nbsp;        checkDashboardInfo(customer.getAdditionalInfo(), HOME_DASHBOARD);</b>
<b class="nc">&nbsp;        return customer;</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get short Customer info (getShortCustomerInfoById)&quot;,
&nbsp;            notes = &quot;Get the short customer object that contains only the title and &#39;isPublic&#39; flag. &quot;
&nbsp;                    + CUSTOMER_SECURITY_CHECK + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customer/{customerId}/shortInfo&quot;, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public JsonNode getShortCustomerInfoById(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.READ);</b>
<b class="nc">&nbsp;        ObjectNode infoObject = JacksonUtil.newObjectNode();</b>
<b class="nc">&nbsp;        infoObject.put(&quot;title&quot;, customer.getTitle());</b>
<b class="nc">&nbsp;        infoObject.put(IS_PUBLIC, customer.isPublic());</b>
<b class="nc">&nbsp;        return infoObject;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Customer Title (getCustomerTitleById)&quot;,
&nbsp;            notes = &quot;Get the title of the customer. &quot;
&nbsp;                    + CUSTOMER_SECURITY_CHECK + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customer/{customerId}/title&quot;, method = RequestMethod.GET, produces = &quot;application/text&quot;)
&nbsp;    @ResponseBody
&nbsp;    public String getCustomerTitleById(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.READ);</b>
<b class="nc">&nbsp;        return customer.getTitle();</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Create or update Customer (saveCustomer)&quot;,
&nbsp;            notes = &quot;Creates or Updates the Customer. When creating customer, platform generates Customer Id as &quot; + UUID_WIKI_LINK +
&nbsp;                    &quot;The newly created Customer Id will be present in the response. &quot; +
&nbsp;                    &quot;Specify existing Customer Id to update the Customer. &quot; +
&nbsp;                    &quot;Referencing non-existing Customer Id will cause &#39;Not Found&#39; error.&quot; +
&nbsp;                    &quot;Remove &#39;id&#39;, &#39;tenantId&#39; from the request body example (below) to create new Customer entity. &quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customer&quot;, method = RequestMethod.POST)
&nbsp;    @ResponseBody
&nbsp;    public Customer saveCustomer(@io.swagger.v3.oas.annotations.parameters.RequestBody(description = &quot;A JSON value representing the customer.&quot;) @RequestBody Customer customer,
&nbsp;                                 @Parameter(description = NAME_CONFLICT_POLICY_DESC)
&nbsp;                                 @RequestParam(name = &quot;nameConflictPolicy&quot;, defaultValue = &quot;FAIL&quot;) NameConflictPolicy nameConflictPolicy,
&nbsp;                                 @Parameter(description = UNIQUIFY_SEPARATOR_DESC)
&nbsp;                                 @RequestParam(name = &quot;uniquifySeparator&quot;, defaultValue = &quot;_&quot;) String uniquifySeparator,
&nbsp;                                 @Parameter(description = UNIQUIFY_STRATEGY_DESC)
&nbsp;                                 @RequestParam(name = &quot;uniquifyStrategy&quot;, defaultValue = &quot;RANDOM&quot;) UniquifyStrategy uniquifyStrategy) throws Exception {
<b class="nc">&nbsp;        customer.setTenantId(getTenantId());</b>
<b class="nc">&nbsp;        checkEntity(customer.getId(), customer, Resource.CUSTOMER);</b>
<b class="nc">&nbsp;        return tbCustomerService.save(customer, new NameConflictStrategy(nameConflictPolicy, uniquifySeparator, uniquifyStrategy), getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete Customer (deleteCustomer)&quot;,
&nbsp;            notes = &quot;Deletes the Customer and all customer Users. &quot; +
&nbsp;                    &quot;All assigned Dashboards, Assets, Devices, etc. will be unassigned but not deleted. &quot; +
&nbsp;                    &quot;Referencing non-existing Customer Id will cause an error.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customer/{customerId}&quot;, method = RequestMethod.DELETE)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public void deleteCustomer(@Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;                               @PathVariable(CUSTOMER_ID) String strCustomerId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.DELETE);</b>
<b class="nc">&nbsp;        tbCustomerService.delete(customer, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Tenant Customers (getCustomers)&quot;,
&nbsp;            notes = &quot;Returns a page of customers owned by tenant. &quot; +
&nbsp;                    PAGE_DATA_PARAMETERS + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/customers&quot;, params = {&quot;pageSize&quot;, &quot;page&quot;}, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public PageData&lt;Customer&gt; getCustomers(
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = CUSTOMER_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;title&quot;, &quot;email&quot;, &quot;country&quot;, &quot;city&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        return checkNotNull(customerService.findCustomersByTenantId(tenantId, pageLink));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Tenant Customer by Customer title (getTenantCustomer)&quot;,
&nbsp;            notes = &quot;Get the Customer using Customer Title. &quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/tenant/customers&quot;, params = {&quot;customerTitle&quot;}, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public Customer getTenantCustomer(
&nbsp;            @Parameter(description = &quot;A string value representing the Customer title.&quot;)
&nbsp;            @RequestParam String customerTitle) throws ThingsboardException {
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        return checkNotNull(customerService.findCustomerByTenantIdAndTitle(tenantId, customerTitle), &quot;Customer with title [&quot; + customerTitle + &quot;] is not found&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get customers by Customer Ids (getCustomersByIds)&quot;,
&nbsp;            notes = &quot;Returns a list of Customer objects based on the provided ids.&quot; +
&nbsp;                    TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/customers&quot;, params = {&quot;customerIds&quot;})
&nbsp;    public List&lt;Customer&gt; getCustomersByIds(
&nbsp;            @Parameter(description = &quot;A list of customer ids, separated by comma &#39;,&#39;&quot;, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;)), required = true)
&nbsp;            @RequestParam(&quot;customerIds&quot;) Set&lt;UUID&gt; customerUUIDs) throws ThingsboardException {
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        List&lt;CustomerId&gt; customerIds = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (UUID customerUUID : customerUUIDs) {</b>
<b class="nc">&nbsp;            customerIds.add(new CustomerId(customerUUID));</b>
&nbsp;        }
<b class="nc">&nbsp;        return customerService.findCustomersByTenantIdAndIds(tenantId, customerIds);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
