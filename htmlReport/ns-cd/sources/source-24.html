<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > NotificationController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.controller</a>
</div>

<h1>Coverage Summary for Class: NotificationController (org.thingsboard.server.controller)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">NotificationController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/117)
  </span>
</td>
</tr>
  <tr>
    <td class="name">NotificationController$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/20)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/118)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.controller;
&nbsp;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.media.Schema;
&nbsp;import jakarta.servlet.http.HttpServletRequest;
&nbsp;import jakarta.validation.Valid;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.security.access.prepost.PreAuthorize;
&nbsp;import org.springframework.security.core.annotation.AuthenticationPrincipal;
&nbsp;import org.springframework.web.bind.annotation.DeleteMapping;
&nbsp;import org.springframework.web.bind.annotation.GetMapping;
&nbsp;import org.springframework.web.bind.annotation.PathVariable;
&nbsp;import org.springframework.web.bind.annotation.PostMapping;
&nbsp;import org.springframework.web.bind.annotation.PutMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestBody;
&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestParam;
&nbsp;import org.springframework.web.bind.annotation.RestController;
&nbsp;import org.thingsboard.rule.engine.api.NotificationCenter;
&nbsp;import org.thingsboard.server.common.data.EntityType;
&nbsp;import org.thingsboard.server.common.data.User;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardException;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.EntityId;
&nbsp;import org.thingsboard.server.common.data.id.NotificationId;
&nbsp;import org.thingsboard.server.common.data.id.NotificationRequestId;
&nbsp;import org.thingsboard.server.common.data.id.NotificationTargetId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.notification.Notification;
&nbsp;import org.thingsboard.server.common.data.notification.NotificationDeliveryMethod;
&nbsp;import org.thingsboard.server.common.data.notification.NotificationRequest;
&nbsp;import org.thingsboard.server.common.data.notification.NotificationRequestInfo;
&nbsp;import org.thingsboard.server.common.data.notification.NotificationRequestPreview;
&nbsp;import org.thingsboard.server.common.data.notification.NotificationType;
&nbsp;import org.thingsboard.server.common.data.notification.info.EntitiesLimitIncreaseRequestNotificationInfo;
&nbsp;import org.thingsboard.server.common.data.notification.info.NotificationInfo;
&nbsp;import org.thingsboard.server.common.data.notification.settings.NotificationSettings;
&nbsp;import org.thingsboard.server.common.data.notification.settings.UserNotificationSettings;
&nbsp;import org.thingsboard.server.common.data.notification.targets.MicrosoftTeamsNotificationTargetConfig;
&nbsp;import org.thingsboard.server.common.data.notification.targets.NotificationRecipient;
&nbsp;import org.thingsboard.server.common.data.notification.targets.NotificationTarget;
&nbsp;import org.thingsboard.server.common.data.notification.targets.NotificationTargetType;
&nbsp;import org.thingsboard.server.common.data.notification.targets.platform.PlatformUsersNotificationTargetConfig;
&nbsp;import org.thingsboard.server.common.data.notification.targets.platform.UsersFilterType;
&nbsp;import org.thingsboard.server.common.data.notification.targets.slack.SlackConversation;
&nbsp;import org.thingsboard.server.common.data.notification.targets.slack.SlackNotificationTargetConfig;
&nbsp;import org.thingsboard.server.common.data.notification.template.DeliveryMethodNotificationTemplate;
&nbsp;import org.thingsboard.server.common.data.notification.template.NotificationTemplate;
&nbsp;import org.thingsboard.server.common.data.page.PageData;
&nbsp;import org.thingsboard.server.common.data.page.PageLink;
&nbsp;import org.thingsboard.server.common.data.page.SortOrder;
&nbsp;import org.thingsboard.server.config.annotations.ApiOperation;
&nbsp;import org.thingsboard.server.dao.notification.NotificationRequestService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationSettingsService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationTargetService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationTemplateService;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.notification.NotificationProcessingContext;
&nbsp;import org.thingsboard.server.service.security.model.SecurityUser;
&nbsp;import org.thingsboard.server.service.security.permission.Operation;
&nbsp;import org.thingsboard.server.service.security.permission.Resource;
&nbsp;import org.thingsboard.server.service.security.system.SystemSecurityService;
&nbsp;
&nbsp;import java.util.Comparator;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.LinkedHashMap;
&nbsp;import java.util.LinkedHashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Optional;
&nbsp;import java.util.Set;
&nbsp;import java.util.UUID;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.AVAILABLE_FOR_ANY_AUTHORIZED_USER;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.MARKDOWN_CODE_BLOCK_END;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.MARKDOWN_CODE_BLOCK_START;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.NEW_LINE;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_DATA_PARAMETERS;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_NUMBER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_SIZE_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_ORDER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_PROPERTY_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.service.security.permission.Resource.NOTIFICATION;
&nbsp;
&nbsp;@RestController
&nbsp;@TbCoreComponent
&nbsp;@RequestMapping(&quot;/api&quot;)
&nbsp;@RequiredArgsConstructor
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;public class NotificationController extends BaseController {
&nbsp;
&nbsp;    private final NotificationService notificationService;
&nbsp;    private final NotificationRequestService notificationRequestService;
&nbsp;    private final NotificationTemplateService notificationTemplateService;
&nbsp;    private final NotificationTargetService notificationTargetService;
&nbsp;    private final NotificationCenter notificationCenter;
&nbsp;    private final NotificationSettingsService notificationSettingsService;
&nbsp;    private final SystemSecurityService systemSecurityService;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get notifications (getNotifications)&quot;,
&nbsp;            notes = &quot;Returns the page of notifications for current user.&quot; + NEW_LINE +
&nbsp;                    PAGE_DATA_PARAMETERS +
&nbsp;                    AVAILABLE_FOR_ANY_AUTHORIZED_USER + NEW_LINE +
&nbsp;                    &quot;**WebSocket API**:\n\n&quot; +
&nbsp;                    &quot;There are 2 types of subscriptions: one for unread notifications count, another for unread notifications themselves.\n\n&quot; +
&nbsp;                    &quot;The URI for opening WS session for notifications: `/api/ws/plugins/notifications`.\n\n&quot; +
&nbsp;                    &quot;Subscription command for unread notifications count:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;unreadCountSubCmd\&quot;: {\n    \&quot;cmdId\&quot;: 1234\n  }\n}\n```\n&quot; +
&nbsp;                    &quot;To subscribe for latest unread notifications:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;unreadSubCmd\&quot;: {\n    \&quot;cmdId\&quot;: 1234,\n    \&quot;limit\&quot;: 10\n  }\n}\n```\n&quot; +
&nbsp;                    &quot;To unsubscribe from any subscription:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;unsubCmd\&quot;: {\n    \&quot;cmdId\&quot;: 1234\n  }\n}\n```\n&quot; +
&nbsp;                    &quot;To mark certain notifications as read, use following command:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;markAsReadCmd\&quot;: {\n    \&quot;cmdId\&quot;: 1234,\n    \&quot;notifications\&quot;: [\n      \&quot;6f860330-7fc2-11ed-b855-7dd3b7d2faa9\&quot;,\n      \&quot;5b6dfee0-8d0d-11ed-b61f-35a57b03dade\&quot;\n    ]\n  }\n}\n\n```\n&quot; +
&nbsp;                    &quot;To mark all notifications as read:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;markAllAsReadCmd\&quot;: {\n    \&quot;cmdId\&quot;: 1234\n  }\n}\n```\n&quot; +
&nbsp;                    &quot;\n\n&quot; +
&nbsp;                    &quot;Update structure for unread **notifications count subscription**:\n&quot; +
&nbsp;                    &quot;```\n{\n  \&quot;cmdId\&quot;: 1234,\n  \&quot;totalUnreadCount\&quot;: 55\n}\n```\n&quot; +
&nbsp;                    &quot;For **notifications subscription**:\n&quot; +
&nbsp;                    &quot;- full update of latest unread notifications:\n&quot; +
&nbsp;                    &quot;```\n{\n&quot; +
&nbsp;                    &quot;  \&quot;cmdId\&quot;: 1234,\n&quot; +
&nbsp;                    &quot;  \&quot;notifications\&quot;: [\n&quot; +
&nbsp;                    &quot;    {\n&quot; +
&nbsp;                    &quot;      \&quot;id\&quot;: {\n&quot; +
&nbsp;                    &quot;        \&quot;entityType\&quot;: \&quot;NOTIFICATION\&quot;,\n&quot; +
&nbsp;                    &quot;        \&quot;id\&quot;: \&quot;6f860330-7fc2-11ed-b855-7dd3b7d2faa9\&quot;\n&quot; +
&nbsp;                    &quot;      },\n&quot; +
&nbsp;                    &quot;      ...\n&quot; +
&nbsp;                    &quot;    }\n&quot; +
&nbsp;                    &quot;  ],\n&quot; +
&nbsp;                    &quot;  \&quot;totalUnreadCount\&quot;: 1\n&quot; +
&nbsp;                    &quot;}\n```\n&quot; +
&nbsp;                    &quot;- when new notification arrives or shown notification is updated:\n&quot; +
&nbsp;                    &quot;```\n{\n&quot; +
&nbsp;                    &quot;  \&quot;cmdId\&quot;: 1234,\n&quot; +
&nbsp;                    &quot;  \&quot;update\&quot;: {\n&quot; +
&nbsp;                    &quot;    \&quot;id\&quot;: {\n&quot; +
&nbsp;                    &quot;      \&quot;entityType\&quot;: \&quot;NOTIFICATION\&quot;,\n&quot; +
&nbsp;                    &quot;      \&quot;id\&quot;: \&quot;6f860330-7fc2-11ed-b855-7dd3b7d2faa9\&quot;\n&quot; +
&nbsp;                    &quot;    },\n&quot; +
&nbsp;                    &quot;    # updated notification info, text, subject etc.\n&quot; +
&nbsp;                    &quot;    ...\n&quot; +
&nbsp;                    &quot;  },\n&quot; +
&nbsp;                    &quot;  \&quot;totalUnreadCount\&quot;: 2\n&quot; +
&nbsp;                    &quot;}\n```\n&quot; +
&nbsp;                    &quot;- when unread notifications count changes:\n&quot; +
&nbsp;                    &quot;```\n{\n&quot; +
&nbsp;                    &quot;  \&quot;cmdId\&quot;: 1234,\n&quot; +
&nbsp;                    &quot;  \&quot;totalUnreadCount\&quot;: 5\n&quot; +
&nbsp;                    &quot;}\n```&quot;)
&nbsp;    @GetMapping(&quot;/notifications&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public PageData&lt;Notification&gt; getNotifications(@Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;                                                   @RequestParam int pageSize,
&nbsp;                                                   @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;                                                   @RequestParam int page,
&nbsp;                                                   @Parameter(description = &quot;Case-insensitive &#39;substring&#39; filter based on notification subject or text&quot;)
&nbsp;                                                   @RequestParam(required = false) String textSearch,
&nbsp;                                                   @Parameter(description = SORT_PROPERTY_DESCRIPTION)
&nbsp;                                                   @RequestParam(required = false) String sortProperty,
&nbsp;                                                   @Parameter(description = SORT_ORDER_DESCRIPTION)
&nbsp;                                                   @RequestParam(required = false) String sortOrder,
&nbsp;                                                   @Parameter(description = &quot;To search for unread notifications only&quot;)
&nbsp;                                                   @RequestParam(defaultValue = &quot;false&quot;) boolean unreadOnly,
&nbsp;                                                   @Parameter(description = &quot;Delivery method&quot;, schema = @Schema(allowableValues = {&quot;WEB&quot;, &quot;MOBILE_APP&quot;}))
&nbsp;                                                   @RequestParam(defaultValue = &quot;WEB&quot;) NotificationDeliveryMethod deliveryMethod,
&nbsp;                                                   @AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
&nbsp;        // no permissions
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        return notificationService.findNotificationsByRecipientIdAndReadStatus(user.getTenantId(), deliveryMethod, user.getId(), unreadOnly, pageLink);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get unread notifications count (getUnreadNotificationsCount)&quot;,
&nbsp;            notes = &quot;Returns unread notifications count for chosen delivery method.&quot; +
&nbsp;                    AVAILABLE_FOR_ANY_AUTHORIZED_USER)
&nbsp;    @GetMapping(&quot;/notifications/unread/count&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public Integer getUnreadNotificationsCount(@Parameter(description = &quot;Delivery method&quot;, schema = @Schema(allowableValues = {&quot;WEB&quot;, &quot;MOBILE_APP&quot;}))
&nbsp;                                               @RequestParam(defaultValue = &quot;MOBILE_APP&quot;) NotificationDeliveryMethod deliveryMethod,
&nbsp;                                               @AuthenticationPrincipal SecurityUser user) {
<b class="nc">&nbsp;        return notificationService.countUnreadNotificationsByRecipientId(user.getTenantId(), deliveryMethod, user.getId());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Mark notification as read (markNotificationAsRead)&quot;,
&nbsp;            notes = &quot;Marks notification as read by its id.&quot; +
&nbsp;                    AVAILABLE_FOR_ANY_AUTHORIZED_USER)
&nbsp;    @PutMapping(&quot;/notification/{id}/read&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public void markNotificationAsRead(@PathVariable UUID id,
&nbsp;                                       @AuthenticationPrincipal SecurityUser user) {
&nbsp;        // no permissions
<b class="nc">&nbsp;        NotificationId notificationId = new NotificationId(id);</b>
<b class="nc">&nbsp;        notificationCenter.markNotificationAsRead(user.getTenantId(), user.getId(), notificationId);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Mark all notifications as read (markAllNotificationsAsRead)&quot;,
&nbsp;            notes = &quot;Marks all unread notifications as read.&quot; +
&nbsp;                    AVAILABLE_FOR_ANY_AUTHORIZED_USER)
&nbsp;    @PutMapping(&quot;/notifications/read&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public void markAllNotificationsAsRead(@Parameter(description = &quot;Delivery method&quot;, schema = @Schema(allowableValues = {&quot;WEB&quot;, &quot;MOBILE_APP&quot;}))
&nbsp;                                           @RequestParam(defaultValue = &quot;WEB&quot;) NotificationDeliveryMethod deliveryMethod,
&nbsp;                                           @AuthenticationPrincipal SecurityUser user) {
&nbsp;        // no permissions
<b class="nc">&nbsp;        notificationCenter.markAllNotificationsAsRead(user.getTenantId(), deliveryMethod, user.getId());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete notification (deleteNotification)&quot;,
&nbsp;            notes = &quot;Deletes notification by its id.&quot; +
&nbsp;                    AVAILABLE_FOR_ANY_AUTHORIZED_USER)
&nbsp;    @DeleteMapping(&quot;/notification/{id}&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public void deleteNotification(@PathVariable UUID id,
&nbsp;                                   @AuthenticationPrincipal SecurityUser user) {
&nbsp;        // no permissions
<b class="nc">&nbsp;        NotificationId notificationId = new NotificationId(id);</b>
<b class="nc">&nbsp;        notificationCenter.deleteNotification(user.getTenantId(), user.getId(), notificationId);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Create notification request (createNotificationRequest)&quot;,
&nbsp;            notes = &quot;Processes notification request.\n&quot; +
&nbsp;                    &quot;Mandatory request properties are `targets` (list of targets ids to send notification to), &quot; +
&nbsp;                    &quot;and either `templateId` (existing notification template id) or `template` (to send notification without saving the template).\n&quot; +
&nbsp;                    &quot;Optionally, you can set `sendingDelayInSec` inside the `additionalConfig` field to schedule the notification.&quot; + NEW_LINE +
&nbsp;                    &quot;For each enabled delivery method in the notification template, there must be a target in the `targets` list that supports this delivery method: &quot; +
&nbsp;                    &quot;if you chose `WEB`, `EMAIL` or `SMS` - there must be at least one target in `targets` of `PLATFORM_USERS` type.\n&quot; +
&nbsp;                    &quot;For `SLACK` delivery method - you need to chose at least one `SLACK` notification target.&quot; + NEW_LINE +
&nbsp;                    &quot;Notification request object with `PROCESSING` status will be returned immediately, &quot; +
&nbsp;                    &quot;and the notification sending itself is done asynchronously. After all notifications are sent, &quot; +
&nbsp;                    &quot;the `status` of the request becomes `SENT`. Use `getNotificationRequestById` to see &quot; +
&nbsp;                    &quot;the notification request processing status and some sending stats. &quot; + NEW_LINE +
&nbsp;                    &quot;Here is an example of notification request to one target using saved template:\n&quot; +
&nbsp;                    MARKDOWN_CODE_BLOCK_START +
&nbsp;                    &quot;{\n&quot; +
&nbsp;                    &quot;  \&quot;templateId\&quot;: {\n&quot; +
&nbsp;                    &quot;    \&quot;entityType\&quot;: \&quot;NOTIFICATION_TEMPLATE\&quot;,\n&quot; +
&nbsp;                    &quot;    \&quot;id\&quot;: \&quot;6dbc3670-e4dd-11ed-9401-dbcc5dff78be\&quot;\n&quot; +
&nbsp;                    &quot;  },\n&quot; +
&nbsp;                    &quot;  \&quot;targets\&quot;: [\n&quot; +
&nbsp;                    &quot;    \&quot;320e3ed0-d785-11ed-a06c-21dd57dd88ca\&quot;\n&quot; +
&nbsp;                    &quot;  ],\n&quot; +
&nbsp;                    &quot;  \&quot;additionalConfig\&quot;: {\n&quot; +
&nbsp;                    &quot;    \&quot;sendingDelayInSec\&quot;: 0\n&quot; +
&nbsp;                    &quot;  }\n&quot; +
&nbsp;                    &quot;}&quot; +
&nbsp;                    MARKDOWN_CODE_BLOCK_END +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH
&nbsp;    )
&nbsp;    @PostMapping(&quot;/notification/request&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public NotificationRequest createNotificationRequest(@RequestBody @Valid NotificationRequest notificationRequest,
&nbsp;                                                         @AuthenticationPrincipal SecurityUser user) throws Exception {
<b class="nc">&nbsp;        if (notificationRequest.getId() != null) {</b>
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;Notification request cannot be updated. You may only cancel/delete it&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        notificationRequest.setTenantId(user.getTenantId());</b>
<b class="nc">&nbsp;        checkEntity(notificationRequest.getId(), notificationRequest, NOTIFICATION);</b>
<b class="nc">&nbsp;        List&lt;NotificationTargetId&gt; targets = notificationRequest.getTargets().stream()</b>
<b class="nc">&nbsp;                .map(NotificationTargetId::new)</b>
<b class="nc">&nbsp;                .toList();</b>
<b class="nc">&nbsp;        for (NotificationTargetId targetId : targets) {</b>
<b class="nc">&nbsp;            checkNotificationTargetId(targetId, Operation.READ);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        notificationRequest.setOriginatorEntityId(user.getId());</b>
<b class="nc">&nbsp;        notificationRequest.setInfo(null);</b>
<b class="nc">&nbsp;        notificationRequest.setRuleId(null);</b>
<b class="nc">&nbsp;        notificationRequest.setStatus(null);</b>
<b class="nc">&nbsp;        notificationRequest.setStats(null);</b>
&nbsp;
<b class="nc">&nbsp;        return doSaveAndLog(EntityType.NOTIFICATION_REQUEST, notificationRequest, (tenantId, request) -&gt; notificationCenter.processNotificationRequest(tenantId, request, null));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Send entity limit increase request notification to System administrators (sendEntitiesLimitIncreaseRequest)&quot;,
&nbsp;                  notes = &quot;Send entity limit increase request notification by Tenant Administrator to System administrators.&quot; +
&nbsp;                  TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PostMapping(&quot;/notification/entitiesLimitIncreaseRequest/{entityType}&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public void sendEntitiesLimitIncreaseRequest(@Parameter(description = &quot;Entity type&quot;, required = true, schema = @Schema(allowableValues = {&quot;DEVICE&quot;, &quot;ASSET&quot;, &quot;CUSTOMER&quot;, &quot;USER&quot;, &quot;DASHBOARD&quot;, &quot;RULE_CHAIN&quot;, &quot;EDGE&quot;}))
&nbsp;                                                 @PathVariable(&quot;entityType&quot;) String strEntityType,
&nbsp;                                                 @AuthenticationPrincipal SecurityUser user,
&nbsp;                                                 HttpServletRequest request) throws Exception {
<b class="nc">&nbsp;        EntityType entityType = checkEnumParameter(&quot;entityType&quot;, strEntityType, EntityType::valueOf);</b>
<b class="nc">&nbsp;        Optional&lt;NotificationTarget&gt; sysAdmins = notificationTargetService.findNotificationTargetsByTenantIdAndUsersFilterType(TenantId.SYS_TENANT_ID, UsersFilterType.SYSTEM_ADMINISTRATORS)</b>
<b class="nc">&nbsp;                .stream().findFirst();</b>
<b class="nc">&nbsp;        if (sysAdmins.isPresent()) {</b>
<b class="nc">&nbsp;            NotificationTargetId notificationTargetId = sysAdmins.get().getId();</b>
<b class="nc">&nbsp;            String baseUrl = systemSecurityService.getBaseUrl(TenantId.SYS_TENANT_ID, new CustomerId(EntityId.NULL_UUID), request);</b>
<b class="nc">&nbsp;            NotificationInfo info = EntitiesLimitIncreaseRequestNotificationInfo.builder()</b>
<b class="nc">&nbsp;                    .entityType(entityType)</b>
<b class="nc">&nbsp;                    .userEmail(user.getEmail())</b>
<b class="nc">&nbsp;                    .increaseLimitActionLabel(&quot;Set new limit&quot;)</b>
<b class="nc">&nbsp;                    .increaseLimitLink(&quot;/tenants/&quot;+user.getTenantId().toString())</b>
<b class="nc">&nbsp;                    .baseUrl(baseUrl)</b>
<b class="nc">&nbsp;                    .build();</b>
<b class="nc">&nbsp;            notificationCenter.sendSystemNotification(TenantId.SYS_TENANT_ID, notificationTargetId, NotificationType.ENTITIES_LIMIT_INCREASE_REQUEST, info);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;Notification target for &#39;System administrators&#39; not found&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get notification request preview (getNotificationRequestPreview)&quot;,
&nbsp;            notes = &quot;Returns preview for notification request.&quot; + NEW_LINE +
&nbsp;                    &quot;`processedTemplates` shows how the notifications for each delivery method will look like &quot; +
&nbsp;                    &quot;for the first recipient of the corresponding notification target.&quot; +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PostMapping(&quot;/notification/request/preview&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public NotificationRequestPreview getNotificationRequestPreview(@RequestBody @Valid NotificationRequest request,
&nbsp;                                                                    @Parameter(description = &quot;Amount of the recipients to show in preview&quot;)
&nbsp;                                                                    @RequestParam(defaultValue = &quot;20&quot;) int recipientsPreviewSize,
&nbsp;                                                                    @AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
&nbsp;        // PE: generic permission
&nbsp;        NotificationTemplate template;
<b class="nc">&nbsp;        if (request.getTemplateId() != null) {</b>
<b class="nc">&nbsp;            template = checkEntityId(request.getTemplateId(), notificationTemplateService::findNotificationTemplateById, Operation.READ);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            template = request.getTemplate();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (template == null) {</b>
<b class="nc">&nbsp;            throw new IllegalArgumentException(&quot;Template is missing&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        request.setOriginatorEntityId(user.getId());</b>
<b class="nc">&nbsp;        List&lt;NotificationTarget&gt; targets = request.getTargets().stream()</b>
<b class="nc">&nbsp;                .map(NotificationTargetId::new)</b>
<b class="nc">&nbsp;                .map(targetId -&gt; {</b>
<b class="nc">&nbsp;                    NotificationTarget target = notificationTargetService.findNotificationTargetById(user.getTenantId(), targetId);</b>
<b class="nc">&nbsp;                    if (target == null) {</b>
<b class="nc">&nbsp;                        throw new IllegalArgumentException(&quot;Notification target for id &quot; + targetId + &quot; not found&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return target;</b>
&nbsp;                })
<b class="nc">&nbsp;                .sorted(Comparator.comparing(target -&gt; target.getConfiguration().getType()))</b>
<b class="nc">&nbsp;                .toList();</b>
&nbsp;
<b class="nc">&nbsp;        NotificationRequestPreview preview = new NotificationRequestPreview();</b>
&nbsp;
<b class="nc">&nbsp;        Set&lt;String&gt; recipientsPreview = new LinkedHashSet&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;String, Integer&gt; recipientsCountByTarget = new LinkedHashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        Map&lt;NotificationTargetType, NotificationRecipient&gt; firstRecipient = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;        for (NotificationTarget target : targets) {</b>
<b class="nc">&nbsp;            checkEntity(getCurrentUser(), target, Operation.READ);</b>
&nbsp;
&nbsp;            int recipientsCount;
&nbsp;            List&lt;NotificationRecipient&gt; recipientsPart;
<b class="nc">&nbsp;            NotificationTargetType targetType = target.getConfiguration().getType();</b>
<b class="nc">&nbsp;            switch (targetType) {</b>
&nbsp;                case PLATFORM_USERS: {
<b class="nc">&nbsp;                    PageData&lt;User&gt; recipients = notificationTargetService.findRecipientsForNotificationTargetConfig(user.getTenantId(),</b>
<b class="nc">&nbsp;                            (PlatformUsersNotificationTargetConfig) target.getConfiguration(), new PageLink(recipientsPreviewSize, 0, null,</b>
&nbsp;                                    SortOrder.BY_CREATED_TIME_DESC));
<b class="nc">&nbsp;                    recipientsCount = (int) recipients.getTotalElements();</b>
<b class="nc">&nbsp;                    recipientsPart = recipients.getData().stream().map(r -&gt; (NotificationRecipient) r).collect(Collectors.toList());</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;                case SLACK: {
<b class="nc">&nbsp;                    recipientsCount = 1;</b>
<b class="nc">&nbsp;                    recipientsPart = List.of(((SlackNotificationTargetConfig) target.getConfiguration()).getConversation());</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;                case MICROSOFT_TEAMS: {
<b class="nc">&nbsp;                    recipientsCount = 1;</b>
<b class="nc">&nbsp;                    recipientsPart = List.of(((MicrosoftTeamsNotificationTargetConfig) target.getConfiguration()));</b>
&nbsp;                    break;
&nbsp;                }
&nbsp;                default:
<b class="nc">&nbsp;                    throw new IllegalArgumentException(&quot;Target type &quot; + targetType + &quot; not supported&quot;);</b>
&nbsp;            }
<b class="nc">&nbsp;            firstRecipient.putIfAbsent(targetType, !recipientsPart.isEmpty() ? recipientsPart.get(0) : null);</b>
<b class="nc">&nbsp;            for (NotificationRecipient recipient : recipientsPart) {</b>
<b class="nc">&nbsp;                if (recipientsPreview.size() &lt; recipientsPreviewSize) {</b>
<b class="nc">&nbsp;                    String title = recipient.getTitle();</b>
<b class="nc">&nbsp;                    if (recipient instanceof SlackConversation) {</b>
<b class="nc">&nbsp;                        title = ((SlackConversation) recipient).getPointer() + title;</b>
<b class="nc">&nbsp;                    } else if (recipient instanceof User) {</b>
<b class="nc">&nbsp;                        if (!title.equals(recipient.getEmail())) {</b>
<b class="nc">&nbsp;                            title += &quot; (&quot; + recipient.getEmail() + &quot;)&quot;;</b>
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                    recipientsPreview.add(title);</b>
&nbsp;                } else {
&nbsp;                    break;
&nbsp;                }
&nbsp;            }
<b class="nc">&nbsp;            recipientsCountByTarget.put(target.getName(), recipientsCount);</b>
&nbsp;        }
<b class="nc">&nbsp;        preview.setRecipientsPreview(recipientsPreview);</b>
<b class="nc">&nbsp;        preview.setRecipientsCountByTarget(recipientsCountByTarget);</b>
<b class="nc">&nbsp;        preview.setTotalRecipientsCount(recipientsCountByTarget.values().stream().mapToInt(Integer::intValue).sum());</b>
&nbsp;
<b class="nc">&nbsp;        Set&lt;NotificationDeliveryMethod&gt; deliveryMethods = template.getConfiguration().getDeliveryMethodsTemplates().entrySet()</b>
<b class="nc">&nbsp;                .stream().filter(entry -&gt; entry.getValue().isEnabled()).map(Map.Entry::getKey).collect(Collectors.toSet());</b>
<b class="nc">&nbsp;        NotificationProcessingContext ctx = NotificationProcessingContext.builder()</b>
<b class="nc">&nbsp;                .tenantId(user.getTenantId())</b>
<b class="nc">&nbsp;                .request(request)</b>
<b class="nc">&nbsp;                .deliveryMethods(deliveryMethods)</b>
<b class="nc">&nbsp;                .template(template)</b>
<b class="nc">&nbsp;                .settings(null)</b>
<b class="nc">&nbsp;                .build();</b>
<b class="nc">&nbsp;        Map&lt;NotificationDeliveryMethod, DeliveryMethodNotificationTemplate&gt; processedTemplates = ctx.getDeliveryMethods().stream()</b>
<b class="nc">&nbsp;                .collect(Collectors.toMap(m -&gt; m, deliveryMethod -&gt; {</b>
<b class="nc">&nbsp;                    NotificationTargetType targetType = NotificationTargetType.forDeliveryMethod(deliveryMethod);</b>
<b class="nc">&nbsp;                    return ctx.getProcessedTemplate(deliveryMethod, firstRecipient.get(targetType));</b>
&nbsp;                }));
<b class="nc">&nbsp;        preview.setProcessedTemplates(processedTemplates);</b>
&nbsp;
<b class="nc">&nbsp;        return preview;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get notification request by id (getNotificationRequestById)&quot;,
&nbsp;            notes = &quot;Fetches notification request info by request id.&quot; +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @GetMapping(&quot;/notification/request/{id}&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public NotificationRequestInfo getNotificationRequestById(@PathVariable UUID id) throws ThingsboardException {
<b class="nc">&nbsp;        NotificationRequestId notificationRequestId = new NotificationRequestId(id);</b>
<b class="nc">&nbsp;        return checkEntityId(notificationRequestId, notificationRequestService::findNotificationRequestInfoById, Operation.READ);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get notification requests (getNotificationRequests)&quot;,
&nbsp;            notes = &quot;Returns the page of notification requests submitted by users of this tenant or sysadmins.&quot; + NEW_LINE +
&nbsp;                    PAGE_DATA_PARAMETERS +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @GetMapping(&quot;/notification/requests&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public PageData&lt;NotificationRequestInfo&gt; getNotificationRequests(@Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;                                                                     @RequestParam int pageSize,
&nbsp;                                                                     @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;                                                                     @RequestParam int page,
&nbsp;                                                                     @Parameter(description = &quot;Case-insensitive &#39;substring&#39; filed based on the used template name&quot;)
&nbsp;                                                                     @RequestParam(required = false) String textSearch,
&nbsp;                                                                     @Parameter(description = SORT_PROPERTY_DESCRIPTION)
&nbsp;                                                                     @RequestParam(required = false) String sortProperty,
&nbsp;                                                                     @Parameter(description = SORT_ORDER_DESCRIPTION)
&nbsp;                                                                     @RequestParam(required = false) String sortOrder,
&nbsp;                                                                     @AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
&nbsp;        // PE: generic permission
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        return notificationRequestService.findNotificationRequestsInfosByTenantIdAndOriginatorType(user.getTenantId(), EntityType.USER, pageLink);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete notification request (deleteNotificationRequest)&quot;,
&nbsp;            notes = &quot;Deletes notification request by its id.&quot; + NEW_LINE +
&nbsp;                    &quot;If the request has status `SENT` - all sent notifications for this request will be deleted. &quot; +
&nbsp;                    &quot;If it is `SCHEDULED`, the request will be cancelled.&quot; +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @DeleteMapping(&quot;/notification/request/{id}&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public void deleteNotificationRequest(@PathVariable UUID id) throws Exception {
<b class="nc">&nbsp;        NotificationRequestId notificationRequestId = new NotificationRequestId(id);</b>
<b class="nc">&nbsp;        NotificationRequest notificationRequest = checkEntityId(notificationRequestId, notificationRequestService::findNotificationRequestById, Operation.DELETE);</b>
<b class="nc">&nbsp;        doDeleteAndLog(EntityType.NOTIFICATION_REQUEST, notificationRequest, notificationCenter::deleteNotificationRequest);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Save notification settings (saveNotificationSettings)&quot;,
&nbsp;            notes = &quot;Saves notification settings for this tenant or sysadmin.\n&quot; +
&nbsp;                    &quot;`deliveryMethodsConfigs` of the settings must be specified.&quot; + NEW_LINE +
&nbsp;                    &quot;Here is an example of the notification settings with Slack configuration:\n&quot; +
&nbsp;                    MARKDOWN_CODE_BLOCK_START +
&nbsp;                    &quot;{\n&quot; +
&nbsp;                    &quot;  \&quot;deliveryMethodsConfigs\&quot;: {\n&quot; +
&nbsp;                    &quot;    \&quot;SLACK\&quot;: {\n&quot; +
&nbsp;                    &quot;      \&quot;method\&quot;: \&quot;SLACK\&quot;,\n&quot; +
&nbsp;                    &quot;      \&quot;botToken\&quot;: \&quot;xoxb-....\&quot;\n&quot; +
&nbsp;                    &quot;    }\n&quot; +
&nbsp;                    &quot;  }\n&quot; +
&nbsp;                    &quot;}&quot; +
&nbsp;                    MARKDOWN_CODE_BLOCK_END +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PostMapping(&quot;/notification/settings&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public NotificationSettings saveNotificationSettings(@RequestBody @Valid NotificationSettings notificationSettings,
&nbsp;                                                         @AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
<b class="nc">&nbsp;        accessControlService.checkPermission(user, Resource.ADMIN_SETTINGS, Operation.WRITE);</b>
<b class="nc">&nbsp;        TenantId tenantId = user.isSystemAdmin() ? TenantId.SYS_TENANT_ID : user.getTenantId();</b>
<b class="nc">&nbsp;        notificationSettingsService.saveNotificationSettings(tenantId, notificationSettings);</b>
<b class="nc">&nbsp;        return notificationSettings;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get notification settings (getNotificationSettings)&quot;,
&nbsp;            notes = &quot;Retrieves notification settings for this tenant or sysadmin.&quot; +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @GetMapping(&quot;/notification/settings&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    public NotificationSettings getNotificationSettings(@AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
<b class="nc">&nbsp;        accessControlService.checkPermission(user, Resource.ADMIN_SETTINGS, Operation.READ);</b>
<b class="nc">&nbsp;        TenantId tenantId = user.isSystemAdmin() ? TenantId.SYS_TENANT_ID : user.getTenantId();</b>
<b class="nc">&nbsp;        return notificationSettingsService.findNotificationSettings(tenantId);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get available delivery methods (getAvailableDeliveryMethods)&quot;,
&nbsp;            notes = &quot;Returns the list of delivery methods that are properly configured and are allowed to be used for sending notifications.&quot; +
&nbsp;                    SYSTEM_OR_TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @GetMapping(&quot;/notification/deliveryMethods&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public List&lt;NotificationDeliveryMethod&gt; getAvailableDeliveryMethods(@AuthenticationPrincipal SecurityUser user) throws ThingsboardException {
<b class="nc">&nbsp;        return notificationCenter.getAvailableDeliveryMethods(user.getTenantId());</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    @PostMapping(&quot;/notification/settings/user&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public UserNotificationSettings saveUserNotificationSettings(@RequestBody @Valid UserNotificationSettings settings,
&nbsp;                                                                 @AuthenticationPrincipal SecurityUser user) {
<b class="nc">&nbsp;        return notificationSettingsService.saveUserNotificationSettings(user.getTenantId(), user.getId(), settings);</b>
&nbsp;    }
&nbsp;
&nbsp;    @GetMapping(&quot;/notification/settings/user&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    public UserNotificationSettings getUserNotificationSettings(@AuthenticationPrincipal SecurityUser user) {
<b class="nc">&nbsp;        return notificationSettingsService.getUserNotificationSettings(user.getTenantId(), user.getId(), true);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
