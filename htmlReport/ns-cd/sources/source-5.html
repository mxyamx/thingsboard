<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > AlarmController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.controller</a>
</div>

<h1>Coverage Summary for Class: AlarmController (org.thingsboard.server.controller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">AlarmController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/66)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/109)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.controller;
&nbsp;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.media.ArraySchema;
&nbsp;import io.swagger.v3.oas.annotations.media.Schema;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.security.access.prepost.PreAuthorize;
&nbsp;import org.springframework.web.bind.annotation.DeleteMapping;
&nbsp;import org.springframework.web.bind.annotation.GetMapping;
&nbsp;import org.springframework.web.bind.annotation.PathVariable;
&nbsp;import org.springframework.web.bind.annotation.PostMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestBody;
&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestParam;
&nbsp;import org.springframework.web.bind.annotation.ResponseStatus;
&nbsp;import org.springframework.web.bind.annotation.RestController;
&nbsp;import org.thingsboard.server.common.data.EntitySubtype;
&nbsp;import org.thingsboard.server.common.data.StringUtils;
&nbsp;import org.thingsboard.server.common.data.alarm.Alarm;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmInfo;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmQuery;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmQueryV2;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmSearchStatus;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmSeverity;
&nbsp;import org.thingsboard.server.common.data.alarm.AlarmStatus;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardErrorCode;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardException;
&nbsp;import org.thingsboard.server.common.data.id.AlarmId;
&nbsp;import org.thingsboard.server.common.data.id.EntityId;
&nbsp;import org.thingsboard.server.common.data.id.EntityIdFactory;
&nbsp;import org.thingsboard.server.common.data.id.UserId;
&nbsp;import org.thingsboard.server.common.data.page.PageData;
&nbsp;import org.thingsboard.server.common.data.page.PageLink;
&nbsp;import org.thingsboard.server.common.data.page.TimePageLink;
&nbsp;import org.thingsboard.server.config.annotations.ApiOperation;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.entitiy.alarm.TbAlarmService;
&nbsp;import org.thingsboard.server.service.security.permission.Operation;
&nbsp;import org.thingsboard.server.service.security.permission.Resource;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Collections;
&nbsp;import java.util.List;
&nbsp;import java.util.UUID;
&nbsp;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ALARM_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ALARM_INFO_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ASSIGNEE_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ASSIGN_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ENTITY_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ENTITY_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ENTITY_TYPE;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.ENTITY_TYPE_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_DATA_PARAMETERS;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_NUMBER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_SIZE_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_ORDER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_PROPERTY_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.UUID_WIKI_LINK;
&nbsp;
&nbsp;@RestController
&nbsp;@TbCoreComponent
&nbsp;@RequiredArgsConstructor
&nbsp;@RequestMapping(&quot;/api&quot;)
&nbsp;public class AlarmController extends BaseController {
&nbsp;
&nbsp;    private final TbAlarmService tbAlarmService;
&nbsp;
&nbsp;    public static final String ALARM_ID = &quot;alarmId&quot;;
&nbsp;    private static final String ALARM_SECURITY_CHECK = &quot;If the user has the authority of &#39;Tenant Administrator&#39;, the server checks that the originator of alarm is owned by the same tenant. &quot; +
&nbsp;            &quot;If the user has the authority of &#39;Customer User&#39;, the server checks that the originator of alarm belongs to the customer. &quot;;
&nbsp;    private static final String ALARM_QUERY_SEARCH_STATUS_DESCRIPTION = &quot;A string value representing one of the AlarmSearchStatus enumeration value&quot;;
&nbsp;
&nbsp;    private static final String ALARM_QUERY_SEARCH_STATUS_ARRAY_DESCRIPTION = &quot;A list of string values separated by comma &#39;,&#39; representing one of the AlarmSearchStatus enumeration value&quot;;
&nbsp;    private static final String ALARM_QUERY_STATUS_DESCRIPTION = &quot;A string value representing one of the AlarmStatus enumeration value&quot;;
&nbsp;    private static final String ALARM_QUERY_SEVERITY_ARRAY_DESCRIPTION = &quot;A list of string values separated by comma &#39;,&#39; representing one of the AlarmSeverity enumeration value&quot;;
&nbsp;
&nbsp;    private static final String ALARM_QUERY_TYPE_ARRAY_DESCRIPTION = &quot;A list of string values separated by comma &#39;,&#39; representing alarm types&quot;;
&nbsp;    private static final String ALARM_QUERY_ASSIGNEE_DESCRIPTION = &quot;A string value representing the assignee user id. For example, &#39;784f394c-42b6-435a-983c-b7beff2784f9&#39;&quot;;
&nbsp;    private static final String ALARM_QUERY_TEXT_SEARCH_DESCRIPTION = &quot;The case insensitive &#39;substring&#39; filter based on of next alarm fields: type, severity or status&quot;;
&nbsp;    private static final String ALARM_QUERY_START_TIME_DESCRIPTION = &quot;The start timestamp in milliseconds of the search time range over the Alarm class field: &#39;createdTime&#39;.&quot;;
&nbsp;    private static final String ALARM_QUERY_END_TIME_DESCRIPTION = &quot;The end timestamp in milliseconds of the search time range over the Alarm class field: &#39;createdTime&#39;.&quot;;
&nbsp;    private static final String ALARM_QUERY_FETCH_ORIGINATOR_DESCRIPTION = &quot;A boolean value to specify if the alarm originator name will be &quot; +
&nbsp;            &quot;filled in the AlarmInfo object  field: &#39;originatorName&#39; or will returns as null.&quot;;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Alarm (getAlarmById)&quot;,
&nbsp;            notes = &quot;Fetch the Alarm object based on the provided Alarm Id. &quot; + ALARM_SECURITY_CHECK)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarm/{alarmId}&quot;)
&nbsp;    public Alarm getAlarmById(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION)
&nbsp;                              @PathVariable(ALARM_ID) String strAlarmId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        return checkAlarmId(alarmId, Operation.READ);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Alarm Info (getAlarmInfoById)&quot;,
&nbsp;            notes = &quot;Fetch the Alarm Info object based on the provided Alarm Id. &quot; +
&nbsp;                    ALARM_SECURITY_CHECK + ALARM_INFO_DESCRIPTION + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarm/info/{alarmId}&quot;)
&nbsp;    public AlarmInfo getAlarmInfoById(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION)
&nbsp;                                      @PathVariable(ALARM_ID) String strAlarmId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        return checkAlarmInfoId(alarmId, Operation.READ);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Create or Update Alarm (saveAlarm)&quot;,
&nbsp;            notes = &quot;Creates or Updates the Alarm. &quot; +
&nbsp;                    &quot;When creating alarm, platform generates Alarm Id as &quot; + UUID_WIKI_LINK +
&nbsp;                    &quot;The newly created Alarm id will be present in the response. Specify existing Alarm id to update the alarm. &quot; +
&nbsp;                    &quot;Referencing non-existing Alarm Id will cause &#39;Not Found&#39; error. &quot; +
&nbsp;                    &quot;\n\nPlatform also deduplicate the alarms based on the entity id of originator and alarm &#39;type&#39;. &quot; +
&nbsp;                    &quot;For example, if the user or system component create the alarm with the type &#39;HighTemperature&#39; for device &#39;Device A&#39; the new active alarm is created. &quot; +
&nbsp;                    &quot;If the user tries to create &#39;HighTemperature&#39; alarm for the same device again, the previous alarm will be updated (the &#39;end_ts&#39; will be set to current timestamp). &quot; +
&nbsp;                    &quot;If the user clears the alarm (see &#39;Clear Alarm(clearAlarm)&#39;), than new alarm with the same type and same device may be created. &quot; +
&nbsp;                    &quot;Remove &#39;id&#39;, &#39;tenantId&#39; and optionally &#39;customerId&#39; from the request body example (below) to create new Alarm entity. &quot; +
&nbsp;                    TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/alarm&quot;)
&nbsp;    public Alarm saveAlarm(@io.swagger.v3.oas.annotations.parameters.RequestBody(description = &quot;A JSON value representing the alarm.&quot;) @RequestBody Alarm alarm) throws ThingsboardException {
<b class="nc">&nbsp;        alarm.setTenantId(getTenantId());</b>
<b class="nc">&nbsp;        checkNotNull(alarm.getOriginator());</b>
<b class="nc">&nbsp;        checkEntity(alarm.getId(), alarm, Resource.ALARM);</b>
<b class="nc">&nbsp;        checkEntityId(alarm.getOriginator(), Operation.READ);</b>
<b class="nc">&nbsp;        if (alarm.getAssigneeId() != null) {</b>
<b class="nc">&nbsp;            checkUserId(alarm.getAssigneeId(), Operation.READ);</b>
&nbsp;        }
<b class="nc">&nbsp;        return tbAlarmService.save(alarm, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete Alarm (deleteAlarm)&quot;,
&nbsp;            notes = &quot;Deletes the Alarm. Referencing non-existing Alarm Id will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/alarm/{alarmId}&quot;)
&nbsp;    public boolean deleteAlarm(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION) @PathVariable(ALARM_ID) String strAlarmId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        Alarm alarm = checkAlarmId(alarmId, Operation.DELETE);</b>
<b class="nc">&nbsp;        return tbAlarmService.delete(alarm, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Acknowledge Alarm (ackAlarm)&quot;,
&nbsp;            notes = &quot;Acknowledge the Alarm. &quot; +
&nbsp;                    &quot;Once acknowledged, the &#39;ack_ts&#39; field will be set to current timestamp and special rule chain event &#39;ALARM_ACK&#39; will be generated. &quot; +
&nbsp;                    &quot;Referencing non-existing Alarm Id will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/alarm/{alarmId}/ack&quot;)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public AlarmInfo ackAlarm(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION) @PathVariable(ALARM_ID) String strAlarmId) throws Exception {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        Alarm alarm = checkAlarmId(alarmId, Operation.WRITE);</b>
&nbsp;        //TODO: return correct error code if the alarm is not found or already cleared
<b class="nc">&nbsp;        return tbAlarmService.ack(alarm, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Clear Alarm (clearAlarm)&quot;,
&nbsp;            notes = &quot;Clear the Alarm. &quot; +
&nbsp;                    &quot;Once cleared, the &#39;clear_ts&#39; field will be set to current timestamp and special rule chain event &#39;ALARM_CLEAR&#39; will be generated. &quot; +
&nbsp;                    &quot;Referencing non-existing Alarm Id will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/alarm/{alarmId}/clear&quot;)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public AlarmInfo clearAlarm(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION) @PathVariable(ALARM_ID) String strAlarmId) throws Exception {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        Alarm alarm = checkAlarmId(alarmId, Operation.WRITE);</b>
&nbsp;        //TODO: return correct error code if the alarm is not found or already cleared
<b class="nc">&nbsp;        return tbAlarmService.clear(alarm, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Assign/Reassign Alarm (assignAlarm)&quot;,
&nbsp;            notes = &quot;Assign the Alarm. &quot; +
&nbsp;                    &quot;Once assigned, the &#39;assign_ts&#39; field will be set to current timestamp and special rule chain event &#39;ALARM_ASSIGNED&#39; &quot; +
&nbsp;                    &quot;(or ALARM_REASSIGNED in case of assigning already assigned alarm) will be generated. &quot; +
&nbsp;                    &quot;Referencing non-existing Alarm Id will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/alarm/{alarmId}/assign/{assigneeId}&quot;)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public Alarm assignAlarm(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION)
&nbsp;                             @PathVariable(ALARM_ID) String strAlarmId,
&nbsp;                             @Parameter(description = ASSIGN_ID_PARAM_DESCRIPTION)
&nbsp;                             @PathVariable(ASSIGNEE_ID) String strAssigneeId
&nbsp;    ) throws Exception {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        checkParameter(ASSIGNEE_ID, strAssigneeId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        Alarm alarm = checkAlarmId(alarmId, Operation.WRITE);</b>
<b class="nc">&nbsp;        UserId assigneeId = new UserId(UUID.fromString(strAssigneeId));</b>
<b class="nc">&nbsp;        checkUserId(assigneeId, Operation.READ);</b>
<b class="nc">&nbsp;        return tbAlarmService.assign(alarm, assigneeId, System.currentTimeMillis(), getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Unassign Alarm (unassignAlarm)&quot;,
&nbsp;            notes = &quot;Unassign the Alarm. &quot; +
&nbsp;                    &quot;Once unassigned, the &#39;assign_ts&#39; field will be set to current timestamp and special rule chain event &#39;ALARM_UNASSIGNED&#39; will be generated. &quot; +
&nbsp;                    &quot;Referencing non-existing Alarm Id will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/alarm/{alarmId}/assign&quot;)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public Alarm unassignAlarm(@Parameter(description = ALARM_ID_PARAM_DESCRIPTION)
&nbsp;                               @PathVariable(ALARM_ID) String strAlarmId
&nbsp;    ) throws Exception {
<b class="nc">&nbsp;        checkParameter(ALARM_ID, strAlarmId);</b>
<b class="nc">&nbsp;        AlarmId alarmId = new AlarmId(toUUID(strAlarmId));</b>
<b class="nc">&nbsp;        Alarm alarm = checkAlarmId(alarmId, Operation.WRITE);</b>
<b class="nc">&nbsp;        return tbAlarmService.unassign(alarm, System.currentTimeMillis(), getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Alarms (getAlarms)&quot;,
&nbsp;            notes = &quot;Returns a page of alarms for the selected entity. Specifying both parameters &#39;searchStatus&#39; and &#39;status&#39; at the same time will cause an error. &quot; +
&nbsp;                    PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarm/{entityType}/{entityId}&quot;)
&nbsp;    public PageData&lt;AlarmInfo&gt; getAlarms(
&nbsp;            @Parameter(description = ENTITY_TYPE_PARAM_DESCRIPTION, required = true, schema = @Schema(defaultValue = &quot;DEVICE&quot;))
&nbsp;            @PathVariable(ENTITY_TYPE) String strEntityType,
&nbsp;            @Parameter(description = ENTITY_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(ENTITY_ID) String strEntityId,
&nbsp;            @Parameter(description = ALARM_QUERY_SEARCH_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ANY&quot;, &quot;ACTIVE&quot;, &quot;CLEARED&quot;, &quot;ACK&quot;, &quot;UNACK&quot;}))
&nbsp;            @RequestParam(required = false) String searchStatus,
&nbsp;            @Parameter(description = ALARM_QUERY_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ACTIVE_UNACK&quot;, &quot;ACTIVE_ACK&quot;, &quot;CLEARED_UNACK&quot;, &quot;CLEARED_ACK&quot;}))
&nbsp;            @RequestParam(required = false) String status,
&nbsp;            @Parameter(description = ALARM_QUERY_ASSIGNEE_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String assigneeId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = ALARM_QUERY_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;startTs&quot;, &quot;endTs&quot;, &quot;type&quot;, &quot;ackTs&quot;, &quot;clearTs&quot;, &quot;severity&quot;, &quot;status&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder,
&nbsp;            @Parameter(description = ALARM_QUERY_START_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long startTime,
&nbsp;            @Parameter(description = ALARM_QUERY_END_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long endTime,
&nbsp;            @Parameter(description = ALARM_QUERY_FETCH_ORIGINATOR_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Boolean fetchOriginator
&nbsp;    ) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;EntityId&quot;, strEntityId);</b>
<b class="nc">&nbsp;        checkParameter(&quot;EntityType&quot;, strEntityType);</b>
<b class="nc">&nbsp;        EntityId entityId = EntityIdFactory.getByTypeAndId(strEntityType, strEntityId);</b>
<b class="nc">&nbsp;        AlarmSearchStatus alarmSearchStatus = StringUtils.isEmpty(searchStatus) ? null : AlarmSearchStatus.valueOf(searchStatus);</b>
<b class="nc">&nbsp;        AlarmStatus alarmStatus = StringUtils.isEmpty(status) ? null : AlarmStatus.valueOf(status);</b>
<b class="nc">&nbsp;        if (alarmSearchStatus != null &amp;&amp; alarmStatus != null) {</b>
<b class="nc">&nbsp;            throw new ThingsboardException(&quot;Invalid alarms search query: Both parameters &#39;searchStatus&#39; &quot; +</b>
&nbsp;                    &quot;and &#39;status&#39; can&#39;t be specified at the same time!&quot;, ThingsboardErrorCode.BAD_REQUEST_PARAMS);
&nbsp;        }
<b class="nc">&nbsp;        checkEntityId(entityId, Operation.READ);</b>
<b class="nc">&nbsp;        UserId assigneeUserId = null;</b>
<b class="nc">&nbsp;        if (assigneeId != null) {</b>
<b class="nc">&nbsp;            assigneeUserId = new UserId(UUID.fromString(assigneeId));</b>
&nbsp;        }
<b class="nc">&nbsp;        TimePageLink pageLink = createTimePageLink(pageSize, page, textSearch, sortProperty, sortOrder, startTime, endTime);</b>
&nbsp;
<b class="nc">&nbsp;        return checkNotNull(alarmService.findAlarms(getCurrentUser().getTenantId(), new AlarmQuery(entityId, pageLink, alarmSearchStatus, alarmStatus, assigneeUserId, fetchOriginator)));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get All Alarms (getAllAlarms)&quot;,
&nbsp;            notes = &quot;Returns a page of alarms that belongs to the current user owner. &quot; +
&nbsp;                    &quot;If the user has the authority of &#39;Tenant Administrator&#39;, the server returns alarms that belongs to the tenant of current user. &quot; +
&nbsp;                    &quot;If the user has the authority of &#39;Customer User&#39;, the server returns alarms that belongs to the customer of current user. &quot; +
&nbsp;                    &quot;Specifying both parameters &#39;searchStatus&#39; and &#39;status&#39; at the same time will cause an error. &quot; +
&nbsp;                    PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarms&quot;)
&nbsp;    public PageData&lt;AlarmInfo&gt; getAllAlarms(
&nbsp;            @Parameter(description = ALARM_QUERY_SEARCH_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ANY&quot;, &quot;ACTIVE&quot;, &quot;CLEARED&quot;, &quot;ACK&quot;, &quot;UNACK&quot;}))
&nbsp;            @RequestParam(required = false) String searchStatus,
&nbsp;            @Parameter(description = ALARM_QUERY_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ACTIVE_UNACK&quot;, &quot;ACTIVE_ACK&quot;, &quot;CLEARED_UNACK&quot;, &quot;CLEARED_ACK&quot;}))
&nbsp;            @RequestParam(required = false) String status,
&nbsp;            @Parameter(description = ALARM_QUERY_ASSIGNEE_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String assigneeId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = ALARM_QUERY_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;startTs&quot;, &quot;endTs&quot;, &quot;type&quot;, &quot;ackTs&quot;, &quot;clearTs&quot;, &quot;severity&quot;, &quot;status&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder,
&nbsp;            @Parameter(description = ALARM_QUERY_START_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long startTime,
&nbsp;            @Parameter(description = ALARM_QUERY_END_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long endTime,
&nbsp;            @Parameter(description = ALARM_QUERY_FETCH_ORIGINATOR_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Boolean fetchOriginator
&nbsp;    ) throws ThingsboardException {
<b class="nc">&nbsp;        AlarmSearchStatus alarmSearchStatus = StringUtils.isEmpty(searchStatus) ? null : AlarmSearchStatus.valueOf(searchStatus);</b>
<b class="nc">&nbsp;        AlarmStatus alarmStatus = StringUtils.isEmpty(status) ? null : AlarmStatus.valueOf(status);</b>
<b class="nc">&nbsp;        if (alarmSearchStatus != null &amp;&amp; alarmStatus != null) {</b>
<b class="nc">&nbsp;            throw new ThingsboardException(&quot;Invalid alarms search query: Both parameters &#39;searchStatus&#39; &quot; +</b>
&nbsp;                    &quot;and &#39;status&#39; can&#39;t be specified at the same time!&quot;, ThingsboardErrorCode.BAD_REQUEST_PARAMS);
&nbsp;        }
<b class="nc">&nbsp;        UserId assigneeUserId = null;</b>
<b class="nc">&nbsp;        if (assigneeId != null) {</b>
<b class="nc">&nbsp;            assigneeUserId = new UserId(UUID.fromString(assigneeId));</b>
&nbsp;        }
<b class="nc">&nbsp;        TimePageLink pageLink = createTimePageLink(pageSize, page, textSearch, sortProperty, sortOrder, startTime, endTime);</b>
&nbsp;
<b class="nc">&nbsp;        if (getCurrentUser().isCustomerUser()) {</b>
<b class="nc">&nbsp;            return checkNotNull(alarmService.findCustomerAlarms(getCurrentUser().getTenantId(), getCurrentUser().getCustomerId(), new AlarmQuery(null, pageLink, alarmSearchStatus, alarmStatus, assigneeUserId, fetchOriginator)));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return checkNotNull(alarmService.findAlarms(getCurrentUser().getTenantId(), new AlarmQuery(null, pageLink, alarmSearchStatus, alarmStatus, assigneeUserId, fetchOriginator)));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Alarms (getAlarmsV2)&quot;,
&nbsp;            notes = &quot;Returns a page of alarms for the selected entity. &quot; +
&nbsp;                    PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/v2/alarm/{entityType}/{entityId}&quot;)
&nbsp;    public PageData&lt;AlarmInfo&gt; getAlarmsV2(
&nbsp;            @Parameter(description = ENTITY_TYPE_PARAM_DESCRIPTION, required = true, schema = @Schema(defaultValue = &quot;DEVICE&quot;))
&nbsp;            @PathVariable(ENTITY_TYPE) String strEntityType,
&nbsp;            @Parameter(description = ENTITY_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(ENTITY_ID) String strEntityId,
&nbsp;            @Parameter(description = ALARM_QUERY_SEARCH_STATUS_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;, allowableValues = {&quot;ANY&quot;, &quot;ACTIVE&quot;, &quot;CLEARED&quot;, &quot;ACK&quot;, &quot;UNACK&quot;})))
&nbsp;            @RequestParam(required = false) String[] statusList,
&nbsp;            @Parameter(description = ALARM_QUERY_SEVERITY_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;, allowableValues = {&quot;CRITICAL&quot;, &quot;MAJOR&quot;, &quot;MINOR&quot;, &quot;WARNING&quot;, &quot;INDETERMINATE&quot;})))
&nbsp;            @RequestParam(required = false) String[] severityList,
&nbsp;            @Parameter(description = ALARM_QUERY_TYPE_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;)))
&nbsp;            @RequestParam(required = false) String[] typeList,
&nbsp;            @Parameter(description = ALARM_QUERY_ASSIGNEE_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String assigneeId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = ALARM_QUERY_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;startTs&quot;, &quot;endTs&quot;, &quot;type&quot;, &quot;ackTs&quot;, &quot;clearTs&quot;, &quot;severity&quot;, &quot;status&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder,
&nbsp;            @Parameter(description = ALARM_QUERY_START_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long startTime,
&nbsp;            @Parameter(description = ALARM_QUERY_END_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long endTime
&nbsp;    ) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;EntityId&quot;, strEntityId);</b>
<b class="nc">&nbsp;        checkParameter(&quot;EntityType&quot;, strEntityType);</b>
<b class="nc">&nbsp;        EntityId entityId = EntityIdFactory.getByTypeAndId(strEntityType, strEntityId);</b>
<b class="nc">&nbsp;        checkEntityId(entityId, Operation.READ);</b>
<b class="nc">&nbsp;        List&lt;AlarmSearchStatus&gt; alarmStatusList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        if (statusList != null) {</b>
<b class="nc">&nbsp;            for (String strStatus : statusList) {</b>
<b class="nc">&nbsp;                if (!StringUtils.isEmpty(strStatus)) {</b>
<b class="nc">&nbsp;                    alarmStatusList.add(AlarmSearchStatus.valueOf(strStatus));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        List&lt;AlarmSeverity&gt; alarmSeverityList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        if (severityList != null) {</b>
<b class="nc">&nbsp;            for (String strSeverity : severityList) {</b>
<b class="nc">&nbsp;                if (!StringUtils.isEmpty(strSeverity)) {</b>
<b class="nc">&nbsp;                    alarmSeverityList.add(AlarmSeverity.valueOf(strSeverity));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        List&lt;String&gt; alarmTypeList = typeList != null ? Arrays.asList(typeList) : Collections.emptyList();</b>
<b class="nc">&nbsp;        UserId assigneeUserId = null;</b>
<b class="nc">&nbsp;        if (assigneeId != null) {</b>
<b class="nc">&nbsp;            assigneeUserId = new UserId(UUID.fromString(assigneeId));</b>
&nbsp;        }
<b class="nc">&nbsp;        TimePageLink pageLink = createTimePageLink(pageSize, page, textSearch, sortProperty, sortOrder, startTime, endTime);</b>
&nbsp;
<b class="nc">&nbsp;        return checkNotNull(alarmService.findAlarmsV2(getCurrentUser().getTenantId(), new AlarmQueryV2(entityId, pageLink, alarmTypeList, alarmStatusList, alarmSeverityList, assigneeUserId)));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get All Alarms (getAllAlarmsV2)&quot;,
&nbsp;            notes = &quot;Returns a page of alarms that belongs to the current user owner. &quot; +
&nbsp;                    &quot;If the user has the authority of &#39;Tenant Administrator&#39;, the server returns alarms that belongs to the tenant of current user. &quot; +
&nbsp;                    &quot;If the user has the authority of &#39;Customer User&#39;, the server returns alarms that belongs to the customer of current user. &quot; +
&nbsp;                    PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/v2/alarms&quot;)
&nbsp;    public PageData&lt;AlarmInfo&gt; getAllAlarmsV2(
&nbsp;            @Parameter(description = ALARM_QUERY_SEARCH_STATUS_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;, allowableValues = {&quot;ANY&quot;, &quot;ACTIVE&quot;, &quot;CLEARED&quot;, &quot;ACK&quot;, &quot;UNACK&quot;})))
&nbsp;            @RequestParam(required = false) String[] statusList,
&nbsp;            @Parameter(description = ALARM_QUERY_SEVERITY_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;, allowableValues = {&quot;CRITICAL&quot;, &quot;MAJOR&quot;, &quot;MINOR&quot;, &quot;WARNING&quot;, &quot;INDETERMINATE&quot;})))
&nbsp;            @RequestParam(required = false) String[] severityList,
&nbsp;            @Parameter(description = ALARM_QUERY_TYPE_ARRAY_DESCRIPTION, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;)))
&nbsp;            @RequestParam(required = false) String[] typeList,
&nbsp;            @Parameter(description = ALARM_QUERY_ASSIGNEE_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String assigneeId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = ALARM_QUERY_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;startTs&quot;, &quot;endTs&quot;, &quot;type&quot;, &quot;ackTs&quot;, &quot;clearTs&quot;, &quot;severity&quot;, &quot;status&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder,
&nbsp;            @Parameter(description = ALARM_QUERY_START_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long startTime,
&nbsp;            @Parameter(description = ALARM_QUERY_END_TIME_DESCRIPTION)
&nbsp;            @RequestParam(required = false) Long endTime
&nbsp;    ) throws ThingsboardException {
<b class="nc">&nbsp;        List&lt;AlarmSearchStatus&gt; alarmStatusList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        if (statusList != null) {</b>
<b class="nc">&nbsp;            for (String strStatus : statusList) {</b>
<b class="nc">&nbsp;                if (!StringUtils.isEmpty(strStatus)) {</b>
<b class="nc">&nbsp;                    alarmStatusList.add(AlarmSearchStatus.valueOf(strStatus));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        List&lt;AlarmSeverity&gt; alarmSeverityList = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        if (severityList != null) {</b>
<b class="nc">&nbsp;            for (String strSeverity : severityList) {</b>
<b class="nc">&nbsp;                if (!StringUtils.isEmpty(strSeverity)) {</b>
<b class="nc">&nbsp;                    alarmSeverityList.add(AlarmSeverity.valueOf(strSeverity));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        List&lt;String&gt; alarmTypeList = typeList != null ? Arrays.asList(typeList) : Collections.emptyList();</b>
<b class="nc">&nbsp;        UserId assigneeUserId = null;</b>
<b class="nc">&nbsp;        if (assigneeId != null) {</b>
<b class="nc">&nbsp;            assigneeUserId = new UserId(UUID.fromString(assigneeId));</b>
&nbsp;        }
<b class="nc">&nbsp;        TimePageLink pageLink = createTimePageLink(pageSize, page, textSearch, sortProperty, sortOrder, startTime, endTime);</b>
&nbsp;
<b class="nc">&nbsp;        if (getCurrentUser().isCustomerUser()) {</b>
<b class="nc">&nbsp;            return checkNotNull(alarmService.findCustomerAlarmsV2(getCurrentUser().getTenantId(), getCurrentUser().getCustomerId(), new AlarmQueryV2(null, pageLink, alarmTypeList, alarmStatusList, alarmSeverityList, assigneeUserId)));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return checkNotNull(alarmService.findAlarmsV2(getCurrentUser().getTenantId(), new AlarmQueryV2(null, pageLink, alarmTypeList, alarmStatusList, alarmSeverityList, assigneeUserId)));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Highest Alarm Severity (getHighestAlarmSeverity)&quot;,
&nbsp;            notes = &quot;Search the alarms by originator (&#39;entityType&#39; and entityId&#39;) and optional &#39;status&#39; or &#39;searchStatus&#39; filters and returns the highest AlarmSeverity(CRITICAL, MAJOR, MINOR, WARNING or INDETERMINATE). &quot; +
&nbsp;                    &quot;Specifying both parameters &#39;searchStatus&#39; and &#39;status&#39; at the same time will cause an error.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarm/highestSeverity/{entityType}/{entityId}&quot;)
&nbsp;    public AlarmSeverity getHighestAlarmSeverity(
&nbsp;            @Parameter(description = ENTITY_TYPE_PARAM_DESCRIPTION, required = true, schema = @Schema(defaultValue = &quot;DEVICE&quot;))
&nbsp;            @PathVariable(ENTITY_TYPE) String strEntityType,
&nbsp;            @Parameter(description = ENTITY_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(ENTITY_ID) String strEntityId,
&nbsp;            @Parameter(description = ALARM_QUERY_SEARCH_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ANY&quot;, &quot;ACTIVE&quot;, &quot;CLEARED&quot;, &quot;ACK&quot;, &quot;UNACK&quot;}))
&nbsp;            @RequestParam(required = false) String searchStatus,
&nbsp;            @Parameter(description = ALARM_QUERY_STATUS_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ACTIVE_UNACK&quot;, &quot;ACTIVE_ACK&quot;, &quot;CLEARED_UNACK&quot;, &quot;CLEARED_ACK&quot;}))
&nbsp;            @RequestParam(required = false) String status,
&nbsp;            @Parameter(description = ALARM_QUERY_ASSIGNEE_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String assigneeId
&nbsp;    ) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;EntityId&quot;, strEntityId);</b>
<b class="nc">&nbsp;        checkParameter(&quot;EntityType&quot;, strEntityType);</b>
<b class="nc">&nbsp;        EntityId entityId = EntityIdFactory.getByTypeAndId(strEntityType, strEntityId);</b>
<b class="nc">&nbsp;        AlarmSearchStatus alarmSearchStatus = StringUtils.isEmpty(searchStatus) ? null : AlarmSearchStatus.valueOf(searchStatus);</b>
<b class="nc">&nbsp;        AlarmStatus alarmStatus = StringUtils.isEmpty(status) ? null : AlarmStatus.valueOf(status);</b>
<b class="nc">&nbsp;        if (alarmSearchStatus != null &amp;&amp; alarmStatus != null) {</b>
<b class="nc">&nbsp;            throw new ThingsboardException(&quot;Invalid alarms search query: Both parameters &#39;searchStatus&#39; &quot; +</b>
&nbsp;                    &quot;and &#39;status&#39; can&#39;t be specified at the same time!&quot;, ThingsboardErrorCode.BAD_REQUEST_PARAMS);
&nbsp;        }
<b class="nc">&nbsp;        checkEntityId(entityId, Operation.READ);</b>
<b class="nc">&nbsp;        return alarmService.findHighestAlarmSeverity(getCurrentUser().getTenantId(), entityId, alarmSearchStatus,</b>
&nbsp;                alarmStatus, assigneeId);
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Alarm Types (getAlarmTypes)&quot;,
&nbsp;            notes = &quot;Returns a set of unique alarm types based on alarms that are either owned by the tenant or assigned to the customer which user is performing the request.&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/alarm/types&quot;)
&nbsp;    public PageData&lt;EntitySubtype&gt; getAlarmTypes(@Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;                                                 @RequestParam int pageSize,
&nbsp;                                                 @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;                                                 @RequestParam int page,
&nbsp;                                                 @Parameter(description = ALARM_QUERY_TEXT_SEARCH_DESCRIPTION)
&nbsp;                                                 @RequestParam(required = false) String textSearch,
&nbsp;                                                 @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;                                                 @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, &quot;type&quot;, sortOrder);</b>
<b class="nc">&nbsp;        return checkNotNull(alarmService.findAlarmTypesByTenantId(getTenantId(), pageLink));</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
