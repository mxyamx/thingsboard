<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > RpcV2Controller</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.controller</a>
</div>

<h1>Coverage Summary for Class: RpcV2Controller (org.thingsboard.server.controller)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">RpcV2Controller</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/33)
  </span>
</td>
</tr>
  <tr>
    <td class="name">RpcV2Controller$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/9)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/42)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.controller;
&nbsp;
&nbsp;import com.google.common.util.concurrent.FutureCallback;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.media.Schema;
&nbsp;import io.swagger.v3.oas.annotations.responses.ApiResponse;
&nbsp;import io.swagger.v3.oas.annotations.responses.ApiResponses;
&nbsp;import jakarta.annotation.Nullable;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.http.ResponseEntity;
&nbsp;import org.springframework.security.access.prepost.PreAuthorize;
&nbsp;import org.springframework.web.bind.annotation.PathVariable;
&nbsp;import org.springframework.web.bind.annotation.RequestBody;
&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestMethod;
&nbsp;import org.springframework.web.bind.annotation.RequestParam;
&nbsp;import org.springframework.web.bind.annotation.ResponseBody;
&nbsp;import org.springframework.web.bind.annotation.RestController;
&nbsp;import org.springframework.web.context.request.async.DeferredResult;
&nbsp;import org.springframework.web.server.ResponseStatusException;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardException;
&nbsp;import org.thingsboard.server.common.data.id.DeviceId;
&nbsp;import org.thingsboard.server.common.data.id.RpcId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.msg.TbMsgType;
&nbsp;import org.thingsboard.server.common.data.page.PageData;
&nbsp;import org.thingsboard.server.common.data.page.PageLink;
&nbsp;import org.thingsboard.server.common.data.rpc.Rpc;
&nbsp;import org.thingsboard.server.common.data.rpc.RpcStatus;
&nbsp;import org.thingsboard.server.common.msg.TbMsg;
&nbsp;import org.thingsboard.server.common.msg.TbMsgMetaData;
&nbsp;import org.thingsboard.server.common.msg.rpc.RemoveRpcActorMsg;
&nbsp;import org.thingsboard.server.config.annotations.ApiOperation;
&nbsp;import org.thingsboard.server.exception.ToErrorResponseEntity;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.security.permission.Operation;
&nbsp;
&nbsp;import java.util.UUID;
&nbsp;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.DEVICE_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.DEVICE_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.MARKDOWN_CODE_BLOCK_END;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.MARKDOWN_CODE_BLOCK_START;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_NUMBER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_SIZE_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.RPC_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.RPC_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.RPC_TEXT_SEARCH_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_ORDER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_PROPERTY_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;
&nbsp;@RestController
&nbsp;@TbCoreComponent
&nbsp;@RequestMapping(TbUrlConstants.RPC_V2_URL_PREFIX)
<b class="nc">&nbsp;@Slf4j</b>
<b class="nc">&nbsp;public class RpcV2Controller extends AbstractRpcController {</b>
&nbsp;
&nbsp;    private static final String RPC_REQUEST_DESCRIPTION = &quot;Sends the one-way remote-procedure call (RPC) request to device. &quot; +
&nbsp;            &quot;The RPC call is A JSON that contains the method name (&#39;method&#39;), parameters (&#39;params&#39;) and multiple optional fields. &quot; +
&nbsp;            &quot;See example below. We will review the properties of the RPC call one-by-one below. &quot; +
&nbsp;            &quot;\n\n&quot; + MARKDOWN_CODE_BLOCK_START +
&nbsp;            &quot;{\n&quot; +
&nbsp;            &quot;  \&quot;method\&quot;: \&quot;setGpio\&quot;,\n&quot; +
&nbsp;            &quot;  \&quot;params\&quot;: {\n&quot; +
&nbsp;            &quot;    \&quot;pin\&quot;: 7,\n&quot; +
&nbsp;            &quot;    \&quot;value\&quot;: 1\n&quot; +
&nbsp;            &quot;  },\n&quot; +
&nbsp;            &quot;  \&quot;persistent\&quot;: false,\n&quot; +
&nbsp;            &quot;  \&quot;timeout\&quot;: 5000\n&quot; +
&nbsp;            &quot;}&quot; +
&nbsp;            MARKDOWN_CODE_BLOCK_END +
&nbsp;            &quot;\n\n### Server-side RPC structure\n&quot; +
&nbsp;            &quot;\n&quot; +
&nbsp;            &quot;The body of server-side RPC request consists of multiple fields:\n&quot; +
&nbsp;            &quot;\n&quot; +
&nbsp;            &quot;* **method** - mandatory, name of the method to distinct the RPC calls.\n&quot; +
&nbsp;            &quot;  For example, \&quot;getCurrentTime\&quot; or \&quot;getWeatherForecast\&quot;. The value of the parameter is a string.\n&quot; +
&nbsp;            &quot;* **params** - mandatory, parameters used for processing of the request. The value is a JSON. Leave empty JSON \&quot;{}\&quot; if no parameters needed.\n&quot; +
&nbsp;            &quot;* **timeout** - optional, value of the processing timeout in milliseconds. The default value is 10000 (10 seconds). The minimum value is 5000 (5 seconds).\n&quot; +
&nbsp;            &quot;* **expirationTime** - optional, value of the epoch time (in milliseconds, UTC timezone). Overrides **timeout** if present.\n&quot; +
&nbsp;            &quot;* **persistent** - optional, indicates persistent RPC. The default value is \&quot;false\&quot;.\n&quot; +
&nbsp;            &quot;* **retries** - optional, defines how many times persistent RPC will be re-sent in case of failures on the network and/or device side.\n&quot; +
&nbsp;            &quot;* **additionalInfo** - optional, defines metadata for the persistent RPC that will be added to the persistent RPC events.&quot;;
&nbsp;
&nbsp;    private static final String ONE_WAY_RPC_RESULT = &quot;\n\n### RPC Result\n&quot; +
&nbsp;            &quot;In case of persistent RPC, the result of this call is &#39;rpcId&#39; UUID. In case of lightweight RPC, &quot; +
&nbsp;            &quot;the result of this call is either 200 OK if the message was sent to device, or 504 Gateway Timeout if device is offline.&quot;;
&nbsp;
&nbsp;    private static final String TWO_WAY_RPC_RESULT = &quot;\n\n### RPC Result\n&quot; +
&nbsp;            &quot;In case of persistent RPC, the result of this call is &#39;rpcId&#39; UUID. In case of lightweight RPC, &quot; +
&nbsp;            &quot;the result of this call is the response from device, or 504 Gateway Timeout if device is offline.&quot;;
&nbsp;
&nbsp;    private static final String ONE_WAY_RPC_REQUEST_DESCRIPTION = &quot;Sends the one-way remote-procedure call (RPC) request to device. &quot; + RPC_REQUEST_DESCRIPTION + ONE_WAY_RPC_RESULT + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;
&nbsp;    private static final String TWO_WAY_RPC_REQUEST_DESCRIPTION = &quot;Sends the two-way remote-procedure call (RPC) request to device. &quot; + RPC_REQUEST_DESCRIPTION + TWO_WAY_RPC_RESULT + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Send one-way RPC request&quot;, notes = ONE_WAY_RPC_REQUEST_DESCRIPTION)
&nbsp;    @ApiResponses(value = {
&nbsp;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Persistent RPC request was saved to the database or lightweight RPC request was sent to the device.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid structure of the request.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;401&quot;, description = &quot;User is not authorized to send the RPC request. Most likely, User belongs to different Customer or Tenant.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;413&quot;, description = &quot;Request payload is too large&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;504&quot;, description = &quot;Timeout to process the RPC call. Most likely, device is offline.&quot;),
&nbsp;    })
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/oneway/{deviceId}&quot;, method = RequestMethod.POST)
&nbsp;    @ResponseBody
&nbsp;    public DeferredResult&lt;ResponseEntity&gt; handleOneWayDeviceRPCRequest(
&nbsp;            @Parameter(description = DEVICE_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(&quot;deviceId&quot;) String deviceIdStr,
&nbsp;            @Parameter(description = &quot;A JSON value representing the RPC request.&quot;)
&nbsp;            @RequestBody String requestBody) throws ThingsboardException {
<b class="nc">&nbsp;        return handleDeviceRPCRequest(true, new DeviceId(UUID.fromString(deviceIdStr)), requestBody, HttpStatus.GATEWAY_TIMEOUT, HttpStatus.GATEWAY_TIMEOUT);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Send two-way RPC request&quot;, notes = TWO_WAY_RPC_REQUEST_DESCRIPTION)
&nbsp;    @ApiResponses(value = {
&nbsp;            @ApiResponse(responseCode = &quot;200&quot;, description = &quot;Persistent RPC request was saved to the database or lightweight RPC response received.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;400&quot;, description = &quot;Invalid structure of the request.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;401&quot;, description = &quot;User is not authorized to send the RPC request. Most likely, User belongs to different Customer or Tenant.&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;413&quot;, description = &quot;Request payload is too large&quot;),
&nbsp;            @ApiResponse(responseCode = &quot;504&quot;, description = &quot;Timeout to process the RPC call. Most likely, device is offline.&quot;),
&nbsp;    })
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/twoway/{deviceId}&quot;, method = RequestMethod.POST)
&nbsp;    @ResponseBody
&nbsp;    public DeferredResult&lt;ResponseEntity&gt; handleTwoWayDeviceRPCRequest(
&nbsp;            @Parameter(description = DEVICE_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DEVICE_ID) String deviceIdStr,
&nbsp;            @Parameter(description = &quot;A JSON value representing the RPC request.&quot;)
&nbsp;            @RequestBody String requestBody) throws ThingsboardException {
<b class="nc">&nbsp;        return handleDeviceRPCRequest(false, new DeviceId(UUID.fromString(deviceIdStr)), requestBody, HttpStatus.GATEWAY_TIMEOUT, HttpStatus.GATEWAY_TIMEOUT);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get persistent RPC request&quot;, notes = &quot;Get information about the status of the RPC call.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/persistent/{rpcId}&quot;, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public Rpc getPersistedRpc(
&nbsp;            @Parameter(description = RPC_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(RPC_ID) String strRpc) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;RpcId&quot;, strRpc);</b>
<b class="nc">&nbsp;        RpcId rpcId = new RpcId(UUID.fromString(strRpc));</b>
<b class="nc">&nbsp;        return checkRpcId(rpcId, Operation.READ);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get persistent RPC requests&quot;, notes = &quot;Allows to query RPC calls for specific device using pagination.&quot; + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/persistent/device/{deviceId}&quot;, method = RequestMethod.GET)
&nbsp;    @ResponseBody
&nbsp;    public DeferredResult&lt;ResponseEntity&gt; getPersistedRpcByDevice(
&nbsp;            @Parameter(description = DEVICE_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(DEVICE_ID) String strDeviceId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = &quot;Status of the RPC&quot;, schema = @Schema(allowableValues = {&quot;QUEUED&quot;, &quot;SENT&quot;, &quot;DELIVERED&quot;, &quot;SUCCESSFUL&quot;, &quot;TIMEOUT&quot;, &quot;EXPIRED&quot;, &quot;FAILED&quot;}))
&nbsp;            @RequestParam(required = false) RpcStatus rpcStatus,
&nbsp;            @Parameter(description = RPC_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;expirationTime&quot;, &quot;request&quot;, &quot;response&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;DeviceId&quot;, strDeviceId);</b>
<b class="nc">&nbsp;        if (rpcStatus != null &amp;&amp; rpcStatus.equals(RpcStatus.DELETED)) {</b>
<b class="nc">&nbsp;            throw new ResponseStatusException(HttpStatus.BAD_REQUEST, &quot;RpcStatus: DELETED&quot;);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        DeviceId deviceId = new DeviceId(UUID.fromString(strDeviceId));</b>
<b class="nc">&nbsp;        final DeferredResult&lt;ResponseEntity&gt; response = new DeferredResult&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;        accessValidator.validate(getCurrentUser(), Operation.RPC_CALL, deviceId, new HttpValidationCallback(response, new FutureCallback&lt;&gt;() {</b>
&nbsp;            @Override
&nbsp;            public void onSuccess(@Nullable DeferredResult&lt;ResponseEntity&gt; result) {
&nbsp;                PageData&lt;Rpc&gt; rpcCalls;
<b class="nc">&nbsp;                if (rpcStatus != null) {</b>
<b class="nc">&nbsp;                    rpcCalls = rpcService.findAllByDeviceIdAndStatus(tenantId, deviceId, rpcStatus, pageLink);</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    rpcCalls = rpcService.findAllByDeviceId(tenantId, deviceId, pageLink);</b>
&nbsp;                }
<b class="nc">&nbsp;                response.setResult(new ResponseEntity&lt;&gt;(rpcCalls, HttpStatus.OK));</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void onFailure(Throwable e) {
&nbsp;                ResponseEntity entity;
<b class="nc">&nbsp;                if (e instanceof ToErrorResponseEntity) {</b>
<b class="nc">&nbsp;                    entity = ((ToErrorResponseEntity) e).toErrorResponseEntity();</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    entity = new ResponseEntity(HttpStatus.UNAUTHORIZED);</b>
&nbsp;                }
<b class="nc">&nbsp;                response.setResult(entity);</b>
&nbsp;            }
&nbsp;        }));
<b class="nc">&nbsp;        return response;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete persistent RPC&quot;, notes = &quot;Deletes the persistent RPC request.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @RequestMapping(value = &quot;/persistent/{rpcId}&quot;, method = RequestMethod.DELETE)
&nbsp;    @ResponseBody
&nbsp;    public void deleteRpc(
&nbsp;            @Parameter(description = RPC_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(RPC_ID) String strRpc) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;RpcId&quot;, strRpc);</b>
<b class="nc">&nbsp;        RpcId rpcId = new RpcId(UUID.fromString(strRpc));</b>
<b class="nc">&nbsp;        Rpc rpc = checkRpcId(rpcId, Operation.DELETE);</b>
&nbsp;
<b class="nc">&nbsp;        if (rpc != null) {</b>
<b class="nc">&nbsp;            if (rpc.getStatus().isPushDeleteNotificationToCore()) {</b>
<b class="nc">&nbsp;                RemoveRpcActorMsg removeMsg = new RemoveRpcActorMsg(getTenantId(), rpc.getDeviceId(), rpc.getUuidId());</b>
<b class="nc">&nbsp;                log.trace(&quot;[{}] Forwarding msg {} to queue actor!&quot;, rpc.getDeviceId(), rpc);</b>
<b class="nc">&nbsp;                tbClusterService.pushMsgToCore(removeMsg, null);</b>
&nbsp;            }
&nbsp;
<b class="nc">&nbsp;            rpcService.deleteRpc(getTenantId(), rpcId);</b>
<b class="nc">&nbsp;            rpc.setStatus(RpcStatus.DELETED);</b>
&nbsp;
<b class="nc">&nbsp;            TbMsg msg = TbMsg.newMsg()</b>
<b class="nc">&nbsp;                    .type(TbMsgType.RPC_DELETED)</b>
<b class="nc">&nbsp;                    .originator(rpc.getDeviceId())</b>
<b class="nc">&nbsp;                    .copyMetaData(TbMsgMetaData.EMPTY)</b>
<b class="nc">&nbsp;                    .data(JacksonUtil.toString(rpc))</b>
<b class="nc">&nbsp;                    .build();</b>
<b class="nc">&nbsp;            tbClusterService.pushMsgToRuleEngine(getTenantId(), rpc.getDeviceId(), msg, null);</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
