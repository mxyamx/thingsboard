<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > DashboardController</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.controller</a>
</div>

<h1>Coverage Summary for Class: DashboardController (org.thingsboard.server.controller)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DashboardController</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/28)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/50)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/171)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.controller;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.JsonNode;
&nbsp;import com.fasterxml.jackson.databind.node.ObjectNode;
&nbsp;import io.swagger.v3.oas.annotations.Parameter;
&nbsp;import io.swagger.v3.oas.annotations.media.ArraySchema;
&nbsp;import io.swagger.v3.oas.annotations.media.Content;
&nbsp;import io.swagger.v3.oas.annotations.media.ExampleObject;
&nbsp;import io.swagger.v3.oas.annotations.media.Schema;
&nbsp;import io.swagger.v3.oas.annotations.responses.ApiResponse;
&nbsp;import jakarta.servlet.http.HttpServletResponse;
&nbsp;import lombok.RequiredArgsConstructor;
&nbsp;import org.springframework.beans.factory.annotation.Value;
&nbsp;import org.springframework.http.HttpHeaders;
&nbsp;import org.springframework.http.HttpStatus;
&nbsp;import org.springframework.security.access.prepost.PreAuthorize;
&nbsp;import org.springframework.web.bind.annotation.DeleteMapping;
&nbsp;import org.springframework.web.bind.annotation.GetMapping;
&nbsp;import org.springframework.web.bind.annotation.PathVariable;
&nbsp;import org.springframework.web.bind.annotation.PostMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestBody;
&nbsp;import org.springframework.web.bind.annotation.RequestHeader;
&nbsp;import org.springframework.web.bind.annotation.RequestMapping;
&nbsp;import org.springframework.web.bind.annotation.RequestParam;
&nbsp;import org.springframework.web.bind.annotation.ResponseStatus;
&nbsp;import org.springframework.web.bind.annotation.RestController;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.Customer;
&nbsp;import org.thingsboard.server.common.data.Dashboard;
&nbsp;import org.thingsboard.server.common.data.DashboardInfo;
&nbsp;import org.thingsboard.server.common.data.HomeDashboard;
&nbsp;import org.thingsboard.server.common.data.HomeDashboardInfo;
&nbsp;import org.thingsboard.server.common.data.Tenant;
&nbsp;import org.thingsboard.server.common.data.User;
&nbsp;import org.thingsboard.server.common.data.edge.Edge;
&nbsp;import org.thingsboard.server.common.data.exception.ThingsboardException;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.DashboardId;
&nbsp;import org.thingsboard.server.common.data.id.EdgeId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.page.PageData;
&nbsp;import org.thingsboard.server.common.data.page.PageLink;
&nbsp;import org.thingsboard.server.config.annotations.ApiOperation;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.entitiy.dashboard.TbDashboardService;
&nbsp;import org.thingsboard.server.service.resource.TbResourceService;
&nbsp;import org.thingsboard.server.service.security.model.SecurityUser;
&nbsp;import org.thingsboard.server.service.security.permission.Operation;
&nbsp;import org.thingsboard.server.service.security.permission.Resource;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.UUID;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static org.springframework.http.MediaType.APPLICATION_JSON_VALUE;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.CUSTOMER_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.CUSTOMER_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.DASHBOARD_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.DASHBOARD_TEXT_SEARCH_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_ASSIGN_ASYNC_FIRST_STEP_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_ASSIGN_RECEIVE_STEP_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_UNASSIGN_ASYNC_FIRST_STEP_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.EDGE_UNASSIGN_RECEIVE_STEP_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.INCLUDE_RESOURCES;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.INCLUDE_RESOURCES_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_DATA_PARAMETERS;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_NUMBER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.PAGE_SIZE_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_ORDER_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SORT_PROPERTY_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.SYSTEM_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_ID;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_ID_PARAM_DESCRIPTION;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH;
&nbsp;import static org.thingsboard.server.controller.ControllerConstants.UUID_WIKI_LINK;
&nbsp;
&nbsp;@RestController
&nbsp;@TbCoreComponent
&nbsp;@RequiredArgsConstructor
&nbsp;@RequestMapping(&quot;/api&quot;)
&nbsp;public class DashboardController extends BaseController {
&nbsp;
&nbsp;    private final TbDashboardService tbDashboardService;
&nbsp;    private final TbResourceService tbResourceService;
&nbsp;
&nbsp;    public static final String DASHBOARD_ID = &quot;dashboardId&quot;;
&nbsp;    private static final String HOME_DASHBOARD_ID = &quot;homeDashboardId&quot;;
&nbsp;    private static final String HOME_DASHBOARD_HIDE_TOOLBAR = &quot;homeDashboardHideToolbar&quot;;
&nbsp;    public static final String DASHBOARD_INFO_DEFINITION = &quot;The Dashboard Info object contains lightweight information about the dashboard (e.g. title, image, assigned customers) but does not contain the heavyweight configuration JSON.&quot;;
&nbsp;    public static final String DASHBOARD_DEFINITION = &quot;The Dashboard object is a heavyweight object that contains information about the dashboard (e.g. title, image, assigned customers) and also configuration JSON (e.g. layouts, widgets, entity aliases).&quot;;
&nbsp;    public static final String HIDDEN_FOR_MOBILE = &quot;Exclude dashboards that are hidden for mobile&quot;;
&nbsp;
&nbsp;    @Value(&quot;${ui.dashboard.max_datapoints_limit}&quot;)
&nbsp;    private long maxDatapointsLimit;
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get server time (getServerTime)&quot;,
&nbsp;            notes = &quot;Get the server time (milliseconds since January 1, 1970 UTC). &quot; +
&nbsp;                    &quot;Used to adjust view of the dashboards according to the difference between browser and server time.&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/serverTime&quot;)
&nbsp;    @ApiResponse(responseCode = &quot;200&quot;, description = &quot;OK&quot;, content = @Content(mediaType = &quot;application/json&quot;, examples = @ExampleObject(value = &quot;1636023857137&quot;)))
&nbsp;    public long getServerTime() {
<b class="nc">&nbsp;        return System.currentTimeMillis();</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get max data points limit (getMaxDatapointsLimit)&quot;,
&nbsp;            notes = &quot;Get the maximum number of data points that dashboard may request from the server per in a single subscription command. &quot; +
&nbsp;                    &quot;This value impacts the time window behavior. It impacts &#39;Max values&#39; parameter in case user selects &#39;None&#39; as &#39;Data aggregation function&#39;. &quot; +
&nbsp;                    &quot;It also impacts the &#39;Grouping interval&#39; in case of any other &#39;Data aggregation function&#39; is selected. &quot; +
&nbsp;                    &quot;The actual value of the limit is configurable in the system configuration file.&quot;)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/maxDatapointsLimit&quot;)
&nbsp;    @ApiResponse(responseCode = &quot;200&quot;, description = &quot;OK&quot;, content = @Content(mediaType = &quot;application/json&quot;, examples = @ExampleObject(value = &quot;5000&quot;)))
&nbsp;    public long getMaxDatapointsLimit() {
<b class="nc">&nbsp;        return maxDatapointsLimit;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Dashboard Info (getDashboardInfoById)&quot;,
&nbsp;            notes = &quot;Get the information about the dashboard based on &#39;dashboardId&#39; parameter. &quot; + DASHBOARD_INFO_DEFINITION)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/info/{dashboardId}&quot;)
&nbsp;    public DashboardInfo getDashboardInfoById(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        return checkDashboardInfoId(dashboardId, Operation.READ);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Dashboard (getDashboardById)&quot;,
&nbsp;            notes = &quot;Get the dashboard based on &#39;dashboardId&#39; parameter. &quot; + DASHBOARD_DEFINITION + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH
&nbsp;    )
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/{dashboardId}&quot;)
&nbsp;    public void getDashboardById(@Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;                                 @PathVariable(DASHBOARD_ID) String strDashboardId,
&nbsp;                                 @Parameter(description = INCLUDE_RESOURCES_DESCRIPTION)
&nbsp;                                 @RequestParam(value = INCLUDE_RESOURCES, required = false) boolean includeResources,
&nbsp;                                 @RequestHeader(name = HttpHeaders.ACCEPT_ENCODING, required = false) String acceptEncodingHeader,
&nbsp;                                 HttpServletResponse response) throws Exception {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.READ);</b>
<b class="nc">&nbsp;        if (includeResources) {</b>
<b class="nc">&nbsp;            dashboard.setResources(tbResourceService.exportResources(dashboard, getCurrentUser()));</b>
&nbsp;        }
<b class="nc">&nbsp;        response.setContentType(APPLICATION_JSON_VALUE);</b>
<b class="nc">&nbsp;        compressResponseWithGzipIFAccepted(acceptEncodingHeader, response, JacksonUtil.writeValueAsBytes(dashboard));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Create Or Update Dashboard (saveDashboard)&quot;,
&nbsp;            notes = &quot;Create or update the Dashboard. When creating dashboard, platform generates Dashboard Id as &quot; + UUID_WIKI_LINK +
&nbsp;                    &quot;The newly created Dashboard id will be present in the response. &quot; +
&nbsp;                    &quot;Specify existing Dashboard id to update the dashboard. &quot; +
&nbsp;                    &quot;Referencing non-existing dashboard Id will cause &#39;Not Found&#39; error. &quot; +
&nbsp;                    &quot;Remove &#39;id&#39;, &#39;tenantId&#39; and optionally &#39;customerId&#39; from the request body example (below) to create new Dashboard entity. &quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/dashboard&quot;)
&nbsp;    public void saveDashboard(@io.swagger.v3.oas.annotations.parameters.RequestBody(description = &quot;A JSON value representing the dashboard.&quot;)
&nbsp;                              @RequestBody Dashboard dashboard,
&nbsp;                              @RequestHeader(name = HttpHeaders.ACCEPT_ENCODING, required = false) String acceptEncodingHeader,
&nbsp;                              HttpServletResponse response) throws Exception {
<b class="nc">&nbsp;        dashboard.setTenantId(getTenantId());</b>
<b class="nc">&nbsp;        checkEntity(dashboard.getId(), dashboard, Resource.DASHBOARD);</b>
<b class="nc">&nbsp;        var savedDashboard = tbDashboardService.save(dashboard, getCurrentUser());</b>
<b class="nc">&nbsp;        response.setContentType(APPLICATION_JSON_VALUE);</b>
<b class="nc">&nbsp;        compressResponseWithGzipIFAccepted(acceptEncodingHeader, response, JacksonUtil.writeValueAsBytes(savedDashboard));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Delete the Dashboard (deleteDashboard)&quot;,
&nbsp;            notes = &quot;Delete the Dashboard.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/dashboard/{dashboardId}&quot;)
&nbsp;    public void deleteDashboard(@Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;                                @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.DELETE);</b>
<b class="nc">&nbsp;        tbDashboardService.delete(dashboard, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Assign the Dashboard (assignDashboardToCustomer)&quot;,
&nbsp;            notes = &quot;Assign the Dashboard to specified Customer or do nothing if the Dashboard is already assigned to that Customer. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/customer/{customerId}/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard assignDashboardToCustomer(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId,
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
&nbsp;
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.READ);</b>
&nbsp;
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.ASSIGN_TO_CUSTOMER);</b>
<b class="nc">&nbsp;        return tbDashboardService.assignDashboardToCustomer(dashboard, customer, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Unassign the Dashboard (unassignDashboardFromCustomer)&quot;,
&nbsp;            notes = &quot;Unassign the Dashboard from specified Customer or do nothing if the Dashboard is already assigned to that Customer. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/customer/{customerId}/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard unassignDashboardFromCustomer(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId,
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;customerId&quot;, strCustomerId);</b>
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        Customer customer = checkCustomerId(customerId, Operation.READ);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.UNASSIGN_FROM_CUSTOMER);</b>
<b class="nc">&nbsp;        return tbDashboardService.unassignDashboardFromCustomer(dashboard, customer, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Update the Dashboard Customers (updateDashboardCustomers)&quot;,
&nbsp;            notes = &quot;Updates the list of Customers that this Dashboard is assigned to. Removes previous assignments to customers that are not in the provided list. &quot; +
&nbsp;                    &quot;Returns the Dashboard object. &quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/dashboard/{dashboardId}/customers&quot;)
&nbsp;    public Dashboard updateDashboardCustomers(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId,
&nbsp;            @Parameter(description = &quot;JSON array with the list of customer ids, or empty to remove all customers&quot;)
&nbsp;            @RequestBody(required = false) String[] strCustomerIds) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.ASSIGN_TO_CUSTOMER);</b>
<b class="nc">&nbsp;        Set&lt;CustomerId&gt; customerIds = customerIdFromStr(strCustomerIds);</b>
<b class="nc">&nbsp;        return tbDashboardService.updateDashboardCustomers(dashboard, customerIds, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Adds the Dashboard Customers (addDashboardCustomers)&quot;,
&nbsp;            notes = &quot;Adds the list of Customers to the existing list of assignments for the Dashboard. Keeps previous assignments to customers that are not in the provided list. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/dashboard/{dashboardId}/customers/add&quot;)
&nbsp;    public Dashboard addDashboardCustomers(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId,
&nbsp;            @Parameter(description = &quot;JSON array with the list of customer ids&quot;)
&nbsp;            @RequestBody String[] strCustomerIds) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.ASSIGN_TO_CUSTOMER);</b>
<b class="nc">&nbsp;        Set&lt;CustomerId&gt; customerIds = customerIdFromStr(strCustomerIds);</b>
<b class="nc">&nbsp;        return tbDashboardService.addDashboardCustomers(dashboard, customerIds, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Remove the Dashboard Customers (removeDashboardCustomers)&quot;,
&nbsp;            notes = &quot;Removes the list of Customers from the existing list of assignments for the Dashboard. Keeps other assignments to customers that are not in the provided list. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/dashboard/{dashboardId}/customers/remove&quot;)
&nbsp;    public Dashboard removeDashboardCustomers(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId,
&nbsp;            @Parameter(description = &quot;JSON array with the list of customer ids&quot;)
&nbsp;            @RequestBody String[] strCustomerIds) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.UNASSIGN_FROM_CUSTOMER);</b>
<b class="nc">&nbsp;        Set&lt;CustomerId&gt; customerIds = customerIdFromStr(strCustomerIds);</b>
<b class="nc">&nbsp;        return tbDashboardService.removeDashboardCustomers(dashboard, customerIds, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Assign the Dashboard to Public Customer (assignDashboardToPublicCustomer)&quot;,
&nbsp;            notes = &quot;Assigns the dashboard to a special, auto-generated &#39;Public&#39; Customer. Once assigned, unauthenticated users may browse the dashboard. &quot; +
&nbsp;                    &quot;This method is useful if you like to embed the dashboard on public web pages to be available for users that are not logged in. &quot; +
&nbsp;                    &quot;Be aware that making the dashboard public does not mean that it automatically makes all devices and assets you use in the dashboard to be public.&quot; +
&nbsp;                    &quot;Use [assign Asset to Public Customer](#!/asset-controller/assignAssetToPublicCustomerUsingPOST) and &quot; +
&nbsp;                    &quot;[assign Device to Public Customer](#!/device-controller/assignDeviceToPublicCustomerUsingPOST) for this purpose. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/customer/public/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard assignDashboardToPublicCustomer(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.ASSIGN_TO_CUSTOMER);</b>
<b class="nc">&nbsp;        return tbDashboardService.assignDashboardToPublicCustomer(dashboard, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Unassign the Dashboard from Public Customer (unassignDashboardFromPublicCustomer)&quot;,
&nbsp;            notes = &quot;Unassigns the dashboard from a special, auto-generated &#39;Public&#39; Customer. Once unassigned, unauthenticated users may no longer browse the dashboard. &quot; +
&nbsp;                    &quot;Returns the Dashboard object.&quot; + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/customer/public/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard unassignDashboardFromPublicCustomer(
&nbsp;            @Parameter(description = DASHBOARD_ID_PARAM_DESCRIPTION)
&nbsp;            @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.UNASSIGN_FROM_CUSTOMER);</b>
<b class="nc">&nbsp;        return tbDashboardService.unassignDashboardFromPublicCustomer(dashboard, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Tenant Dashboards by System Administrator (getTenantDashboards)&quot;,
&nbsp;            notes = &quot;Returns a page of dashboard info objects owned by tenant. &quot; + DASHBOARD_INFO_DEFINITION + &quot; &quot; + PAGE_DATA_PARAMETERS +
&nbsp;                    SYSTEM_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;SYS_ADMIN&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/tenant/{tenantId}/dashboards&quot;, params = {&quot;pageSize&quot;, &quot;page&quot;})
&nbsp;    public PageData&lt;DashboardInfo&gt; getTenantDashboards(
&nbsp;            @Parameter(description = TENANT_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(TENANT_ID) String strTenantId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = DASHBOARD_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;title&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        TenantId tenantId = TenantId.fromUUID(toUUID(strTenantId));</b>
<b class="nc">&nbsp;        checkTenantId(tenantId, Operation.READ);</b>
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        return checkNotNull(dashboardService.findDashboardsByTenantId(tenantId, pageLink));</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Tenant Dashboards (getTenantDashboards)&quot;,
&nbsp;            notes = &quot;Returns a page of dashboard info objects owned by the tenant of a current user. &quot;
&nbsp;                    + DASHBOARD_INFO_DEFINITION + &quot; &quot; + PAGE_DATA_PARAMETERS + TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/tenant/dashboards&quot;, params = {&quot;pageSize&quot;, &quot;page&quot;})
&nbsp;    public PageData&lt;DashboardInfo&gt; getTenantDashboards(
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = HIDDEN_FOR_MOBILE)
&nbsp;            @RequestParam(required = false) Boolean mobile,
&nbsp;            @Parameter(description = DASHBOARD_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;title&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        if (mobile != null &amp;&amp; mobile) {</b>
<b class="nc">&nbsp;            return checkNotNull(dashboardService.findMobileDashboardsByTenantId(tenantId, pageLink));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return checkNotNull(dashboardService.findDashboardsByTenantId(tenantId, pageLink));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Customer Dashboards (getCustomerDashboards)&quot;,
&nbsp;            notes = &quot;Returns a page of dashboard info objects owned by the specified customer. &quot;
&nbsp;                    + DASHBOARD_INFO_DEFINITION + &quot; &quot; + PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/customer/{customerId}/dashboards&quot;, params = {&quot;pageSize&quot;, &quot;page&quot;})
&nbsp;    public PageData&lt;DashboardInfo&gt; getCustomerDashboards(
&nbsp;            @Parameter(description = CUSTOMER_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(CUSTOMER_ID) String strCustomerId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = HIDDEN_FOR_MOBILE)
&nbsp;            @RequestParam(required = false) Boolean mobile,
&nbsp;            @Parameter(description = DASHBOARD_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;title&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(CUSTOMER_ID, strCustomerId);</b>
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        CustomerId customerId = new CustomerId(toUUID(strCustomerId));</b>
<b class="nc">&nbsp;        checkCustomerId(customerId, Operation.READ);</b>
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        if (mobile != null &amp;&amp; mobile) {</b>
<b class="nc">&nbsp;            return checkNotNull(dashboardService.findMobileDashboardsByTenantIdAndCustomerId(tenantId, customerId, pageLink));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return checkNotNull(dashboardService.findDashboardsByTenantIdAndCustomerId(tenantId, customerId, pageLink));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Home Dashboard (getHomeDashboard)&quot;,
&nbsp;            notes = &quot;Returns the home dashboard object that is configured as &#39;homeDashboardId&#39; parameter in the &#39;additionalInfo&#39; of the User. &quot; +
&nbsp;                    &quot;If &#39;homeDashboardId&#39; parameter is not set on the User level and the User has authority &#39;CUSTOMER_USER&#39;, check the same parameter for the corresponding Customer. &quot; +
&nbsp;                    &quot;If &#39;homeDashboardId&#39; parameter is not set on the User and Customer levels then checks the same parameter for the Tenant that owns the user. &quot;
&nbsp;                    + DASHBOARD_DEFINITION + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/home&quot;)
&nbsp;    public void getHomeDashboard(@RequestHeader(name = HttpHeaders.ACCEPT_ENCODING, required = false) String acceptEncodingHeader,
&nbsp;                                 HttpServletResponse response) throws Exception {
<b class="nc">&nbsp;        SecurityUser securityUser = getCurrentUser();</b>
<b class="nc">&nbsp;        response.setContentType(APPLICATION_JSON_VALUE);</b>
<b class="nc">&nbsp;        if (securityUser.isSystemAdmin()) {</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        User user = userService.findUserById(securityUser.getTenantId(), securityUser.getId());</b>
<b class="nc">&nbsp;        JsonNode additionalInfo = user.getAdditionalInfo();</b>
&nbsp;        HomeDashboard homeDashboard;
<b class="nc">&nbsp;        homeDashboard = extractHomeDashboardFromAdditionalInfo(additionalInfo);</b>
<b class="nc">&nbsp;        if (homeDashboard == null) {</b>
<b class="nc">&nbsp;            if (securityUser.isCustomerUser()) {</b>
<b class="nc">&nbsp;                Customer customer = customerService.findCustomerById(securityUser.getTenantId(), securityUser.getCustomerId());</b>
<b class="nc">&nbsp;                additionalInfo = customer.getAdditionalInfo();</b>
<b class="nc">&nbsp;                homeDashboard = extractHomeDashboardFromAdditionalInfo(additionalInfo);</b>
&nbsp;            }
<b class="nc">&nbsp;            if (homeDashboard == null) {</b>
<b class="nc">&nbsp;                Tenant tenant = tenantService.findTenantById(securityUser.getTenantId());</b>
<b class="nc">&nbsp;                additionalInfo = tenant.getAdditionalInfo();</b>
<b class="nc">&nbsp;                homeDashboard = extractHomeDashboardFromAdditionalInfo(additionalInfo);</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        if (homeDashboard != null) {</b>
<b class="nc">&nbsp;            compressResponseWithGzipIFAccepted(acceptEncodingHeader, response, JacksonUtil.writeValueAsBytes(homeDashboard));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Home Dashboard Info (getHomeDashboardInfo)&quot;,
&nbsp;            notes = &quot;Returns the home dashboard info object that is configured as &#39;homeDashboardId&#39; parameter in the &#39;additionalInfo&#39; of the User. &quot; +
&nbsp;                    &quot;If &#39;homeDashboardId&#39; parameter is not set on the User level and the User has authority &#39;CUSTOMER_USER&#39;, check the same parameter for the corresponding Customer. &quot; +
&nbsp;                    &quot;If &#39;homeDashboardId&#39; parameter is not set on the User and Customer levels then checks the same parameter for the Tenant that owns the user. &quot; +
&nbsp;                    TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;SYS_ADMIN&#39;, &#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboard/home/info&quot;)
&nbsp;    public HomeDashboardInfo getHomeDashboardInfo() throws ThingsboardException {
<b class="nc">&nbsp;        SecurityUser securityUser = getCurrentUser();</b>
<b class="nc">&nbsp;        if (securityUser.isSystemAdmin()) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        User user = userService.findUserById(securityUser.getTenantId(), securityUser.getId());</b>
<b class="nc">&nbsp;        JsonNode additionalInfo = user.getAdditionalInfo();</b>
<b class="nc">&nbsp;        return getHomeDashboardInfo(securityUser, additionalInfo);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Tenant Home Dashboard Info (getTenantHomeDashboardInfo)&quot;,
&nbsp;            notes = &quot;Returns the home dashboard info object that is configured as &#39;homeDashboardId&#39; parameter in the &#39;additionalInfo&#39; of the corresponding tenant. &quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/tenant/dashboard/home/info&quot;)
&nbsp;    public HomeDashboardInfo getTenantHomeDashboardInfo() throws ThingsboardException {
<b class="nc">&nbsp;        Tenant tenant = tenantService.findTenantById(getTenantId());</b>
<b class="nc">&nbsp;        JsonNode additionalInfo = tenant.getAdditionalInfo();</b>
<b class="nc">&nbsp;        DashboardId dashboardId = null;</b>
<b class="nc">&nbsp;        boolean hideDashboardToolbar = true;</b>
<b class="nc">&nbsp;        if (additionalInfo != null &amp;&amp; additionalInfo.has(HOME_DASHBOARD_ID) &amp;&amp; !additionalInfo.get(HOME_DASHBOARD_ID).isNull()) {</b>
<b class="nc">&nbsp;            String strDashboardId = additionalInfo.get(HOME_DASHBOARD_ID).asText();</b>
<b class="nc">&nbsp;            dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;            if (additionalInfo.has(HOME_DASHBOARD_HIDE_TOOLBAR)) {</b>
<b class="nc">&nbsp;                hideDashboardToolbar = additionalInfo.get(HOME_DASHBOARD_HIDE_TOOLBAR).asBoolean();</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return new HomeDashboardInfo(dashboardId, hideDashboardToolbar);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Update Tenant Home Dashboard Info (getTenantHomeDashboardInfo)&quot;,
&nbsp;            notes = &quot;Update the home dashboard assignment for the current tenant. &quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/tenant/dashboard/home/info&quot;)
&nbsp;    @ResponseStatus(value = HttpStatus.OK)
&nbsp;    public void setTenantHomeDashboardInfo(
&nbsp;            @Parameter(description = &quot;A JSON object that represents home dashboard id and other parameters&quot;, required = true)
&nbsp;            @RequestBody HomeDashboardInfo homeDashboardInfo) throws ThingsboardException {
&nbsp;
<b class="nc">&nbsp;        if (homeDashboardInfo.getDashboardId() != null) {</b>
<b class="nc">&nbsp;            checkDashboardId(homeDashboardInfo.getDashboardId(), Operation.READ);</b>
&nbsp;        }
<b class="nc">&nbsp;        Tenant tenant = tenantService.findTenantById(getTenantId());</b>
<b class="nc">&nbsp;        JsonNode additionalInfo = tenant.getAdditionalInfo();</b>
<b class="nc">&nbsp;        if (!(additionalInfo instanceof ObjectNode)) {</b>
<b class="nc">&nbsp;            additionalInfo = JacksonUtil.newObjectNode();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (homeDashboardInfo.getDashboardId() != null) {</b>
<b class="nc">&nbsp;            ((ObjectNode) additionalInfo).put(HOME_DASHBOARD_ID, homeDashboardInfo.getDashboardId().getId().toString());</b>
<b class="nc">&nbsp;            ((ObjectNode) additionalInfo).put(HOME_DASHBOARD_HIDE_TOOLBAR, homeDashboardInfo.isHideDashboardToolbar());</b>
&nbsp;        } else {
<b class="nc">&nbsp;            ((ObjectNode) additionalInfo).remove(HOME_DASHBOARD_ID);</b>
<b class="nc">&nbsp;            ((ObjectNode) additionalInfo).remove(HOME_DASHBOARD_HIDE_TOOLBAR);</b>
&nbsp;        }
<b class="nc">&nbsp;        tenant.setAdditionalInfo(additionalInfo);</b>
<b class="nc">&nbsp;        tenantService.saveTenant(tenant);</b>
&nbsp;    }
&nbsp;
&nbsp;    private HomeDashboard extractHomeDashboardFromAdditionalInfo(JsonNode additionalInfo) {
&nbsp;        try {
<b class="nc">&nbsp;            if (additionalInfo != null &amp;&amp; additionalInfo.has(HOME_DASHBOARD_ID) &amp;&amp; !additionalInfo.get(HOME_DASHBOARD_ID).isNull()) {</b>
<b class="nc">&nbsp;                String strDashboardId = additionalInfo.get(HOME_DASHBOARD_ID).asText();</b>
<b class="nc">&nbsp;                DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;                Dashboard dashboard = checkDashboardId(dashboardId, Operation.READ);</b>
<b class="nc">&nbsp;                boolean hideDashboardToolbar = true;</b>
<b class="nc">&nbsp;                if (additionalInfo.has(HOME_DASHBOARD_HIDE_TOOLBAR)) {</b>
<b class="nc">&nbsp;                    hideDashboardToolbar = additionalInfo.get(HOME_DASHBOARD_HIDE_TOOLBAR).asBoolean();</b>
&nbsp;                }
<b class="nc">&nbsp;                return new HomeDashboard(dashboard, hideDashboardToolbar);</b>
&nbsp;            }
&nbsp;        } catch (Exception ignored) {}
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Assign dashboard to edge (assignDashboardToEdge)&quot;,
&nbsp;            notes = &quot;Creates assignment of an existing dashboard to an instance of The Edge. &quot; +
&nbsp;                    EDGE_ASSIGN_ASYNC_FIRST_STEP_DESCRIPTION +
&nbsp;                    &quot;Second, remote edge service will receive a copy of assignment dashboard &quot; +
&nbsp;                    EDGE_ASSIGN_RECEIVE_STEP_DESCRIPTION +
&nbsp;                    &quot;Third, once dashboard will be delivered to edge service, it&#39;s going to be available for usage on remote edge instance.&quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @PostMapping(value = &quot;/edge/{edgeId}/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard assignDashboardToEdge(@PathVariable(&quot;edgeId&quot;) String strEdgeId,
&nbsp;                                           @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;edgeId&quot;, strEdgeId);</b>
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
&nbsp;
<b class="nc">&nbsp;        EdgeId edgeId = new EdgeId(toUUID(strEdgeId));</b>
<b class="nc">&nbsp;        Edge edge = checkEdgeId(edgeId, Operation.READ);</b>
&nbsp;
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        checkDashboardId(dashboardId, Operation.READ);</b>
<b class="nc">&nbsp;        return tbDashboardService.asignDashboardToEdge(getTenantId(), dashboardId, edge, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Unassign dashboard from edge (unassignDashboardFromEdge)&quot;,
&nbsp;            notes = &quot;Clears assignment of the dashboard to the edge. &quot; +
&nbsp;                    EDGE_UNASSIGN_ASYNC_FIRST_STEP_DESCRIPTION +
&nbsp;                    &quot;Second, remote edge service will receive an &#39;unassign&#39; command to remove dashboard &quot; +
&nbsp;                    EDGE_UNASSIGN_RECEIVE_STEP_DESCRIPTION +
&nbsp;                    &quot;Third, once &#39;unassign&#39; command will be delivered to edge service, it&#39;s going to remove dashboard locally.&quot; +
&nbsp;                    TENANT_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAuthority(&#39;TENANT_ADMIN&#39;)&quot;)
&nbsp;    @DeleteMapping(value = &quot;/edge/{edgeId}/dashboard/{dashboardId}&quot;)
&nbsp;    public Dashboard unassignDashboardFromEdge(@PathVariable(&quot;edgeId&quot;) String strEdgeId,
&nbsp;                                               @PathVariable(DASHBOARD_ID) String strDashboardId) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(EDGE_ID, strEdgeId);</b>
<b class="nc">&nbsp;        checkParameter(DASHBOARD_ID, strDashboardId);</b>
&nbsp;
<b class="nc">&nbsp;        EdgeId edgeId = new EdgeId(toUUID(strEdgeId));</b>
<b class="nc">&nbsp;        Edge edge = checkEdgeId(edgeId, Operation.READ);</b>
&nbsp;
<b class="nc">&nbsp;        DashboardId dashboardId = new DashboardId(toUUID(strDashboardId));</b>
<b class="nc">&nbsp;        Dashboard dashboard = checkDashboardId(dashboardId, Operation.READ);</b>
&nbsp;
<b class="nc">&nbsp;        return tbDashboardService.unassignDashboardFromEdge(dashboard, edge, getCurrentUser());</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get Edge Dashboards (getEdgeDashboards)&quot;,
&nbsp;            notes = &quot;Returns a page of dashboard info objects assigned to the specified edge. &quot;
&nbsp;                    + DASHBOARD_INFO_DEFINITION + &quot; &quot; + PAGE_DATA_PARAMETERS + TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/edge/{edgeId}/dashboards&quot;, params = {&quot;pageSize&quot;, &quot;page&quot;})
&nbsp;    public PageData&lt;DashboardInfo&gt; getEdgeDashboards(
&nbsp;            @Parameter(description = EDGE_ID_PARAM_DESCRIPTION, required = true)
&nbsp;            @PathVariable(EDGE_ID) String strEdgeId,
&nbsp;            @Parameter(description = PAGE_SIZE_DESCRIPTION, required = true)
&nbsp;            @RequestParam int pageSize,
&nbsp;            @Parameter(description = PAGE_NUMBER_DESCRIPTION, required = true)
&nbsp;            @RequestParam int page,
&nbsp;            @Parameter(description = DASHBOARD_TEXT_SEARCH_DESCRIPTION)
&nbsp;            @RequestParam(required = false) String textSearch,
&nbsp;            @Parameter(description = SORT_PROPERTY_DESCRIPTION, schema = @Schema(allowableValues = {&quot;createdTime&quot;, &quot;title&quot;}))
&nbsp;            @RequestParam(required = false) String sortProperty,
&nbsp;            @Parameter(description = SORT_ORDER_DESCRIPTION, schema = @Schema(allowableValues = {&quot;ASC&quot;, &quot;DESC&quot;}))
&nbsp;            @RequestParam(required = false) String sortOrder) throws ThingsboardException {
<b class="nc">&nbsp;        checkParameter(&quot;edgeId&quot;, strEdgeId);</b>
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        EdgeId edgeId = new EdgeId(toUUID(strEdgeId));</b>
<b class="nc">&nbsp;        checkEdgeId(edgeId, Operation.READ);</b>
<b class="nc">&nbsp;        PageLink pageLink = createPageLink(pageSize, page, textSearch, sortProperty, sortOrder);</b>
<b class="nc">&nbsp;        PageData&lt;DashboardInfo&gt; nonFilteredResult = dashboardService.findDashboardsByTenantIdAndEdgeId(tenantId, edgeId, pageLink);</b>
<b class="nc">&nbsp;        List&lt;DashboardInfo&gt; filteredDashboards = filterDashboardsByReadPermission(nonFilteredResult.getData());</b>
<b class="nc">&nbsp;        PageData&lt;DashboardInfo&gt; filteredResult = new PageData&lt;&gt;(filteredDashboards,</b>
<b class="nc">&nbsp;                nonFilteredResult.getTotalPages(),</b>
<b class="nc">&nbsp;                nonFilteredResult.getTotalElements(),</b>
<b class="nc">&nbsp;                nonFilteredResult.hasNext());</b>
<b class="nc">&nbsp;        return checkNotNull(filteredResult);</b>
&nbsp;    }
&nbsp;
&nbsp;    @ApiOperation(value = &quot;Get dashboards by Dashboard Ids (getDashboardsByIds)&quot;,
&nbsp;            notes = &quot;Returns a list of DashboardInfo objects based on the provided ids. &quot; +
&nbsp;                    TENANT_OR_CUSTOMER_AUTHORITY_PARAGRAPH)
&nbsp;    @PreAuthorize(&quot;hasAnyAuthority(&#39;TENANT_ADMIN&#39;, &#39;CUSTOMER_USER&#39;)&quot;)
&nbsp;    @GetMapping(value = &quot;/dashboards&quot;, params = {&quot;dashboardIds&quot;})
&nbsp;    public List&lt;DashboardInfo&gt; getDashboardsByIds(@Parameter(description = &quot;A list of dashboard ids, separated by comma &#39;,&#39;&quot;, array = @ArraySchema(schema = @Schema(type = &quot;string&quot;)), required = true)
&nbsp;            @RequestParam(&quot;dashboardIds&quot;) Set&lt;UUID&gt; dashboardUUIDs) throws ThingsboardException {
<b class="nc">&nbsp;        TenantId tenantId = getCurrentUser().getTenantId();</b>
<b class="nc">&nbsp;        List&lt;DashboardId&gt; dashboardIds = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (UUID dashboardUUID : dashboardUUIDs) {</b>
<b class="nc">&nbsp;            dashboardIds.add(new DashboardId(dashboardUUID));</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;DashboardInfo&gt; dashboards = dashboardService.findDashboardInfoByIds(tenantId, dashboardIds);</b>
<b class="nc">&nbsp;        return filterDashboardsByReadPermission(dashboards);</b>
&nbsp;    }
&nbsp;
&nbsp;    private Set&lt;CustomerId&gt; customerIdFromStr(String[] strCustomerIds) {
<b class="nc">&nbsp;        Set&lt;CustomerId&gt; customerIds = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;        if (strCustomerIds != null) {</b>
<b class="nc">&nbsp;            for (String strCustomerId : strCustomerIds) {</b>
<b class="nc">&nbsp;                customerIds.add(new CustomerId(UUID.fromString(strCustomerId)));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return customerIds;</b>
&nbsp;    }
&nbsp;
&nbsp;    private List&lt;DashboardInfo&gt; filterDashboardsByReadPermission(List&lt;DashboardInfo&gt; dashboards) {
<b class="nc">&nbsp;        return dashboards.stream().filter(dashboard -&gt; {</b>
&nbsp;            try {
<b class="nc">&nbsp;                return accessControlService.hasPermission(getCurrentUser(), Resource.DASHBOARD, Operation.READ, dashboard.getId(), dashboard);</b>
&nbsp;            } catch (ThingsboardException e) {
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
<b class="nc">&nbsp;        }).collect(Collectors.toList());</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
