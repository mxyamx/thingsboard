<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > DeviceEdgeProcessor</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.service.edge.rpc.processor.device</a>
</div>

<h1>Coverage Summary for Class: DeviceEdgeProcessor (org.thingsboard.server.service.edge.rpc.processor.device)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DeviceEdgeProcessor</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/37)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/109)
  </span>
</td>
</tr>
  <tr>
    <td class="name">DeviceEdgeProcessor$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">DeviceEdgeProcessor$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">DeviceEdgeProcessor$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/19)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/37)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/118)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.service.edge.rpc.processor.device;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.node.ObjectNode;
&nbsp;import com.google.common.util.concurrent.Futures;
&nbsp;import com.google.common.util.concurrent.ListenableFuture;
&nbsp;import com.google.common.util.concurrent.SettableFuture;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.data.util.Pair;
&nbsp;import org.springframework.stereotype.Component;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.DataConstants;
&nbsp;import org.thingsboard.server.common.data.Device;
&nbsp;import org.thingsboard.server.common.data.DeviceProfile;
&nbsp;import org.thingsboard.server.common.data.EdgeUtils;
&nbsp;import org.thingsboard.server.common.data.StringUtils;
&nbsp;import org.thingsboard.server.common.data.edge.Edge;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEvent;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEventActionType;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEventType;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.DeviceId;
&nbsp;import org.thingsboard.server.common.data.id.EdgeId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.msg.TbMsgType;
&nbsp;import org.thingsboard.server.common.data.rpc.RpcError;
&nbsp;import org.thingsboard.server.common.data.security.DeviceCredentials;
&nbsp;import org.thingsboard.server.common.msg.TbMsg;
&nbsp;import org.thingsboard.server.common.msg.TbMsgDataType;
&nbsp;import org.thingsboard.server.common.msg.TbMsgMetaData;
&nbsp;import org.thingsboard.server.common.msg.rpc.FromDeviceRpcResponse;
&nbsp;import org.thingsboard.server.common.msg.rpc.FromDeviceRpcResponseActorMsg;
&nbsp;import org.thingsboard.server.exception.DataValidationException;
&nbsp;import org.thingsboard.server.gen.edge.v1.DeviceCredentialsUpdateMsg;
&nbsp;import org.thingsboard.server.gen.edge.v1.DeviceRpcCallMsg;
&nbsp;import org.thingsboard.server.gen.edge.v1.DeviceUpdateMsg;
&nbsp;import org.thingsboard.server.gen.edge.v1.DownlinkMsg;
&nbsp;import org.thingsboard.server.gen.edge.v1.EdgeVersion;
&nbsp;import org.thingsboard.server.gen.edge.v1.UpdateMsgType;
&nbsp;import org.thingsboard.server.queue.TbQueueCallback;
&nbsp;import org.thingsboard.server.queue.TbQueueMsgMetadata;
&nbsp;import org.thingsboard.server.queue.util.TbCoreComponent;
&nbsp;import org.thingsboard.server.service.edge.EdgeMsgConstructorUtils;
&nbsp;
&nbsp;import java.util.UUID;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;@Component
&nbsp;@TbCoreComponent
<b class="nc">&nbsp;public class DeviceEdgeProcessor extends BaseDeviceProcessor implements DeviceProcessor {</b>
&nbsp;
&nbsp;    @Override
&nbsp;    public ListenableFuture&lt;Void&gt; processDeviceMsgFromEdge(TenantId tenantId, Edge edge, DeviceUpdateMsg deviceUpdateMsg) {
<b class="nc">&nbsp;        log.trace(&quot;[{}] executing processDeviceMsgFromEdge [{}] from edge [{}]&quot;, tenantId, deviceUpdateMsg, edge.getId());</b>
<b class="nc">&nbsp;        DeviceId deviceId = new DeviceId(new UUID(deviceUpdateMsg.getIdMSB(), deviceUpdateMsg.getIdLSB()));</b>
&nbsp;        try {
<b class="nc">&nbsp;            edgeSynchronizationManager.getEdgeId().set(edge.getId());</b>
&nbsp;
<b class="nc">&nbsp;            switch (deviceUpdateMsg.getMsgType()) {</b>
&nbsp;                case ENTITY_CREATED_RPC_MESSAGE:
&nbsp;                case ENTITY_UPDATED_RPC_MESSAGE:
<b class="nc">&nbsp;                    saveOrUpdateDevice(tenantId, deviceId, deviceUpdateMsg, edge);</b>
<b class="nc">&nbsp;                    return Futures.immediateFuture(null);</b>
&nbsp;                case ENTITY_DELETED_RPC_MESSAGE:
<b class="nc">&nbsp;                    deleteDevice(tenantId, edge, deviceId);</b>
<b class="nc">&nbsp;                    return Futures.immediateFuture(null);</b>
&nbsp;                case UNRECOGNIZED:
&nbsp;                default:
<b class="nc">&nbsp;                    return handleUnsupportedMsgType(deviceUpdateMsg.getMsgType());</b>
&nbsp;            }
&nbsp;        } catch (DataValidationException e) {
<b class="nc">&nbsp;            if (e.getMessage().contains(&quot;limit reached&quot;)) {</b>
<b class="nc">&nbsp;                log.warn(&quot;[{}] Number of allowed devices violated {}&quot;, tenantId, deviceUpdateMsg, e);</b>
<b class="nc">&nbsp;                return Futures.immediateFuture(null);</b>
&nbsp;            } else {
<b class="nc">&nbsp;                return Futures.immediateFailedFuture(e);</b>
&nbsp;            }
&nbsp;        } finally {
<b class="nc">&nbsp;            edgeSynchronizationManager.getEdgeId().remove();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public ListenableFuture&lt;Void&gt; processDeviceCredentialsMsgFromEdge(TenantId tenantId, EdgeId edgeId, DeviceCredentialsUpdateMsg deviceCredentialsUpdateMsg) {
<b class="nc">&nbsp;        log.debug(&quot;[{}] Executing processDeviceCredentialsMsgFromEdge, deviceCredentialsUpdateMsg [{}]&quot;, tenantId, deviceCredentialsUpdateMsg);</b>
&nbsp;        try {
<b class="nc">&nbsp;            edgeSynchronizationManager.getEdgeId().set(edgeId);</b>
&nbsp;
<b class="nc">&nbsp;            updateDeviceCredentials(tenantId, deviceCredentialsUpdateMsg);</b>
&nbsp;        } finally {
<b class="nc">&nbsp;            edgeSynchronizationManager.getEdgeId().remove();</b>
&nbsp;        }
<b class="nc">&nbsp;        return Futures.immediateFuture(null);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void saveOrUpdateDevice(TenantId tenantId, DeviceId deviceId, DeviceUpdateMsg deviceUpdateMsg, Edge edge) {
<b class="nc">&nbsp;        Pair&lt;Boolean, Boolean&gt; resultPair = super.saveOrUpdateDevice(tenantId, deviceId, deviceUpdateMsg);</b>
<b class="nc">&nbsp;        Boolean created = resultPair.getFirst();</b>
<b class="nc">&nbsp;        if (created) {</b>
<b class="nc">&nbsp;            createRelationFromEdge(tenantId, edge.getId(), deviceId);</b>
<b class="nc">&nbsp;            pushDeviceCreatedEventToRuleEngine(tenantId, edge, deviceId);</b>
<b class="nc">&nbsp;            edgeCtx.getDeviceService().assignDeviceToEdge(tenantId, deviceId, edge.getId());</b>
&nbsp;        }
<b class="nc">&nbsp;        Boolean deviceNameUpdated = resultPair.getSecond();</b>
<b class="nc">&nbsp;        if (deviceNameUpdated) {</b>
<b class="nc">&nbsp;            saveEdgeEvent(tenantId, edge.getId(), EdgeEventType.DEVICE, EdgeEventActionType.UPDATED, deviceId, null);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void pushDeviceCreatedEventToRuleEngine(TenantId tenantId, Edge edge, DeviceId deviceId) {
<b class="nc">&nbsp;        Device device = edgeCtx.getDeviceService().findDeviceById(tenantId, deviceId);</b>
<b class="nc">&nbsp;        pushEntityEventToRuleEngine(tenantId, edge, device, TbMsgType.ENTITY_CREATED);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public ListenableFuture&lt;Void&gt; processDeviceRpcCallFromEdge(TenantId tenantId, Edge edge, DeviceRpcCallMsg deviceRpcCallMsg) {
<b class="nc">&nbsp;        log.trace(&quot;[{}] processDeviceRpcCallFromEdge [{}]&quot;, tenantId, deviceRpcCallMsg);</b>
<b class="nc">&nbsp;        if (deviceRpcCallMsg.hasResponseMsg()) {</b>
<b class="nc">&nbsp;            return processDeviceRpcResponseFromEdge(tenantId, deviceRpcCallMsg);</b>
<b class="nc">&nbsp;        } else if (deviceRpcCallMsg.hasRequestMsg()) {</b>
<b class="nc">&nbsp;            return processDeviceRpcRequestFromEdge(tenantId, edge, deviceRpcCallMsg);</b>
&nbsp;        }
<b class="nc">&nbsp;        return Futures.immediateFuture(null);</b>
&nbsp;    }
&nbsp;
&nbsp;    private ListenableFuture&lt;Void&gt; processDeviceRpcResponseFromEdge(TenantId tenantId, DeviceRpcCallMsg deviceRpcCallMsg) {
<b class="nc">&nbsp;        SettableFuture&lt;Void&gt; futureToSet = SettableFuture.create();</b>
<b class="nc">&nbsp;        UUID requestUuid = new UUID(deviceRpcCallMsg.getRequestUuidMSB(), deviceRpcCallMsg.getRequestUuidLSB());</b>
<b class="nc">&nbsp;        DeviceId deviceId = new DeviceId(new UUID(deviceRpcCallMsg.getDeviceIdMSB(), deviceRpcCallMsg.getDeviceIdLSB()));</b>
&nbsp;
&nbsp;        FromDeviceRpcResponse response;
<b class="nc">&nbsp;        if (!StringUtils.isEmpty(deviceRpcCallMsg.getResponseMsg().getError())) {</b>
<b class="nc">&nbsp;            response = new FromDeviceRpcResponse(requestUuid, null, RpcError.valueOf(deviceRpcCallMsg.getResponseMsg().getError()));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            response = new FromDeviceRpcResponse(requestUuid, deviceRpcCallMsg.getResponseMsg().getResponse(), null);</b>
&nbsp;        }
<b class="nc">&nbsp;        TbQueueCallback callback = new TbQueueCallback() {</b>
&nbsp;            @Override
&nbsp;            public void onSuccess(TbQueueMsgMetadata metadata) {
<b class="nc">&nbsp;                futureToSet.set(null);</b>
&nbsp;            }
&nbsp;
&nbsp;            @Override
&nbsp;            public void onFailure(Throwable t) {
<b class="nc">&nbsp;                log.error(&quot;[{}] Can&#39;t process push notification to core [{}]&quot;, tenantId, deviceRpcCallMsg, t);</b>
<b class="nc">&nbsp;                futureToSet.setException(t);</b>
&nbsp;            }
&nbsp;        };
<b class="nc">&nbsp;        FromDeviceRpcResponseActorMsg msg =</b>
<b class="nc">&nbsp;                new FromDeviceRpcResponseActorMsg(deviceRpcCallMsg.getRequestId(),</b>
&nbsp;                        tenantId,
&nbsp;                        deviceId, response);
<b class="nc">&nbsp;        edgeCtx.getClusterService().pushMsgToCore(msg, callback);</b>
<b class="nc">&nbsp;        return futureToSet;</b>
&nbsp;    }
&nbsp;
&nbsp;    private ListenableFuture&lt;Void&gt; processDeviceRpcRequestFromEdge(TenantId tenantId, Edge edge, DeviceRpcCallMsg deviceRpcCallMsg) {
<b class="nc">&nbsp;        DeviceId deviceId = new DeviceId(new UUID(deviceRpcCallMsg.getDeviceIdMSB(), deviceRpcCallMsg.getDeviceIdLSB()));</b>
&nbsp;        try {
<b class="nc">&nbsp;            TbMsgMetaData metaData = new TbMsgMetaData();</b>
<b class="nc">&nbsp;            String requestId = Integer.toString(deviceRpcCallMsg.getRequestId());</b>
<b class="nc">&nbsp;            metaData.putValue(&quot;requestId&quot;, requestId);</b>
<b class="nc">&nbsp;            metaData.putValue(&quot;serviceId&quot;, deviceRpcCallMsg.getServiceId());</b>
<b class="nc">&nbsp;            metaData.putValue(&quot;sessionId&quot;, deviceRpcCallMsg.getSessionId());</b>
<b class="nc">&nbsp;            metaData.putValue(DataConstants.EDGE_ID, edge.getId().toString());</b>
<b class="nc">&nbsp;            Device device = edgeCtx.getDeviceService().findDeviceById(tenantId, deviceId);</b>
<b class="nc">&nbsp;            if (device != null) {</b>
<b class="nc">&nbsp;                metaData.putValue(&quot;deviceName&quot;, device.getName());</b>
<b class="nc">&nbsp;                metaData.putValue(&quot;deviceType&quot;, device.getType());</b>
<b class="nc">&nbsp;                metaData.putValue(DataConstants.DEVICE_ID, deviceId.getId().toString());</b>
&nbsp;            }
<b class="nc">&nbsp;            ObjectNode data = JacksonUtil.newObjectNode();</b>
<b class="nc">&nbsp;            data.put(&quot;method&quot;, deviceRpcCallMsg.getRequestMsg().getMethod());</b>
<b class="nc">&nbsp;            data.put(&quot;params&quot;, deviceRpcCallMsg.getRequestMsg().getParams());</b>
<b class="nc">&nbsp;            TbMsg tbMsg = TbMsg.newMsg()</b>
<b class="nc">&nbsp;                    .type(TbMsgType.TO_SERVER_RPC_REQUEST)</b>
<b class="nc">&nbsp;                    .originator(deviceId)</b>
<b class="nc">&nbsp;                    .copyMetaData(metaData)</b>
<b class="nc">&nbsp;                    .dataType(TbMsgDataType.JSON)</b>
<b class="nc">&nbsp;                    .data(JacksonUtil.toString(data))</b>
<b class="nc">&nbsp;                    .build();</b>
<b class="nc">&nbsp;            edgeCtx.getClusterService().pushMsgToRuleEngine(tenantId, deviceId, tbMsg, new TbQueueCallback() {</b>
&nbsp;                @Override
&nbsp;                public void onSuccess(TbQueueMsgMetadata metadata) {
<b class="nc">&nbsp;                    log.debug(&quot;[{}] Successfully send TO_SERVER_RPC_REQUEST to rule engine [{}], deviceRpcCallMsg {}&quot;,</b>
&nbsp;                            tenantId, device, deviceRpcCallMsg);
&nbsp;                }
&nbsp;
&nbsp;                @Override
&nbsp;                public void onFailure(Throwable t) {
<b class="nc">&nbsp;                    log.debug(&quot;[{}] Failed to send TO_SERVER_RPC_REQUEST to rule engine [{}], deviceRpcCallMsg {}&quot;,</b>
&nbsp;                            tenantId, device, deviceRpcCallMsg, t);
&nbsp;                }
&nbsp;            });
&nbsp;        } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;            log.warn(&quot;[{}][{}] Failed to push TO_SERVER_RPC_REQUEST to rule engine. deviceRpcCallMsg {}&quot;, tenantId, deviceId, deviceRpcCallMsg, e);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return Futures.immediateFuture(null);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public DownlinkMsg convertEdgeEventToDownlink(EdgeEvent edgeEvent, EdgeVersion edgeVersion) {
<b class="nc">&nbsp;        DeviceId deviceId = new DeviceId(edgeEvent.getEntityId());</b>
<b class="nc">&nbsp;        switch (edgeEvent.getAction()) {</b>
&nbsp;            case ADDED:
&nbsp;            case UPDATED:
&nbsp;            case ASSIGNED_TO_EDGE:
&nbsp;            case ASSIGNED_TO_CUSTOMER:
&nbsp;            case UNASSIGNED_FROM_CUSTOMER:
<b class="nc">&nbsp;                Device device = edgeCtx.getDeviceService().findDeviceById(edgeEvent.getTenantId(), deviceId);</b>
<b class="nc">&nbsp;                if (device != null) {</b>
<b class="nc">&nbsp;                    UpdateMsgType msgType = getUpdateMsgType(edgeEvent.getAction());</b>
<b class="nc">&nbsp;                    DeviceUpdateMsg deviceUpdateMsg = EdgeMsgConstructorUtils.constructDeviceUpdatedMsg(msgType, device);</b>
<b class="nc">&nbsp;                    DownlinkMsg.Builder builder = DownlinkMsg.newBuilder()</b>
<b class="nc">&nbsp;                            .setDownlinkMsgId(EdgeUtils.nextPositiveInt())</b>
<b class="nc">&nbsp;                            .addDeviceUpdateMsg(deviceUpdateMsg);</b>
<b class="nc">&nbsp;                    DeviceCredentials deviceCredentials = edgeCtx.getDeviceCredentialsService().findDeviceCredentialsByDeviceId(edgeEvent.getTenantId(), deviceId);</b>
<b class="nc">&nbsp;                    if (deviceCredentials != null) {</b>
<b class="nc">&nbsp;                        DeviceCredentialsUpdateMsg deviceCredentialsUpdateMsg = EdgeMsgConstructorUtils.constructDeviceCredentialsUpdatedMsg(deviceCredentials);</b>
<b class="nc">&nbsp;                        builder.addDeviceCredentialsUpdateMsg(deviceCredentialsUpdateMsg).build();</b>
&nbsp;                    }
&nbsp;
<b class="nc">&nbsp;                    if (UpdateMsgType.ENTITY_CREATED_RPC_MESSAGE.equals(msgType)) {</b>
<b class="nc">&nbsp;                        DeviceProfile deviceProfile = edgeCtx.getDeviceProfileService().findDeviceProfileById(edgeEvent.getTenantId(), device.getDeviceProfileId());</b>
<b class="nc">&nbsp;                        builder.addDeviceProfileUpdateMsg(EdgeMsgConstructorUtils.constructDeviceProfileUpdatedMsg(msgType, deviceProfile, edgeVersion));</b>
&nbsp;                    }
<b class="nc">&nbsp;                    return builder.build();</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            case DELETED:
&nbsp;            case UNASSIGNED_FROM_EDGE:
<b class="nc">&nbsp;                return DownlinkMsg.newBuilder()</b>
<b class="nc">&nbsp;                        .setDownlinkMsgId(EdgeUtils.nextPositiveInt())</b>
<b class="nc">&nbsp;                        .addDeviceUpdateMsg(EdgeMsgConstructorUtils.constructDeviceDeleteMsg(deviceId))</b>
<b class="nc">&nbsp;                        .build();</b>
&nbsp;            case CREDENTIALS_UPDATED:
<b class="nc">&nbsp;                DeviceCredentials deviceCredentials = edgeCtx.getDeviceCredentialsService().findDeviceCredentialsByDeviceId(edgeEvent.getTenantId(), deviceId);</b>
<b class="nc">&nbsp;                if (deviceCredentials != null) {</b>
<b class="nc">&nbsp;                    return DownlinkMsg.newBuilder()</b>
<b class="nc">&nbsp;                            .setDownlinkMsgId(EdgeUtils.nextPositiveInt())</b>
<b class="nc">&nbsp;                            .addDeviceCredentialsUpdateMsg(EdgeMsgConstructorUtils.constructDeviceCredentialsUpdatedMsg(deviceCredentials))</b>
<b class="nc">&nbsp;                            .build();</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            case RPC_CALL:
<b class="nc">&nbsp;                return DownlinkMsg.newBuilder()</b>
<b class="nc">&nbsp;                        .setDownlinkMsgId(EdgeUtils.nextPositiveInt())</b>
<b class="nc">&nbsp;                        .addDeviceRpcCallMsg(EdgeMsgConstructorUtils.constructDeviceRpcCallMsg(edgeEvent.getEntityId(), edgeEvent.getBody()))</b>
<b class="nc">&nbsp;                        .build();</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    protected void setCustomerId(TenantId tenantId, CustomerId customerId, Device device, DeviceUpdateMsg deviceUpdateMsg) {
<b class="nc">&nbsp;        CustomerId customerUUID = device.getCustomerId() != null ? device.getCustomerId() : customerId;</b>
<b class="nc">&nbsp;        device.setCustomerId(customerUUID);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public EdgeEventType getEdgeEventType() {
<b class="nc">&nbsp;        return EdgeEventType.DEVICE;</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
