<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LwM2mServerListener</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.transport.lwm2m.server</a>
</div>

<h1>Coverage Summary for Class: LwM2mServerListener (org.thingsboard.server.transport.lwm2m.server)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LwM2mServerListener</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LwM2mServerListener$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LwM2mServerListener$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LwM2mServerListener$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/12)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">LwM2mServerListener$4</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/18)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/40)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.transport.lwm2m.server;
&nbsp;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.eclipse.leshan.core.node.TimestampedLwM2mNodes;
&nbsp;import org.eclipse.leshan.core.observation.CompositeObservation;
&nbsp;import org.eclipse.leshan.core.observation.Observation;
&nbsp;import org.eclipse.leshan.core.observation.SingleObservation;
&nbsp;import org.eclipse.leshan.core.request.SendRequest;
&nbsp;import org.eclipse.leshan.core.response.ObserveCompositeResponse;
&nbsp;import org.eclipse.leshan.core.response.ObserveResponse;
&nbsp;import org.eclipse.leshan.server.observation.ObservationListener;
&nbsp;import org.eclipse.leshan.server.queue.PresenceListener;
&nbsp;import org.eclipse.leshan.server.registration.Registration;
&nbsp;import org.eclipse.leshan.server.registration.RegistrationListener;
&nbsp;import org.eclipse.leshan.server.registration.RegistrationUpdate;
&nbsp;import org.eclipse.leshan.server.send.SendListener;
&nbsp;import org.thingsboard.server.transport.lwm2m.server.client.LwM2mClient;
&nbsp;import org.thingsboard.server.transport.lwm2m.server.uplink.LwM2mUplinkMsgHandler;
&nbsp;
&nbsp;import java.util.Collection;
&nbsp;
&nbsp;import static org.thingsboard.server.transport.lwm2m.utils.LwM2MTransportUtil.convertObjectIdToVersionedId;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;public class LwM2mServerListener {
&nbsp;
&nbsp;    private final LwM2mUplinkMsgHandler service;
&nbsp;
<b class="nc">&nbsp;    public LwM2mServerListener(LwM2mUplinkMsgHandler service) {</b>
<b class="nc">&nbsp;        this.service = service;</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    public final RegistrationListener registrationListener = new RegistrationListener() {</b>
&nbsp;        /**
&nbsp;         * Register – query represented as POST /rd?…
&nbsp;         */
&nbsp;        @Override
&nbsp;        public void registered(Registration registration, Registration previousReg,
&nbsp;                               Collection&lt;Observation&gt; previousObservations) {
<b class="nc">&nbsp;            log.debug(&quot;Client: registered: [{}]&quot;, registration.getEndpoint());</b>
<b class="nc">&nbsp;            service.onRegistered(registration, previousObservations);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Update – query represented as CoAP POST request for the URL received in response to Register.
&nbsp;         */
&nbsp;        @Override
&nbsp;        public void updated(RegistrationUpdate update, Registration updatedRegistration,
&nbsp;                            Registration previousRegistration) {
<b class="nc">&nbsp;            service.updatedReg(updatedRegistration);</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * De-register (CoAP DELETE) – Sent by the client when a shutdown procedure is initiated.
&nbsp;         */
&nbsp;        @Override
&nbsp;        public void unregistered(Registration registration, Collection&lt;Observation&gt; observations, boolean expired,
&nbsp;                                 Registration newReg) {
<b class="nc">&nbsp;            service.unReg(registration, observations);</b>
&nbsp;        }
&nbsp;
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    public final PresenceListener presenceListener = new PresenceListener() {</b>
&nbsp;        @Override
&nbsp;        public void onSleeping(Registration registration) {
<b class="nc">&nbsp;            log.info(&quot;[{}] onSleeping&quot;, registration.getEndpoint());</b>
<b class="nc">&nbsp;            service.onSleepingDev(registration);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onAwake(Registration registration) {
<b class="nc">&nbsp;            log.info(&quot;[{}] onAwake&quot;, registration.getEndpoint());</b>
<b class="nc">&nbsp;            service.onAwakeDev(registration);</b>
&nbsp;        }
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    public final ObservationListener observationListener = new ObservationListener() {</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void cancelled(Observation observation) {
<b class="nc">&nbsp;            log.trace(&quot;Canceled Observation [RegistrationId:{}: {}].&quot;, observation.getRegistrationId(), observation instanceof SingleObservation ?</b>
<b class="nc">&nbsp;                    &quot;SingleObservation: &quot; + ((SingleObservation) observation).getPath() :</b>
<b class="nc">&nbsp;                    &quot;CompositeObservation: &quot; + ((CompositeObservation) observation).getPaths());</b>
&nbsp;       }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onResponse(SingleObservation observation, Registration registration, ObserveResponse response) {
<b class="nc">&nbsp;            if (registration != null) {</b>
<b class="nc">&nbsp;                LwM2mClient lwM2MClient = service.getClientContext().getClientByEndpoint(registration.getEndpoint());</b>
<b class="nc">&nbsp;                if (lwM2MClient != null) {</b>
<b class="nc">&nbsp;                    service.onUpdateValueAfterReadResponse(registration, convertObjectIdToVersionedId(observation.getPath().toString(), lwM2MClient), response);</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onResponse(CompositeObservation observation, Registration registration, ObserveCompositeResponse response) {
<b class="nc">&nbsp;            log.trace(&quot;Update Composite Observation [{}: {}].&quot;, observation.getRegistrationId(), observation.getPaths());</b>
<b class="nc">&nbsp;            service.onUpdateValueAfterReadCompositeResponse(registration, response);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onError(Observation observation, Registration registration, Exception error) {
<b class="nc">&nbsp;            if (error != null) {</b>
<b class="nc">&nbsp;                var path = observation instanceof SingleObservation ? &quot;Single Observation Cancel: &quot; + ((SingleObservation) observation).getPath() : &quot;Composite Observation Cancel: &quot; + ((CompositeObservation) observation).getPaths();</b>
<b class="nc">&nbsp;                var msgError = path + &quot;: &quot; + error.getMessage();</b>
<b class="nc">&nbsp;                log.trace(&quot;Unable to handle notification [RegistrationId:{}]: [{}].&quot;, observation.getRegistrationId(), msgError);</b>
<b class="nc">&nbsp;                service.onErrorObservation(registration, msgError);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void newObservation(Observation observation, Registration registration) {
<b class="nc">&nbsp;            log.trace(&quot;Successful start newObservation  [RegistrationId:{}: {}].&quot;, observation.getRegistrationId(), observation instanceof SingleObservation ?</b>
<b class="nc">&nbsp;                    &quot;Single: &quot; + ((SingleObservation) observation).getPath() :</b>
<b class="nc">&nbsp;                    &quot;Composite: &quot; + ((CompositeObservation) observation).getPaths());</b>
&nbsp;        }
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    public final SendListener sendListener = new SendListener() {</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void dataReceived(Registration registration, TimestampedLwM2mNodes data, SendRequest request) {
<b class="nc">&nbsp;            log.trace(&quot;Received Send request from [{}] containing value: [{}], coapRequest: [{}]&quot;, registration.getEndpoint(), data.toString(), request.getCoapRequest().toString());</b>
<b class="nc">&nbsp;            if (registration != null) {</b>
<b class="nc">&nbsp;                service.onUpdateValueWithSendRequest(registration, data);</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void onError(Registration registration, String errorMessage, Exception error) {
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;    };
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
