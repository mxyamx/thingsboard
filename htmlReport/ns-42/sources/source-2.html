<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ActorSystemContext</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.actors</a>
</div>

<h1>Coverage Summary for Class: ActorSystemContext (org.thingsboard.server.actors)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ActorSystemContext</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/29)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/44)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/119)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ActorSystemContext$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ActorSystemContext$2</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">ActorSystemContext$3</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/44)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/128)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.actors;
&nbsp;
&nbsp;import com.fasterxml.jackson.databind.JsonNode;
&nbsp;import com.google.common.util.concurrent.FutureCallback;
&nbsp;import com.google.common.util.concurrent.Futures;
&nbsp;import com.google.common.util.concurrent.ListenableFuture;
&nbsp;import com.google.common.util.concurrent.MoreExecutors;
&nbsp;import jakarta.annotation.Nullable;
&nbsp;import jakarta.annotation.PostConstruct;
&nbsp;import lombok.Getter;
&nbsp;import lombok.Setter;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.springframework.beans.factory.annotation.Autowired;
&nbsp;import org.springframework.beans.factory.annotation.Value;
&nbsp;import org.springframework.context.annotation.Lazy;
&nbsp;import org.springframework.data.redis.core.RedisTemplate;
&nbsp;import org.springframework.stereotype.Component;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.rule.engine.api.DeviceStateManager;
&nbsp;import org.thingsboard.rule.engine.api.JobManager;
&nbsp;import org.thingsboard.rule.engine.api.MailService;
&nbsp;import org.thingsboard.rule.engine.api.MqttClientSettings;
&nbsp;import org.thingsboard.rule.engine.api.NotificationCenter;
&nbsp;import org.thingsboard.rule.engine.api.RuleEngineAiChatModelService;
&nbsp;import org.thingsboard.rule.engine.api.SmsService;
&nbsp;import org.thingsboard.rule.engine.api.notification.SlackService;
&nbsp;import org.thingsboard.rule.engine.api.sms.SmsSenderFactory;
&nbsp;import org.thingsboard.script.api.js.JsInvokeService;
&nbsp;import org.thingsboard.script.api.tbel.TbelInvokeService;
&nbsp;import org.thingsboard.server.actors.calculatedField.CalculatedFieldException;
&nbsp;import org.thingsboard.server.actors.service.ActorService;
&nbsp;import org.thingsboard.server.actors.tenant.DebugTbRateLimits;
&nbsp;import org.thingsboard.server.cache.limits.RateLimitService;
&nbsp;import org.thingsboard.server.cluster.TbClusterService;
&nbsp;import org.thingsboard.server.common.data.event.CalculatedFieldDebugEvent;
&nbsp;import org.thingsboard.server.common.data.event.ErrorEvent;
&nbsp;import org.thingsboard.server.common.data.event.LifecycleEvent;
&nbsp;import org.thingsboard.server.common.data.event.RuleChainDebugEvent;
&nbsp;import org.thingsboard.server.common.data.event.RuleNodeDebugEvent;
&nbsp;import org.thingsboard.server.common.data.id.CalculatedFieldId;
&nbsp;import org.thingsboard.server.common.data.id.EntityId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.limit.LimitedApi;
&nbsp;import org.thingsboard.server.common.data.plugin.ComponentLifecycleEvent;
&nbsp;import org.thingsboard.server.common.msg.TbActorMsg;
&nbsp;import org.thingsboard.server.common.msg.TbMsg;
&nbsp;import org.thingsboard.server.common.msg.notification.NotificationRuleProcessor;
&nbsp;import org.thingsboard.server.common.msg.queue.ServiceType;
&nbsp;import org.thingsboard.server.common.msg.queue.TopicPartitionInfo;
&nbsp;import org.thingsboard.server.common.msg.tools.TbRateLimits;
&nbsp;import org.thingsboard.server.common.stats.TbApiUsageReportClient;
&nbsp;import org.thingsboard.server.dao.ai.AiModelService;
&nbsp;import org.thingsboard.server.dao.alarm.AlarmCommentService;
&nbsp;import org.thingsboard.server.dao.asset.AssetProfileService;
&nbsp;import org.thingsboard.server.dao.asset.AssetService;
&nbsp;import org.thingsboard.server.dao.attributes.AttributesService;
&nbsp;import org.thingsboard.server.dao.audit.AuditLogService;
&nbsp;import org.thingsboard.server.dao.cassandra.CassandraCluster;
&nbsp;import org.thingsboard.server.dao.cf.CalculatedFieldService;
&nbsp;import org.thingsboard.server.dao.customer.CustomerService;
&nbsp;import org.thingsboard.server.dao.dashboard.DashboardService;
&nbsp;import org.thingsboard.server.dao.device.ClaimDevicesService;
&nbsp;import org.thingsboard.server.dao.device.DeviceCredentialsService;
&nbsp;import org.thingsboard.server.dao.device.DeviceProfileService;
&nbsp;import org.thingsboard.server.dao.device.DeviceService;
&nbsp;import org.thingsboard.server.dao.domain.DomainService;
&nbsp;import org.thingsboard.server.dao.edge.EdgeEventService;
&nbsp;import org.thingsboard.server.dao.edge.EdgeService;
&nbsp;import org.thingsboard.server.dao.entity.EntityService;
&nbsp;import org.thingsboard.server.dao.entityview.EntityViewService;
&nbsp;import org.thingsboard.server.dao.event.EventService;
&nbsp;import org.thingsboard.server.dao.job.JobService;
&nbsp;import org.thingsboard.server.dao.mobile.MobileAppBundleService;
&nbsp;import org.thingsboard.server.dao.mobile.MobileAppService;
&nbsp;import org.thingsboard.server.dao.nosql.CassandraBufferedRateReadExecutor;
&nbsp;import org.thingsboard.server.dao.nosql.CassandraBufferedRateWriteExecutor;
&nbsp;import org.thingsboard.server.dao.notification.NotificationRequestService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationRuleService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationTargetService;
&nbsp;import org.thingsboard.server.dao.notification.NotificationTemplateService;
&nbsp;import org.thingsboard.server.dao.oauth2.OAuth2ClientService;
&nbsp;import org.thingsboard.server.dao.ota.OtaPackageService;
&nbsp;import org.thingsboard.server.dao.pat.ApiKeyService;
&nbsp;import org.thingsboard.server.dao.queue.QueueService;
&nbsp;import org.thingsboard.server.dao.queue.QueueStatsService;
&nbsp;import org.thingsboard.server.dao.relation.RelationService;
&nbsp;import org.thingsboard.server.dao.resource.ResourceService;
&nbsp;import org.thingsboard.server.dao.resource.TbResourceDataCache;
&nbsp;import org.thingsboard.server.dao.rule.RuleChainService;
&nbsp;import org.thingsboard.server.dao.rule.RuleNodeStateService;
&nbsp;import org.thingsboard.server.dao.tenant.TbTenantProfileCache;
&nbsp;import org.thingsboard.server.dao.tenant.TenantProfileService;
&nbsp;import org.thingsboard.server.dao.tenant.TenantService;
&nbsp;import org.thingsboard.server.dao.timeseries.TimeseriesService;
&nbsp;import org.thingsboard.server.dao.usagerecord.ApiLimitService;
&nbsp;import org.thingsboard.server.dao.user.UserService;
&nbsp;import org.thingsboard.server.dao.widget.WidgetTypeService;
&nbsp;import org.thingsboard.server.dao.widget.WidgetsBundleService;
&nbsp;import org.thingsboard.server.queue.discovery.DiscoveryService;
&nbsp;import org.thingsboard.server.queue.discovery.PartitionService;
&nbsp;import org.thingsboard.server.queue.discovery.TbServiceInfoProvider;
&nbsp;import org.thingsboard.server.queue.settings.TbQueueCalculatedFieldSettings;
&nbsp;import org.thingsboard.server.service.apiusage.TbApiUsageStateService;
&nbsp;import org.thingsboard.server.service.cf.CalculatedFieldProcessingService;
&nbsp;import org.thingsboard.server.service.cf.CalculatedFieldQueueService;
&nbsp;import org.thingsboard.server.service.cf.CalculatedFieldStateService;
&nbsp;import org.thingsboard.server.service.cf.OwnerService;
&nbsp;import org.thingsboard.server.service.component.ComponentDiscoveryService;
&nbsp;import org.thingsboard.server.service.edge.rpc.EdgeRpcService;
&nbsp;import org.thingsboard.server.service.entitiy.entityview.TbEntityViewService;
&nbsp;import org.thingsboard.server.service.executors.DbCallbackExecutorService;
&nbsp;import org.thingsboard.server.service.executors.ExternalCallExecutorService;
&nbsp;import org.thingsboard.server.service.executors.NotificationExecutorService;
&nbsp;import org.thingsboard.server.service.executors.PubSubRuleNodeExecutorProvider;
&nbsp;import org.thingsboard.server.service.executors.SharedEventLoopGroupService;
&nbsp;import org.thingsboard.server.service.mail.MailExecutorService;
&nbsp;import org.thingsboard.server.service.profile.TbAssetProfileCache;
&nbsp;import org.thingsboard.server.service.profile.TbDeviceProfileCache;
&nbsp;import org.thingsboard.server.service.rpc.TbCoreDeviceRpcService;
&nbsp;import org.thingsboard.server.service.rpc.TbRpcService;
&nbsp;import org.thingsboard.server.service.rpc.TbRuleEngineDeviceRpcService;
&nbsp;import org.thingsboard.server.service.session.DeviceSessionCacheService;
&nbsp;import org.thingsboard.server.service.sms.SmsExecutorService;
&nbsp;import org.thingsboard.server.service.state.DeviceStateService;
&nbsp;import org.thingsboard.server.service.telemetry.AlarmSubscriptionService;
&nbsp;import org.thingsboard.server.service.telemetry.TelemetrySubscriptionService;
&nbsp;import org.thingsboard.server.service.transport.TbCoreToTransportService;
&nbsp;import org.thingsboard.server.utils.DebugModeRateLimitsConfig;
&nbsp;
&nbsp;import java.io.PrintWriter;
&nbsp;import java.io.StringWriter;
&nbsp;import java.util.UUID;
&nbsp;import java.util.concurrent.ConcurrentHashMap;
&nbsp;import java.util.concurrent.ConcurrentMap;
&nbsp;import java.util.concurrent.ScheduledExecutorService;
&nbsp;import java.util.concurrent.ScheduledFuture;
&nbsp;import java.util.concurrent.TimeUnit;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;@Component
<b class="nc">&nbsp;public class ActorSystemContext {</b>
&nbsp;
<b class="nc">&nbsp;    private static final FutureCallback&lt;Void&gt; RULE_CHAIN_DEBUG_EVENT_ERROR_CALLBACK = new FutureCallback&lt;&gt;() {</b>
&nbsp;        @Override
&nbsp;        public void onSuccess(@Nullable Void event) {
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void onFailure(Throwable th) {
<b class="nc">&nbsp;            log.error(&quot;Could not save debug Event for Rule Chain&quot;, th);</b>
&nbsp;        }
&nbsp;    };
<b class="nc">&nbsp;    private static final FutureCallback&lt;Void&gt; RULE_NODE_DEBUG_EVENT_ERROR_CALLBACK = new FutureCallback&lt;&gt;() {</b>
&nbsp;        @Override
&nbsp;        public void onSuccess(@Nullable Void event) {
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void onFailure(Throwable th) {
<b class="nc">&nbsp;            log.error(&quot;Could not save debug Event for Node&quot;, th);</b>
&nbsp;        }
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    private static final FutureCallback&lt;Void&gt; CALCULATED_FIELD_DEBUG_EVENT_ERROR_CALLBACK = new FutureCallback&lt;&gt;() {</b>
&nbsp;        @Override
&nbsp;        public void onSuccess(@Nullable Void event) {
&nbsp;
<b class="nc">&nbsp;        }</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void onFailure(Throwable th) {
<b class="nc">&nbsp;            log.error(&quot;Could not save debug Event for Calculated Field&quot;, th);</b>
&nbsp;        }
&nbsp;    };
&nbsp;
<b class="nc">&nbsp;    private final ConcurrentMap&lt;TenantId, DebugTbRateLimits&gt; debugPerTenantLimits = new ConcurrentHashMap&lt;&gt;();</b>
&nbsp;
&nbsp;    public ConcurrentMap&lt;TenantId, DebugTbRateLimits&gt; getDebugPerTenantLimits() {
<b class="nc">&nbsp;        return debugPerTenantLimits;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbApiUsageStateService apiUsageStateService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbApiUsageReportClient apiUsageClient;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    @Setter
&nbsp;    private TbServiceInfoProvider serviceInfoProvider;
&nbsp;
&nbsp;    @Getter
&nbsp;    @Setter
&nbsp;    private ActorService actorService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    @Setter
&nbsp;    private ComponentDiscoveryService componentService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DiscoveryService discoveryService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DeviceService deviceService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DeviceProfileService deviceProfileService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AssetProfileService assetProfileService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DeviceCredentialsService deviceCredentialsService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private DeviceStateManager deviceStateManager;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbTenantProfileCache tenantProfileCache;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbDeviceProfileCache deviceProfileCache;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbAssetProfileCache assetProfileCache;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AssetService assetService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DashboardService dashboardService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TenantService tenantService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TenantProfileService tenantProfileService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private CustomerService customerService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private UserService userService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private RuleChainService ruleChainService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private RuleNodeStateService ruleNodeStateService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private PartitionService partitionService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbClusterService clusterService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TimeseriesService tsService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AttributesService attributesService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private EventService eventService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private RelationService relationService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AuditLogService auditLogService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private RuleEngineAiChatModelService aiChatModelService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AiModelService aiModelService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private EntityViewService entityViewService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbEntityViewService tbEntityViewService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TelemetrySubscriptionService tsSubService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AlarmSubscriptionService alarmService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private AlarmCommentService alarmCommentService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private JsInvokeService jsInvokeService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbelInvokeService tbelInvokeService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private MailExecutorService mailExecutor;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private SmsExecutorService smsExecutor;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DbCallbackExecutorService dbCallbackExecutor;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private ExternalCallExecutorService externalCallExecutorService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationExecutorService notificationExecutor;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private PubSubRuleNodeExecutorProvider pubSubRuleNodeExecutorProvider;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private SharedEventLoopGroupService sharedEventLoopGroupService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private MailService mailService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private SmsService smsService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private SmsSenderFactory smsSenderFactory;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationCenter notificationCenter;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationRuleProcessor notificationRuleProcessor;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationTargetService notificationTargetService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationTemplateService notificationTemplateService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationRequestService notificationRequestService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private NotificationRuleService notificationRuleService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private OAuth2ClientService oAuth2ClientService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private DomainService domainService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private MobileAppService mobileAppService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private MobileAppBundleService mobileAppBundleService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private SlackService slackService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private CalculatedFieldService calculatedFieldService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private ClaimDevicesService claimDevicesService;
&nbsp;
&nbsp;    //TODO: separate context for TbCore and TbRuleEngine
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private DeviceStateService deviceStateService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private DeviceSessionCacheService deviceSessionCacheService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbCoreToTransportService tbCoreToTransportService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private ApiLimitService apiLimitService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private RateLimitService rateLimitService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private DebugModeRateLimitsConfig debugModeRateLimitsConfig;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbQueueCalculatedFieldSettings calculatedFieldSettings;
&nbsp;
&nbsp;    /**
&nbsp;     * The following Service will be null if we operate in tb-core mode
&nbsp;     */
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbRuleEngineDeviceRpcService tbRuleEngineDeviceRpcService;
&nbsp;
&nbsp;    /**
&nbsp;     * The following Service will be null if we operate in tb-rule-engine mode
&nbsp;     */
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbCoreDeviceRpcService tbCoreDeviceRpcService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private EdgeService edgeService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private EdgeEventService edgeEventService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private EdgeRpcService edgeRpcService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private ResourceService resourceService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private TbResourceDataCache resourceDataCache;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private OtaPackageService otaPackageService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private TbRpcService tbRpcService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private QueueService queueService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private QueueStatsService queueStatsService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private WidgetsBundleService widgetsBundleService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private WidgetTypeService widgetTypeService;
&nbsp;
&nbsp;    @Lazy
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private EntityService entityService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CalculatedFieldProcessingService calculatedFieldProcessingService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CalculatedFieldStateService calculatedFieldStateService;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CalculatedFieldQueueService calculatedFieldQueueService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private JobService jobService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private JobManager jobManager;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private ApiKeyService apiKeyService;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private OwnerService ownerService;
&nbsp;
&nbsp;    @Value(&quot;${actors.session.max_concurrent_sessions_per_device:1}&quot;)
&nbsp;    @Getter
&nbsp;    private int maxConcurrentSessionsPerDevice;
&nbsp;
&nbsp;    @Value(&quot;${actors.session.sync.timeout:10000}&quot;)
&nbsp;    @Getter
&nbsp;    private long syncSessionTimeout;
&nbsp;
&nbsp;    @Value(&quot;${actors.rule.chain.error_persist_frequency:3000}&quot;)
&nbsp;    @Getter
&nbsp;    private long ruleChainErrorPersistFrequency;
&nbsp;
&nbsp;    @Value(&quot;${actors.rule.node.error_persist_frequency:3000}&quot;)
&nbsp;    @Getter
&nbsp;    private long ruleNodeErrorPersistFrequency;
&nbsp;
&nbsp;    @Value(&quot;${actors.statistics.enabled:true}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean statisticsEnabled;
&nbsp;
&nbsp;    @Value(&quot;${actors.statistics.persist_frequency:3600000}&quot;)
&nbsp;    @Getter
&nbsp;    private long statisticsPersistFrequency;
&nbsp;
&nbsp;    @Value(&quot;${edges.enabled:true}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean edgesEnabled;
&nbsp;
&nbsp;    @Value(&quot;${cache.type:caffeine}&quot;)
&nbsp;    @Getter
&nbsp;    private String cacheType;
&nbsp;
&nbsp;    @Getter
&nbsp;    private boolean localCacheType;
&nbsp;
&nbsp;    @PostConstruct
&nbsp;    public void init() {
<b class="nc">&nbsp;        this.localCacheType = &quot;caffeine&quot;.equals(cacheType);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Value(&quot;${actors.tenant.create_components_on_init:true}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean tenantComponentsInitEnabled;
&nbsp;
&nbsp;    @Value(&quot;${actors.rule.allow_system_mail_service:true}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean allowSystemMailService;
&nbsp;
&nbsp;    @Value(&quot;${actors.rule.allow_system_sms_service:true}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean allowSystemSmsService;
&nbsp;
&nbsp;    @Value(&quot;${transport.sessions.inactivity_timeout:300000}&quot;)
&nbsp;    @Getter
&nbsp;    private long sessionInactivityTimeout;
&nbsp;
&nbsp;    @Value(&quot;${transport.sessions.report_timeout:3000}&quot;)
&nbsp;    @Getter
&nbsp;    private long sessionReportTimeout;
&nbsp;
&nbsp;    @Value(&quot;${actors.rpc.submit_strategy:BURST}&quot;)
&nbsp;    @Getter
&nbsp;    private String rpcSubmitStrategy;
&nbsp;
&nbsp;    @Value(&quot;${actors.rpc.close_session_on_rpc_delivery_timeout:false}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean closeTransportSessionOnRpcDeliveryTimeout;
&nbsp;
&nbsp;    @Value(&quot;${actors.rpc.response_timeout_ms:30000}&quot;)
&nbsp;    @Getter
&nbsp;    private long rpcResponseTimeout;
&nbsp;
&nbsp;    @Value(&quot;${actors.rpc.max_retries:5}&quot;)
&nbsp;    @Getter
&nbsp;    private int maxRpcRetries;
&nbsp;
&nbsp;    @Value(&quot;${actors.rule.external.force_ack:false}&quot;)
&nbsp;    @Getter
&nbsp;    private boolean externalNodeForceAck;
&nbsp;
&nbsp;    @Value(&quot;${state.rule.node.deviceState.rateLimit:1:1,30:60,60:3600}&quot;)
&nbsp;    @Getter
&nbsp;    private String deviceStateNodeRateLimitConfig;
&nbsp;
&nbsp;    @Value(&quot;${actors.calculated_fields.calculation_timeout:5}&quot;)
&nbsp;    @Getter
&nbsp;    private long cfCalculationResultTimeout;
&nbsp;
&nbsp;    @Autowired
&nbsp;    @Getter
&nbsp;    private MqttClientSettings mqttClientSettings;
&nbsp;
&nbsp;    @Getter
&nbsp;    @Setter
&nbsp;    private TbActorSystem actorSystem;
&nbsp;
&nbsp;    @Setter
&nbsp;    private TbActorRef appActor;
&nbsp;
&nbsp;    @Getter
&nbsp;    @Setter
&nbsp;    private TbActorRef statsActor;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CassandraCluster cassandraCluster;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CassandraBufferedRateReadExecutor cassandraBufferedRateReadExecutor;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private CassandraBufferedRateWriteExecutor cassandraBufferedRateWriteExecutor;
&nbsp;
&nbsp;    @Autowired(required = false)
&nbsp;    @Getter
&nbsp;    private RedisTemplate&lt;String, Object&gt; redisTemplate;
&nbsp;
&nbsp;    public ScheduledExecutorService getScheduler() {
<b class="nc">&nbsp;        return actorSystem.getScheduler();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistError(TenantId tenantId, EntityId entityId, String method, Exception e) {
<b class="nc">&nbsp;        eventService.saveAsync(ErrorEvent.builder()</b>
<b class="nc">&nbsp;                .tenantId(tenantId)</b>
<b class="nc">&nbsp;                .entityId(entityId.getId())</b>
<b class="nc">&nbsp;                .serviceId(getServiceId())</b>
<b class="nc">&nbsp;                .method(method)</b>
<b class="nc">&nbsp;                .error(toString(e)).build());</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistLifecycleEvent(TenantId tenantId, EntityId entityId, ComponentLifecycleEvent lcEvent, Exception e) {
<b class="nc">&nbsp;        LifecycleEvent.LifecycleEventBuilder event = LifecycleEvent.builder()</b>
<b class="nc">&nbsp;                .tenantId(tenantId)</b>
<b class="nc">&nbsp;                .entityId(entityId.getId())</b>
<b class="nc">&nbsp;                .serviceId(getServiceId())</b>
<b class="nc">&nbsp;                .lcEventType(lcEvent.name());</b>
&nbsp;
<b class="nc">&nbsp;        if (e != null) {</b>
<b class="nc">&nbsp;            event.success(false).error(toString(e));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            event.success(true);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        eventService.saveAsync(event.build());</b>
&nbsp;    }
&nbsp;
&nbsp;    private String toString(Throwable e) {
<b class="nc">&nbsp;        StringWriter sw = new StringWriter();</b>
<b class="nc">&nbsp;        e.printStackTrace(new PrintWriter(sw));</b>
<b class="nc">&nbsp;        return sw.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public TopicPartitionInfo resolve(ServiceType serviceType, TenantId tenantId, EntityId entityId) {
<b class="nc">&nbsp;        return partitionService.resolve(serviceType, tenantId, entityId);</b>
&nbsp;    }
&nbsp;
&nbsp;    public TopicPartitionInfo resolve(ServiceType serviceType, String queueName, TenantId tenantId, EntityId entityId) {
<b class="nc">&nbsp;        return partitionService.resolve(serviceType, queueName, tenantId, entityId);</b>
&nbsp;    }
&nbsp;
&nbsp;    public TopicPartitionInfo resolve(TenantId tenantId, EntityId entityId, TbMsg msg) {
<b class="nc">&nbsp;        return partitionService.resolve(ServiceType.TB_RULE_ENGINE, msg.getQueueName(), tenantId, entityId, msg.getPartition());</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getServiceId() {
<b class="nc">&nbsp;        return serviceInfoProvider.getServiceId();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistDebugInput(TenantId tenantId, EntityId entityId, TbMsg tbMsg, String relationType) {
<b class="nc">&nbsp;        persistDebugAsync(tenantId, entityId, &quot;IN&quot;, tbMsg, relationType, null, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistDebugInput(TenantId tenantId, EntityId entityId, TbMsg tbMsg, String relationType, Throwable error) {
<b class="nc">&nbsp;        persistDebugAsync(tenantId, entityId, &quot;IN&quot;, tbMsg, relationType, error, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistDebugOutput(TenantId tenantId, EntityId entityId, TbMsg tbMsg, String relationType, Throwable error, String failureMessage) {
<b class="nc">&nbsp;        persistDebugAsync(tenantId, entityId, &quot;OUT&quot;, tbMsg, relationType, error, failureMessage);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistDebugOutput(TenantId tenantId, EntityId entityId, TbMsg tbMsg, String relationType, Throwable error) {
<b class="nc">&nbsp;        persistDebugAsync(tenantId, entityId, &quot;OUT&quot;, tbMsg, relationType, error, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistDebugOutput(TenantId tenantId, EntityId entityId, TbMsg tbMsg, String relationType) {
<b class="nc">&nbsp;        persistDebugAsync(tenantId, entityId, &quot;OUT&quot;, tbMsg, relationType, null, null);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void persistDebugAsync(TenantId tenantId, EntityId entityId, String type, TbMsg tbMsg, String relationType, Throwable error, String failureMessage) {
<b class="nc">&nbsp;        if (checkLimits(tenantId, tbMsg, error)) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                RuleNodeDebugEvent.RuleNodeDebugEventBuilder event = RuleNodeDebugEvent.builder()</b>
<b class="nc">&nbsp;                        .tenantId(tenantId)</b>
<b class="nc">&nbsp;                        .entityId(entityId.getId())</b>
<b class="nc">&nbsp;                        .serviceId(getServiceId())</b>
<b class="nc">&nbsp;                        .eventType(type)</b>
<b class="nc">&nbsp;                        .eventEntity(tbMsg.getOriginator())</b>
<b class="nc">&nbsp;                        .msgId(tbMsg.getId())</b>
<b class="nc">&nbsp;                        .msgType(tbMsg.getType())</b>
<b class="nc">&nbsp;                        .dataType(tbMsg.getDataType().name())</b>
<b class="nc">&nbsp;                        .relationType(relationType)</b>
<b class="nc">&nbsp;                        .data(tbMsg.getData())</b>
<b class="nc">&nbsp;                        .metadata(JacksonUtil.toString(tbMsg.getMetaData().getData()));</b>
&nbsp;
<b class="nc">&nbsp;                if (error != null) {</b>
<b class="nc">&nbsp;                    event.error(toString(error));</b>
<b class="nc">&nbsp;                } else if (failureMessage != null) {</b>
<b class="nc">&nbsp;                    event.error(failureMessage);</b>
&nbsp;                }
&nbsp;
<b class="nc">&nbsp;                ListenableFuture&lt;Void&gt; future = eventService.saveAsync(event.build());</b>
<b class="nc">&nbsp;                Futures.addCallback(future, RULE_NODE_DEBUG_EVENT_ERROR_CALLBACK, MoreExecutors.directExecutor());</b>
&nbsp;            } catch (IllegalArgumentException ex) {
<b class="nc">&nbsp;                log.warn(&quot;Failed to persist rule node debug message&quot;, ex);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkLimits(TenantId tenantId, TbMsg tbMsg, Throwable error) {
<b class="nc">&nbsp;        if (debugModeRateLimitsConfig.isRuleChainDebugPerTenantLimitsEnabled()) {</b>
<b class="nc">&nbsp;            DebugTbRateLimits debugTbRateLimits = debugPerTenantLimits.computeIfAbsent(tenantId, id -&gt;</b>
<b class="nc">&nbsp;                    new DebugTbRateLimits(new TbRateLimits(debugModeRateLimitsConfig.getRuleChainDebugPerTenantLimitsConfiguration()), false));</b>
&nbsp;
<b class="nc">&nbsp;            if (!debugTbRateLimits.getTbRateLimits().tryConsume()) {</b>
<b class="nc">&nbsp;                if (!debugTbRateLimits.isRuleChainEventSaved()) {</b>
<b class="nc">&nbsp;                    persistRuleChainDebugModeEvent(tenantId, tbMsg.getRuleChainId(), error);</b>
<b class="nc">&nbsp;                    debugTbRateLimits.setRuleChainEventSaved(true);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (log.isTraceEnabled()) {</b>
<b class="nc">&nbsp;                    log.trace(&quot;[{}] Tenant level debug mode rate limit detected: {}&quot;, tenantId, tbMsg);</b>
&nbsp;                }
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    private void persistRuleChainDebugModeEvent(TenantId tenantId, EntityId entityId, Throwable error) {
<b class="nc">&nbsp;        RuleChainDebugEvent.RuleChainDebugEventBuilder event = RuleChainDebugEvent.builder()</b>
<b class="nc">&nbsp;                .tenantId(tenantId)</b>
<b class="nc">&nbsp;                .entityId(entityId.getId())</b>
<b class="nc">&nbsp;                .serviceId(getServiceId())</b>
<b class="nc">&nbsp;                .message(&quot;Reached debug mode rate limit!&quot;);</b>
<b class="nc">&nbsp;        if (error != null) {</b>
<b class="nc">&nbsp;            event.error(toString(error));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        ListenableFuture&lt;Void&gt; future = eventService.saveAsync(event.build());</b>
<b class="nc">&nbsp;        Futures.addCallback(future, RULE_CHAIN_DEBUG_EVENT_ERROR_CALLBACK, MoreExecutors.directExecutor());</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistCalculatedFieldDebugError(CalculatedFieldException cfe) {
&nbsp;        String message;
<b class="nc">&nbsp;        if (cfe.getErrorMessage() != null) {</b>
<b class="nc">&nbsp;            message = cfe.getErrorMessage();</b>
<b class="nc">&nbsp;        } else if (cfe.getCause() != null) {</b>
<b class="nc">&nbsp;            message = cfe.getCause().getMessage();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            message = &quot;N/A&quot;;</b>
&nbsp;        }
<b class="nc">&nbsp;        persistCalculatedFieldDebugEvent(cfe.getCtx().getTenantId(), cfe.getCtx().getCfId(), cfe.getEventEntity(), cfe.getArguments(), cfe.getMsgId(), cfe.getMsgType(), null, message);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void persistCalculatedFieldDebugEvent(TenantId tenantId, CalculatedFieldId calculatedFieldId, EntityId entityId, JsonNode arguments, UUID tbMsgId, String tbMsgType, String result, String errorMessage) {
<b class="nc">&nbsp;        if (checkLimits(tenantId)) {</b>
&nbsp;            try {
<b class="nc">&nbsp;                CalculatedFieldDebugEvent.CalculatedFieldDebugEventBuilder eventBuilder = CalculatedFieldDebugEvent.builder()</b>
<b class="nc">&nbsp;                        .tenantId(tenantId)</b>
<b class="nc">&nbsp;                        .entityId(calculatedFieldId.getId())</b>
<b class="nc">&nbsp;                        .serviceId(getServiceId())</b>
<b class="nc">&nbsp;                        .calculatedFieldId(calculatedFieldId)</b>
<b class="nc">&nbsp;                        .eventEntity(entityId);</b>
<b class="nc">&nbsp;                if (tbMsgId != null) {</b>
<b class="nc">&nbsp;                    eventBuilder.msgId(tbMsgId);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (tbMsgType != null) {</b>
<b class="nc">&nbsp;                    eventBuilder.msgType(tbMsgType);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (arguments != null &amp;&amp; !arguments.isEmpty()) {</b>
<b class="nc">&nbsp;                    eventBuilder.arguments(JacksonUtil.toString(arguments));</b>
&nbsp;                }
<b class="nc">&nbsp;                if (result != null) {</b>
<b class="nc">&nbsp;                    eventBuilder.result(result);</b>
&nbsp;                }
<b class="nc">&nbsp;                if (errorMessage != null) {</b>
<b class="nc">&nbsp;                    eventBuilder.error(errorMessage);</b>
&nbsp;                }
<b class="nc">&nbsp;                CalculatedFieldDebugEvent event = eventBuilder.build();</b>
<b class="nc">&nbsp;                log.debug(&quot;Persisting calculated field debug event: {}&quot;, event);</b>
<b class="nc">&nbsp;                ListenableFuture&lt;Void&gt; future = eventService.saveAsync(event);</b>
<b class="nc">&nbsp;                Futures.addCallback(future, CALCULATED_FIELD_DEBUG_EVENT_ERROR_CALLBACK, MoreExecutors.directExecutor());</b>
&nbsp;            } catch (IllegalArgumentException ex) {
<b class="nc">&nbsp;                log.warn(&quot;Failed to persist calculated field debug message&quot;, ex);</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private boolean checkLimits(TenantId tenantId) {
<b class="nc">&nbsp;        if (debugModeRateLimitsConfig.isCalculatedFieldDebugPerTenantLimitsEnabled() &amp;&amp;</b>
<b class="nc">&nbsp;            !rateLimitService.checkRateLimit(LimitedApi.CALCULATED_FIELD_DEBUG_EVENTS, (Object) tenantId, debugModeRateLimitsConfig.getCalculatedFieldDebugPerTenantLimitsConfiguration())) {</b>
<b class="nc">&nbsp;            log.trace(&quot;[{}] Calculated field debug event limits exceeded!&quot;, tenantId);</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Exception toException(Throwable error) {
<b class="nc">&nbsp;        return Exception.class.isInstance(error) ? (Exception) error : new Exception(error);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void tell(TbActorMsg tbActorMsg) {
<b class="nc">&nbsp;        appActor.tell(tbActorMsg);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void tellWithHighPriority(TbActorMsg tbActorMsg) {
<b class="nc">&nbsp;        appActor.tellWithHighPriority(tbActorMsg);</b>
&nbsp;    }
&nbsp;
&nbsp;    public ScheduledFuture&lt;?&gt; schedulePeriodicMsgWithDelay(TbActorRef ctx, TbActorMsg msg, long delayInMs, long periodInMs) {
<b class="nc">&nbsp;        log.debug(&quot;Scheduling periodic msg {} every {} ms with delay {} ms&quot;, msg, periodInMs, delayInMs);</b>
<b class="nc">&nbsp;        return getScheduler().scheduleWithFixedDelay(() -&gt; ctx.tell(msg), delayInMs, periodInMs, TimeUnit.MILLISECONDS);</b>
&nbsp;    }
&nbsp;
&nbsp;    public ScheduledFuture&lt;?&gt; scheduleMsgWithDelay(TbActorRef ctx, TbActorMsg msg, long delayInMs) {
<b class="nc">&nbsp;        log.debug(&quot;Scheduling msg {} with delay {} ms&quot;, msg, delayInMs);</b>
<b class="nc">&nbsp;        if (delayInMs &gt; 0) {</b>
<b class="nc">&nbsp;            return getScheduler().schedule(() -&gt; ctx.tell(msg), delayInMs, TimeUnit.MILLISECONDS);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            ctx.tell(msg);</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
