<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > ProtoUtils</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.common.util</a>
</div>

<h1>Coverage Summary for Class: ProtoUtils (org.thingsboard.server.common.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ProtoUtils</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/75)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/466)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/867)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ProtoUtils$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/76)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/466)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/872)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.common.util;
&nbsp;
&nbsp;import com.fasterxml.jackson.core.JsonProcessingException;
&nbsp;import com.fasterxml.jackson.databind.JsonNode;
&nbsp;import com.google.protobuf.ByteString;
&nbsp;import com.google.protobuf.InvalidProtocolBufferException;
&nbsp;import lombok.SneakyThrows;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.ApiUsageRecordKey;
&nbsp;import org.thingsboard.server.common.data.ApiUsageState;
&nbsp;import org.thingsboard.server.common.data.ApiUsageStateValue;
&nbsp;import org.thingsboard.server.common.data.Device;
&nbsp;import org.thingsboard.server.common.data.DeviceProfile;
&nbsp;import org.thingsboard.server.common.data.DeviceProfileProvisionType;
&nbsp;import org.thingsboard.server.common.data.DeviceProfileType;
&nbsp;import org.thingsboard.server.common.data.DeviceTransportType;
&nbsp;import org.thingsboard.server.common.data.EdgeUtils;
&nbsp;import org.thingsboard.server.common.data.EntityType;
&nbsp;import org.thingsboard.server.common.data.ResourceSubType;
&nbsp;import org.thingsboard.server.common.data.ResourceType;
&nbsp;import org.thingsboard.server.common.data.StringUtils;
&nbsp;import org.thingsboard.server.common.data.TbResource;
&nbsp;import org.thingsboard.server.common.data.Tenant;
&nbsp;import org.thingsboard.server.common.data.TenantProfile;
&nbsp;import org.thingsboard.server.common.data.device.data.CoapDeviceTransportConfiguration;
&nbsp;import org.thingsboard.server.common.data.device.data.Lwm2mDeviceTransportConfiguration;
&nbsp;import org.thingsboard.server.common.data.device.data.PowerMode;
&nbsp;import org.thingsboard.server.common.data.device.data.PowerSavingConfiguration;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEvent;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEventActionType;
&nbsp;import org.thingsboard.server.common.data.edge.EdgeEventType;
&nbsp;import org.thingsboard.server.common.data.id.ApiUsageStateId;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.DashboardId;
&nbsp;import org.thingsboard.server.common.data.id.DeviceCredentialsId;
&nbsp;import org.thingsboard.server.common.data.id.DeviceId;
&nbsp;import org.thingsboard.server.common.data.id.DeviceProfileId;
&nbsp;import org.thingsboard.server.common.data.id.EdgeId;
&nbsp;import org.thingsboard.server.common.data.id.EntityId;
&nbsp;import org.thingsboard.server.common.data.id.EntityIdFactory;
&nbsp;import org.thingsboard.server.common.data.id.OtaPackageId;
&nbsp;import org.thingsboard.server.common.data.id.RuleChainId;
&nbsp;import org.thingsboard.server.common.data.id.TbResourceId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.id.TenantProfileId;
&nbsp;import org.thingsboard.server.common.data.kv.AttributeKey;
&nbsp;import org.thingsboard.server.common.data.kv.AttributeKvEntry;
&nbsp;import org.thingsboard.server.common.data.kv.BaseAttributeKvEntry;
&nbsp;import org.thingsboard.server.common.data.kv.BasicKvEntry;
&nbsp;import org.thingsboard.server.common.data.kv.BasicTsKvEntry;
&nbsp;import org.thingsboard.server.common.data.kv.BooleanDataEntry;
&nbsp;import org.thingsboard.server.common.data.kv.DoubleDataEntry;
&nbsp;import org.thingsboard.server.common.data.kv.JsonDataEntry;
&nbsp;import org.thingsboard.server.common.data.kv.KvEntry;
&nbsp;import org.thingsboard.server.common.data.kv.LongDataEntry;
&nbsp;import org.thingsboard.server.common.data.kv.StringDataEntry;
&nbsp;import org.thingsboard.server.common.data.kv.TsKvEntry;
&nbsp;import org.thingsboard.server.common.data.plugin.ComponentLifecycleEvent;
&nbsp;import org.thingsboard.server.common.data.rpc.RpcError;
&nbsp;import org.thingsboard.server.common.data.rpc.ToDeviceRpcRequestBody;
&nbsp;import org.thingsboard.server.common.data.security.DeviceCredentials;
&nbsp;import org.thingsboard.server.common.data.security.DeviceCredentialsType;
&nbsp;import org.thingsboard.server.common.data.sync.vc.RepositoryAuthMethod;
&nbsp;import org.thingsboard.server.common.data.sync.vc.RepositorySettings;
&nbsp;import org.thingsboard.server.common.msg.TbMsg;
&nbsp;import org.thingsboard.server.common.msg.ToDeviceActorNotificationMsg;
&nbsp;import org.thingsboard.server.common.msg.edge.EdgeEventUpdateMsg;
&nbsp;import org.thingsboard.server.common.msg.edge.EdgeHighPriorityMsg;
&nbsp;import org.thingsboard.server.common.msg.edge.FromEdgeSyncResponse;
&nbsp;import org.thingsboard.server.common.msg.edge.ToEdgeSyncRequest;
&nbsp;import org.thingsboard.server.common.msg.gen.MsgProtos;
&nbsp;import org.thingsboard.server.common.msg.plugin.ComponentLifecycleMsg;
&nbsp;import org.thingsboard.server.common.msg.queue.TbMsgCallback;
&nbsp;import org.thingsboard.server.common.msg.rpc.FromDeviceRpcResponse;
&nbsp;import org.thingsboard.server.common.msg.rpc.FromDeviceRpcResponseActorMsg;
&nbsp;import org.thingsboard.server.common.msg.rpc.RemoveRpcActorMsg;
&nbsp;import org.thingsboard.server.common.msg.rpc.ToDeviceRpcRequest;
&nbsp;import org.thingsboard.server.common.msg.rpc.ToDeviceRpcRequestActorMsg;
&nbsp;import org.thingsboard.server.common.msg.rule.engine.DeviceAttributesEventNotificationMsg;
&nbsp;import org.thingsboard.server.common.msg.rule.engine.DeviceCredentialsUpdateNotificationMsg;
&nbsp;import org.thingsboard.server.common.msg.rule.engine.DeviceDeleteMsg;
&nbsp;import org.thingsboard.server.common.msg.rule.engine.DeviceEdgeUpdateMsg;
&nbsp;import org.thingsboard.server.common.msg.rule.engine.DeviceNameOrTypeUpdateMsg;
&nbsp;import org.thingsboard.server.gen.transport.TransportProtos;
&nbsp;import org.thingsboard.server.gen.transport.TransportProtos.ApiUsageRecordKeyProto;
&nbsp;import org.thingsboard.server.gen.transport.TransportProtos.KeyValueProto;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;import java.util.Set;
&nbsp;import java.util.UUID;
&nbsp;import java.util.function.Function;
&nbsp;import java.util.stream.Collectors;
&nbsp;
&nbsp;import static org.thingsboard.server.common.data.DataConstants.GATEWAY_PARAMETER;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
<b class="nc">&nbsp;public class ProtoUtils {</b>
&nbsp;
&nbsp;    public static TransportProtos.ComponentLifecycleMsgProto toProto(ComponentLifecycleMsg msg) {
<b class="nc">&nbsp;        var builder = TransportProtos.ComponentLifecycleMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setEntityType(toProto(msg.getEntityId().getEntityType()))</b>
<b class="nc">&nbsp;                .setEntityIdMSB(msg.getEntityId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setEntityIdLSB(msg.getEntityId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setEvent(toProto(msg.getEvent()));</b>
<b class="nc">&nbsp;        if (msg.getProfileId() != null) {</b>
<b class="nc">&nbsp;            builder.setProfileIdMSB(msg.getProfileId().getId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setProfileIdLSB(msg.getProfileId().getId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getOldProfileId() != null) {</b>
<b class="nc">&nbsp;            builder.setOldProfileIdMSB(msg.getOldProfileId().getId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setOldProfileIdLSB(msg.getOldProfileId().getId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        builder.setOwnerChanged(msg.isOwnerChanged());</b>
<b class="nc">&nbsp;        if (msg.getName() != null) {</b>
<b class="nc">&nbsp;            builder.setName(msg.getName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getOldName() != null) {</b>
<b class="nc">&nbsp;            builder.setOldName(msg.getOldName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getInfo() != null) {</b>
<b class="nc">&nbsp;            builder.setInfo(JacksonUtil.toString(msg.getInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.EntityTypeProto toProto(EntityType entityType) {
<b class="nc">&nbsp;        return TransportProtos.EntityTypeProto.forNumber(entityType.getProtoNumber());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ComponentLifecycleMsg fromProto(TransportProtos.ComponentLifecycleMsgProto proto) {
<b class="nc">&nbsp;        EntityId entityId = EntityIdFactory.getByTypeAndUuid(fromProto(proto.getEntityType()), new UUID(proto.getEntityIdMSB(), proto.getEntityIdLSB()));</b>
<b class="nc">&nbsp;        var builder = ComponentLifecycleMsg.builder()</b>
<b class="nc">&nbsp;                .tenantId(TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())))</b>
<b class="nc">&nbsp;                .entityId(entityId)</b>
<b class="nc">&nbsp;                .event(fromProto(proto.getEvent()));</b>
<b class="nc">&nbsp;        if (!StringUtils.isEmpty(proto.getName())) {</b>
<b class="nc">&nbsp;            builder.name(proto.getName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (!StringUtils.isEmpty(proto.getOldName())) {</b>
<b class="nc">&nbsp;            builder.oldName(proto.getOldName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.getProfileIdMSB() != 0 || proto.getProfileIdLSB() != 0) {</b>
<b class="nc">&nbsp;            var profileType = EntityType.DEVICE.equals(entityId.getEntityType()) ? EntityType.DEVICE_PROFILE : EntityType.ASSET_PROFILE;</b>
<b class="nc">&nbsp;            builder.profileId(EntityIdFactory.getByTypeAndUuid(profileType, new UUID(proto.getProfileIdMSB(), proto.getProfileIdLSB())));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.getOldProfileIdMSB() != 0 || proto.getOldProfileIdLSB() != 0) {</b>
<b class="nc">&nbsp;            var profileType = EntityType.DEVICE.equals(entityId.getEntityType()) ? EntityType.DEVICE_PROFILE : EntityType.ASSET_PROFILE;</b>
<b class="nc">&nbsp;            builder.oldProfileId(EntityIdFactory.getByTypeAndUuid(profileType, new UUID(proto.getOldProfileIdMSB(), proto.getOldProfileIdLSB())));</b>
&nbsp;        }
<b class="nc">&nbsp;        builder.ownerChanged(proto.getOwnerChanged());</b>
<b class="nc">&nbsp;        if (proto.hasInfo()) {</b>
<b class="nc">&nbsp;            builder.info(JacksonUtil.toJsonNode(proto.getInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static EntityType fromProto(TransportProtos.EntityTypeProto entityType) {
<b class="nc">&nbsp;        return EntityType.forProtoNumber(entityType.getNumber());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.ComponentLifecycleEvent toProto(ComponentLifecycleEvent event) {
<b class="nc">&nbsp;        return TransportProtos.ComponentLifecycleEvent.forNumber(event.getProtoNumber());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ComponentLifecycleEvent fromProto(TransportProtos.ComponentLifecycleEvent eventProto) {
<b class="nc">&nbsp;        return ComponentLifecycleEvent.forProtoNumber(eventProto.getNumber());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.ToEdgeSyncRequestMsgProto toProto(ToEdgeSyncRequest request) {
<b class="nc">&nbsp;        return TransportProtos.ToEdgeSyncRequestMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(request.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(request.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdMSB(request.getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdLSB(request.getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdMSB(request.getEdgeId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdLSB(request.getEdgeId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setServiceId(request.getServiceId())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ToEdgeSyncRequest fromProto(TransportProtos.ToEdgeSyncRequestMsgProto proto) {
<b class="nc">&nbsp;        return new ToEdgeSyncRequest(</b>
<b class="nc">&nbsp;                new UUID(proto.getRequestIdMSB(), proto.getRequestIdLSB()),</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                EdgeId.fromUUID(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB())),</b>
<b class="nc">&nbsp;                proto.getServiceId()</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.FromEdgeSyncResponseMsgProto toProto(FromEdgeSyncResponse response) {
<b class="nc">&nbsp;        return TransportProtos.FromEdgeSyncResponseMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(response.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(response.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setResponseIdMSB(response.getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setResponseIdLSB(response.getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdMSB(response.getEdgeId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdLSB(response.getEdgeId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setSuccess(response.isSuccess())</b>
<b class="nc">&nbsp;                .setError(response.getError())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static FromEdgeSyncResponse fromProto(TransportProtos.FromEdgeSyncResponseMsgProto proto) {
<b class="nc">&nbsp;        return new FromEdgeSyncResponse(</b>
<b class="nc">&nbsp;                new UUID(proto.getResponseIdMSB(), proto.getResponseIdLSB()),</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                EdgeId.fromUUID(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB())),</b>
<b class="nc">&nbsp;                proto.getSuccess(),</b>
<b class="nc">&nbsp;                proto.getError()</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.EdgeEventMsgProto toProto(EdgeEvent edgeEvent) {
<b class="nc">&nbsp;        TransportProtos.EdgeEventMsgProto.Builder builder = TransportProtos.EdgeEventMsgProto.newBuilder();</b>
&nbsp;
<b class="nc">&nbsp;        builder.setTenantIdMSB(edgeEvent.getTenantId().getId().getMostSignificantBits());</b>
<b class="nc">&nbsp;        builder.setTenantIdLSB(edgeEvent.getTenantId().getId().getLeastSignificantBits());</b>
<b class="nc">&nbsp;        builder.setEntityType(edgeEvent.getType().name());</b>
<b class="nc">&nbsp;        builder.setAction(edgeEvent.getAction().name());</b>
&nbsp;
<b class="nc">&nbsp;        if (edgeEvent.getEdgeId() != null) {</b>
<b class="nc">&nbsp;            builder.setEdgeIdMSB(edgeEvent.getEdgeId().getId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setEdgeIdLSB(edgeEvent.getEdgeId().getId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (edgeEvent.getEntityId() != null) {</b>
<b class="nc">&nbsp;            builder.setEntityIdMSB(edgeEvent.getEntityId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setEntityIdLSB(edgeEvent.getEntityId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (edgeEvent.getBody() != null) {</b>
<b class="nc">&nbsp;            builder.setBody(JacksonUtil.toString(edgeEvent.getBody()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static EdgeEvent fromProto(TransportProtos.EdgeEventMsgProto proto) {
<b class="nc">&nbsp;        EdgeEvent edgeEvent = new EdgeEvent();</b>
<b class="nc">&nbsp;        TenantId tenantId = TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB()));</b>
<b class="nc">&nbsp;        edgeEvent.setTenantId(tenantId);</b>
<b class="nc">&nbsp;        edgeEvent.setType(EdgeEventType.valueOf(proto.getEntityType()));</b>
<b class="nc">&nbsp;        edgeEvent.setAction(EdgeEventActionType.valueOf(proto.getAction()));</b>
&nbsp;
<b class="nc">&nbsp;        if (proto.hasEdgeIdMSB() &amp;&amp; proto.hasEdgeIdLSB()) {</b>
<b class="nc">&nbsp;            edgeEvent.setEdgeId(new EdgeId(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB())));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasEntityIdMSB() &amp;&amp; proto.hasEntityIdLSB()) {</b>
<b class="nc">&nbsp;            edgeEvent.setEntityId(new UUID(proto.getEntityIdMSB(), proto.getEntityIdLSB()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasBody()) {</b>
<b class="nc">&nbsp;            edgeEvent.setBody(JacksonUtil.toJsonNode(proto.getBody()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return edgeEvent;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.EdgeHighPriorityMsgProto toProto(EdgeHighPriorityMsg msg) {
<b class="nc">&nbsp;        TransportProtos.EdgeHighPriorityMsgProto.Builder builder = TransportProtos.EdgeHighPriorityMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setType(msg.getEdgeEvent().getType().name())</b>
<b class="nc">&nbsp;                .setAction(msg.getEdgeEvent().getAction().name());</b>
&nbsp;
<b class="nc">&nbsp;        if (msg.getEdgeEvent().getEntityId() != null) {</b>
<b class="nc">&nbsp;            builder.setEntityIdMSB(msg.getEdgeEvent().getEntityId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setEntityIdLSB(msg.getEdgeEvent().getEntityId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getEdgeEvent().getEdgeId() != null) {</b>
<b class="nc">&nbsp;            builder.setEdgeIdMSB(msg.getEdgeEvent().getEdgeId().getId().getMostSignificantBits());</b>
<b class="nc">&nbsp;            builder.setEdgeIdLSB(msg.getEdgeEvent().getEdgeId().getId().getLeastSignificantBits());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getEdgeEvent().getBody() != null) {</b>
<b class="nc">&nbsp;            builder.setBody(JacksonUtil.toString(msg.getEdgeEvent().getBody()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static EdgeHighPriorityMsg fromProto(TransportProtos.EdgeHighPriorityMsgProto proto) {
<b class="nc">&nbsp;        EdgeEventType type = EdgeEventType.valueOf(proto.getType());</b>
<b class="nc">&nbsp;        EdgeEventActionType actionType = EdgeEventActionType.valueOf(proto.getAction());</b>
<b class="nc">&nbsp;        JsonNode body = proto.hasBody() ? JacksonUtil.toJsonNode(proto.getBody()) : null;</b>
&nbsp;
<b class="nc">&nbsp;        EdgeId edgeId = null;</b>
<b class="nc">&nbsp;        if (proto.hasEdgeIdMSB() &amp;&amp; proto.hasEdgeIdLSB()) {</b>
<b class="nc">&nbsp;            edgeId = EdgeId.fromUUID(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        EntityId entityId = null;</b>
<b class="nc">&nbsp;        if (proto.hasEntityIdMSB() &amp;&amp; proto.hasEntityIdLSB()) {</b>
<b class="nc">&nbsp;            entityId = EntityIdFactory.getByEdgeEventTypeAndUuid(type, new UUID(proto.getEntityIdMSB(), proto.getEntityIdLSB()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return new EdgeHighPriorityMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                EdgeUtils.constructEdgeEvent(TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
&nbsp;                        edgeId, type, actionType, entityId, body)
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.EdgeEventUpdateMsgProto toProto(EdgeEventUpdateMsg msg) {
<b class="nc">&nbsp;        return TransportProtos.EdgeEventUpdateMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdMSB(msg.getEdgeId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setEdgeIdLSB(msg.getEdgeId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static EdgeEventUpdateMsg fromProto(TransportProtos.EdgeEventUpdateMsgProto proto) {
<b class="nc">&nbsp;        return new EdgeEventUpdateMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                EdgeId.fromUUID(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB()))</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.DeviceEdgeUpdateMsgProto toProto(DeviceEdgeUpdateMsg msg) {
<b class="nc">&nbsp;        TransportProtos.DeviceEdgeUpdateMsgProto.Builder builder = TransportProtos.DeviceEdgeUpdateMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits());</b>
&nbsp;
<b class="nc">&nbsp;        if (msg.getEdgeId() != null) {</b>
<b class="nc">&nbsp;            builder.setEdgeIdMSB(msg.getEdgeId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                    .setEdgeIdLSB(msg.getEdgeId().getId().getLeastSignificantBits());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static DeviceEdgeUpdateMsg fromProto(TransportProtos.DeviceEdgeUpdateMsgProto proto) {
<b class="nc">&nbsp;        EdgeId edgeId = null;</b>
<b class="nc">&nbsp;        if (proto.hasEdgeIdMSB() &amp;&amp; proto.hasEdgeIdLSB()) {</b>
<b class="nc">&nbsp;            edgeId = EdgeId.fromUUID(new UUID(proto.getEdgeIdMSB(), proto.getEdgeIdLSB()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return new DeviceEdgeUpdateMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
&nbsp;                edgeId);
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.DeviceNameOrTypeUpdateMsgProto toProto(DeviceNameOrTypeUpdateMsg msg) {
<b class="nc">&nbsp;        return TransportProtos.DeviceNameOrTypeUpdateMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceName(msg.getDeviceName())</b>
<b class="nc">&nbsp;                .setDeviceType(msg.getDeviceType())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static DeviceNameOrTypeUpdateMsg fromProto(TransportProtos.DeviceNameOrTypeUpdateMsgProto proto) {
<b class="nc">&nbsp;        return new DeviceNameOrTypeUpdateMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
<b class="nc">&nbsp;                proto.getDeviceName(),</b>
<b class="nc">&nbsp;                proto.getDeviceType()</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.DeviceAttributesEventMsgProto toProto(DeviceAttributesEventNotificationMsg msg) {
<b class="nc">&nbsp;        TransportProtos.DeviceAttributesEventMsgProto.Builder builder = TransportProtos.DeviceAttributesEventMsgProto.newBuilder();</b>
<b class="nc">&nbsp;        builder.setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeleted(msg.isDeleted());</b>
&nbsp;
<b class="nc">&nbsp;        if (msg.getScope() != null) {</b>
<b class="nc">&nbsp;            builder.setScope(TransportProtos.AttributeScopeProto.valueOf(msg.getScope()));</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (msg.getDeletedKeys() != null) {</b>
<b class="nc">&nbsp;            for (AttributeKey key : msg.getDeletedKeys()) {</b>
<b class="nc">&nbsp;                builder.addDeletedKeys(TransportProtos.AttributeKey.newBuilder()</b>
<b class="nc">&nbsp;                        .setScope(TransportProtos.AttributeScopeProto.valueOf(key.getScope()))</b>
<b class="nc">&nbsp;                        .setAttributeKey(key.getAttributeKey())</b>
<b class="nc">&nbsp;                        .build());</b>
&nbsp;            }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (msg.getValues() != null) {</b>
<b class="nc">&nbsp;            for (AttributeKvEntry attributeKvEntry : msg.getValues()) {</b>
<b class="nc">&nbsp;                builder.addValues(toProto(attributeKvEntry));</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.AttributeValueProto toProto(AttributeKvEntry attributeKvEntry) {
<b class="nc">&nbsp;        TransportProtos.AttributeValueProto.Builder builder = TransportProtos.AttributeValueProto.newBuilder()</b>
<b class="nc">&nbsp;                .setLastUpdateTs(attributeKvEntry.getLastUpdateTs())</b>
<b class="nc">&nbsp;                .setKey(attributeKvEntry.getKey());</b>
<b class="nc">&nbsp;        switch (attributeKvEntry.getDataType()) {</b>
&nbsp;            case BOOLEAN:
<b class="nc">&nbsp;                attributeKvEntry.getBooleanValue().ifPresent(builder::setBoolV);</b>
<b class="nc">&nbsp;                builder.setHasV(attributeKvEntry.getBooleanValue().isPresent());</b>
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.BOOLEAN_V);</b>
&nbsp;                break;
&nbsp;            case STRING:
<b class="nc">&nbsp;                attributeKvEntry.getStrValue().ifPresent(builder::setStringV);</b>
<b class="nc">&nbsp;                builder.setHasV(attributeKvEntry.getStrValue().isPresent());</b>
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.STRING_V);</b>
&nbsp;                break;
&nbsp;            case DOUBLE:
<b class="nc">&nbsp;                attributeKvEntry.getDoubleValue().ifPresent(builder::setDoubleV);</b>
<b class="nc">&nbsp;                builder.setHasV(attributeKvEntry.getDoubleValue().isPresent());</b>
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.DOUBLE_V);</b>
&nbsp;                break;
&nbsp;            case LONG:
<b class="nc">&nbsp;                attributeKvEntry.getLongValue().ifPresent(builder::setLongV);</b>
<b class="nc">&nbsp;                builder.setHasV(attributeKvEntry.getLongValue().isPresent());</b>
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.LONG_V);</b>
&nbsp;                break;
&nbsp;            case JSON:
<b class="nc">&nbsp;                attributeKvEntry.getJsonValue().ifPresent(builder::setJsonV);</b>
<b class="nc">&nbsp;                builder.setHasV(attributeKvEntry.getJsonValue().isPresent());</b>
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.JSON_V);</b>
&nbsp;                break;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (attributeKvEntry.getVersion() != null) {</b>
<b class="nc">&nbsp;            builder.setVersion(attributeKvEntry.getVersion());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ApiUsageRecordKeyProto toProto(ApiUsageRecordKey apiUsageRecordKey) {
<b class="nc">&nbsp;        return switch (apiUsageRecordKey) {</b>
<b class="nc">&nbsp;            case TRANSPORT_MSG_COUNT -&gt; ApiUsageRecordKeyProto.TRANSPORT_MSG_COUNT;</b>
<b class="nc">&nbsp;            case TRANSPORT_DP_COUNT -&gt; ApiUsageRecordKeyProto.TRANSPORT_DP_COUNT;</b>
<b class="nc">&nbsp;            case STORAGE_DP_COUNT -&gt; ApiUsageRecordKeyProto.STORAGE_DP_COUNT;</b>
<b class="nc">&nbsp;            case RE_EXEC_COUNT -&gt; ApiUsageRecordKeyProto.RE_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case JS_EXEC_COUNT -&gt; ApiUsageRecordKeyProto.JS_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case TBEL_EXEC_COUNT -&gt; ApiUsageRecordKeyProto.TBEL_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case EMAIL_EXEC_COUNT -&gt; ApiUsageRecordKeyProto.EMAIL_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case SMS_EXEC_COUNT -&gt; ApiUsageRecordKeyProto.SMS_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case CREATED_ALARMS_COUNT -&gt; ApiUsageRecordKeyProto.CREATED_ALARMS_COUNT;</b>
<b class="nc">&nbsp;            case ACTIVE_DEVICES -&gt; ApiUsageRecordKeyProto.ACTIVE_DEVICES;</b>
<b class="nc">&nbsp;            case INACTIVE_DEVICES -&gt; ApiUsageRecordKeyProto.INACTIVE_DEVICES;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static ApiUsageRecordKey fromProto(ApiUsageRecordKeyProto proto) {
<b class="nc">&nbsp;        return switch (proto) {</b>
<b class="nc">&nbsp;            case UNRECOGNIZED -&gt; null;</b>
<b class="nc">&nbsp;            case TRANSPORT_MSG_COUNT -&gt; ApiUsageRecordKey.TRANSPORT_MSG_COUNT;</b>
<b class="nc">&nbsp;            case TRANSPORT_DP_COUNT -&gt; ApiUsageRecordKey.TRANSPORT_DP_COUNT;</b>
<b class="nc">&nbsp;            case STORAGE_DP_COUNT -&gt; ApiUsageRecordKey.STORAGE_DP_COUNT;</b>
<b class="nc">&nbsp;            case RE_EXEC_COUNT -&gt; ApiUsageRecordKey.RE_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case JS_EXEC_COUNT -&gt; ApiUsageRecordKey.JS_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case TBEL_EXEC_COUNT -&gt; ApiUsageRecordKey.TBEL_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case EMAIL_EXEC_COUNT -&gt; ApiUsageRecordKey.EMAIL_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case SMS_EXEC_COUNT -&gt; ApiUsageRecordKey.SMS_EXEC_COUNT;</b>
<b class="nc">&nbsp;            case CREATED_ALARMS_COUNT -&gt; ApiUsageRecordKey.CREATED_ALARMS_COUNT;</b>
<b class="nc">&nbsp;            case ACTIVE_DEVICES -&gt; ApiUsageRecordKey.ACTIVE_DEVICES;</b>
<b class="nc">&nbsp;            case INACTIVE_DEVICES -&gt; ApiUsageRecordKey.INACTIVE_DEVICES;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    private static ToDeviceActorNotificationMsg fromProto(TransportProtos.DeviceAttributesEventMsgProto proto) {
<b class="nc">&nbsp;        return new DeviceAttributesEventNotificationMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
<b class="nc">&nbsp;                getAttributeKeySetFromProto(proto.getDeletedKeysList()),</b>
<b class="nc">&nbsp;                proto.hasScope() ? proto.getScope().name() : null,</b>
<b class="nc">&nbsp;                getAttributesKvEntryFromProto(proto.getValuesList()),</b>
<b class="nc">&nbsp;                proto.getDeleted()</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.DeviceCredentialsUpdateMsgProto toProto(DeviceCredentialsUpdateNotificationMsg msg) {
<b class="nc">&nbsp;        TransportProtos.DeviceCredentialsProto.Builder protoBuilder = TransportProtos.DeviceCredentialsProto.newBuilder()</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceCredentials().getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceCredentials().getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setCredentialsId(msg.getDeviceCredentials().getCredentialsId())</b>
<b class="nc">&nbsp;                .setCredentialsType(TransportProtos.CredentialsType.valueOf(msg.getDeviceCredentials().getCredentialsType().name()));</b>
&nbsp;
<b class="nc">&nbsp;        if (msg.getDeviceCredentials().getCredentialsValue() != null) {</b>
<b class="nc">&nbsp;            protoBuilder.setCredentialsValue(msg.getDeviceCredentials().getCredentialsValue());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return TransportProtos.DeviceCredentialsUpdateMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceCredentials(protoBuilder.build())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static ToDeviceActorNotificationMsg fromProto(TransportProtos.DeviceCredentialsUpdateMsgProto proto) {
<b class="nc">&nbsp;        DeviceCredentials deviceCredentials = new DeviceCredentials();</b>
<b class="nc">&nbsp;        deviceCredentials.setDeviceId(new DeviceId(new UUID(proto.getDeviceCredentials().getDeviceIdMSB(), proto.getDeviceCredentials().getDeviceIdLSB())));</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsId(proto.getDeviceCredentials().getCredentialsId());</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsValue(proto.getDeviceCredentials().hasCredentialsValue() ? proto.getDeviceCredentials().getCredentialsValue() : null);</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsType(DeviceCredentialsType.valueOf(proto.getDeviceCredentials().getCredentialsType().name()));</b>
<b class="nc">&nbsp;        return new DeviceCredentialsUpdateNotificationMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
&nbsp;                deviceCredentials
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.ToDeviceRpcRequestActorMsgProto toProto(ToDeviceRpcRequestActorMsg msg) {
<b class="nc">&nbsp;        TransportProtos.ToDeviceRpcRequestMsg.Builder builder = TransportProtos.ToDeviceRpcRequestMsg.newBuilder()</b>
<b class="nc">&nbsp;                .setMethodName(msg.getMsg().getBody().getMethod())</b>
<b class="nc">&nbsp;                .setParams(msg.getMsg().getBody().getParams())</b>
<b class="nc">&nbsp;                .setExpirationTime(msg.getMsg().getExpirationTime())</b>
<b class="nc">&nbsp;                .setRequestIdMSB(msg.getMsg().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdLSB(msg.getMsg().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setOneway(msg.getMsg().isOneway())</b>
<b class="nc">&nbsp;                .setPersisted(msg.getMsg().isPersisted());</b>
<b class="nc">&nbsp;        if (msg.getMsg().getAdditionalInfo() != null) {</b>
<b class="nc">&nbsp;            builder.setAdditionalInfo(msg.getMsg().getAdditionalInfo());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.getMsg().getRetries() != null) {</b>
<b class="nc">&nbsp;            builder.setRetries(msg.getMsg().getRetries());</b>
&nbsp;        }
<b class="nc">&nbsp;        TransportProtos.ToDeviceRpcRequestMsg proto = builder.build();</b>
&nbsp;
<b class="nc">&nbsp;        return TransportProtos.ToDeviceRpcRequestActorMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setServiceId(msg.getServiceId())</b>
<b class="nc">&nbsp;                .setToDeviceRpcRequestMsg(proto)</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static ToDeviceActorNotificationMsg fromProto(TransportProtos.ToDeviceRpcRequestActorMsgProto proto) {
<b class="nc">&nbsp;        TransportProtos.ToDeviceRpcRequestMsg toDeviceRpcRequestMsg = proto.getToDeviceRpcRequestMsg();</b>
<b class="nc">&nbsp;        ToDeviceRpcRequest toDeviceRpcRequest = new ToDeviceRpcRequest(</b>
<b class="nc">&nbsp;                new UUID(toDeviceRpcRequestMsg.getRequestIdMSB(), toDeviceRpcRequestMsg.getRequestIdLSB()),</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
<b class="nc">&nbsp;                toDeviceRpcRequestMsg.getOneway(),</b>
<b class="nc">&nbsp;                toDeviceRpcRequestMsg.getExpirationTime(),</b>
<b class="nc">&nbsp;                new ToDeviceRpcRequestBody(toDeviceRpcRequestMsg.getMethodName(), toDeviceRpcRequestMsg.getParams()),</b>
<b class="nc">&nbsp;                toDeviceRpcRequestMsg.getPersisted(),</b>
<b class="nc">&nbsp;                toDeviceRpcRequestMsg.hasRetries() ? toDeviceRpcRequestMsg.getRetries() : null,</b>
<b class="nc">&nbsp;                toDeviceRpcRequestMsg.hasAdditionalInfo() ? toDeviceRpcRequestMsg.getAdditionalInfo() : null);</b>
<b class="nc">&nbsp;        return new ToDeviceRpcRequestActorMsg(proto.getServiceId(), toDeviceRpcRequest);</b>
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.FromDeviceRpcResponseActorMsgProto toProto(FromDeviceRpcResponseActorMsg msg) {
<b class="nc">&nbsp;        TransportProtos.FromDeviceRPCResponseProto.Builder builder = TransportProtos.FromDeviceRPCResponseProto.newBuilder()</b>
<b class="nc">&nbsp;                .setRequestIdMSB(msg.getMsg().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdLSB(msg.getMsg().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setError(msg.getMsg().getError().isPresent() ? msg.getMsg().getError().get().ordinal() : -1);</b>
<b class="nc">&nbsp;        if (msg.getMsg().getResponse().isPresent()) {</b>
<b class="nc">&nbsp;            builder.setResponse(msg.getMsg().getResponse().get());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return TransportProtos.FromDeviceRpcResponseActorMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setRequestId(msg.getRequestId())</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setRpcResponse(builder.build())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static ToDeviceActorNotificationMsg fromProto(TransportProtos.FromDeviceRpcResponseActorMsgProto proto) {
<b class="nc">&nbsp;        FromDeviceRpcResponse fromDeviceRpcResponse = new FromDeviceRpcResponse(</b>
<b class="nc">&nbsp;                new UUID(proto.getRpcResponse().getRequestIdMSB(), proto.getRpcResponse().getRequestIdLSB()),</b>
<b class="nc">&nbsp;                proto.getRpcResponse().getResponse(),</b>
<b class="nc">&nbsp;                proto.getRpcResponse().getError() &gt;= 0 ? RpcError.values()[proto.getRpcResponse().getError()] : null);</b>
<b class="nc">&nbsp;        return new FromDeviceRpcResponseActorMsg(</b>
<b class="nc">&nbsp;                proto.getRequestId(),</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
&nbsp;                fromDeviceRpcResponse
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.RemoveRpcActorMsgProto toProto(RemoveRpcActorMsg msg) {
<b class="nc">&nbsp;        return TransportProtos.RemoveRpcActorMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdMSB(msg.getRequestId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setRequestIdLSB(msg.getRequestId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static ToDeviceActorNotificationMsg fromProto(TransportProtos.RemoveRpcActorMsgProto proto) {
<b class="nc">&nbsp;        return new RemoveRpcActorMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())),</b>
<b class="nc">&nbsp;                new UUID(proto.getRequestIdMSB(), proto.getRequestIdLSB())</b>
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private static TransportProtos.DeviceDeleteMsgProto toProto(DeviceDeleteMsg msg) {
<b class="nc">&nbsp;        return TransportProtos.DeviceDeleteMsgProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(msg.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(msg.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(msg.getDeviceId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(msg.getDeviceId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    private static DeviceDeleteMsg fromProto(TransportProtos.DeviceDeleteMsgProto proto) {
<b class="nc">&nbsp;        return new DeviceDeleteMsg(</b>
<b class="nc">&nbsp;                TenantId.fromUUID(new UUID(proto.getTenantIdMSB(), proto.getTenantIdLSB())),</b>
<b class="nc">&nbsp;                new DeviceId(new UUID(proto.getDeviceIdMSB(), proto.getDeviceIdLSB())));</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.ToDeviceActorNotificationMsgProto toProto(ToDeviceActorNotificationMsg msg) {
<b class="nc">&nbsp;        if (msg instanceof DeviceEdgeUpdateMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.DeviceEdgeUpdateMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setDeviceEdgeUpdateMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof DeviceNameOrTypeUpdateMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.DeviceNameOrTypeUpdateMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setDeviceNameOrTypeMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof DeviceAttributesEventNotificationMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.DeviceAttributesEventMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setDeviceAttributesEventMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof DeviceCredentialsUpdateNotificationMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.DeviceCredentialsUpdateMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setDeviceCredentialsUpdateMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof ToDeviceRpcRequestActorMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.ToDeviceRpcRequestActorMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setToDeviceRpcRequestMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof FromDeviceRpcResponseActorMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.FromDeviceRpcResponseActorMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setFromDeviceRpcResponseMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof RemoveRpcActorMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.RemoveRpcActorMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setRemoveRpcActorMsg(proto).build();</b>
<b class="nc">&nbsp;        } else if (msg instanceof DeviceDeleteMsg updateMsg) {</b>
<b class="nc">&nbsp;            TransportProtos.DeviceDeleteMsgProto proto = toProto(updateMsg);</b>
<b class="nc">&nbsp;            return TransportProtos.ToDeviceActorNotificationMsgProto.newBuilder().setDeviceDeleteMsg(proto).build();</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ToDeviceActorNotificationMsg fromProto(TransportProtos.ToDeviceActorNotificationMsgProto proto) {
<b class="nc">&nbsp;        if (proto.hasDeviceEdgeUpdateMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getDeviceEdgeUpdateMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasDeviceNameOrTypeMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getDeviceNameOrTypeMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasDeviceAttributesEventMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getDeviceAttributesEventMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasDeviceCredentialsUpdateMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getDeviceCredentialsUpdateMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasToDeviceRpcRequestMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getToDeviceRpcRequestMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasFromDeviceRpcResponseMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getFromDeviceRpcResponseMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasRemoveRpcActorMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getRemoveRpcActorMsg());</b>
<b class="nc">&nbsp;        } else if (proto.hasDeviceDeleteMsg()) {</b>
<b class="nc">&nbsp;            return fromProto(proto.getDeviceDeleteMsg());</b>
&nbsp;        }
<b class="nc">&nbsp;        return null;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Set&lt;AttributeKey&gt; getAttributeKeySetFromProto(List&lt;TransportProtos.AttributeKey&gt; deletedKeysList) {
<b class="nc">&nbsp;        if (deletedKeysList.isEmpty()) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return deletedKeysList.stream()</b>
<b class="nc">&nbsp;                .map(attributeKey -&gt; new AttributeKey(attributeKey.getScope().name(), attributeKey.getAttributeKey()))</b>
<b class="nc">&nbsp;                .collect(Collectors.toSet());</b>
&nbsp;    }
&nbsp;
&nbsp;    private static List&lt;AttributeKvEntry&gt; getAttributesKvEntryFromProto(List&lt;TransportProtos.AttributeValueProto&gt; valuesList) {
<b class="nc">&nbsp;        if (valuesList.isEmpty()) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        List&lt;AttributeKvEntry&gt; result = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;        for (TransportProtos.AttributeValueProto kvEntry : valuesList) {</b>
<b class="nc">&nbsp;            result.add(fromProto(kvEntry));</b>
&nbsp;        }
<b class="nc">&nbsp;        return result;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static AttributeKvEntry fromProto(TransportProtos.AttributeValueProto proto) {
<b class="nc">&nbsp;        boolean hasValue = proto.getHasV();</b>
<b class="nc">&nbsp;        String key = proto.getKey();</b>
<b class="nc">&nbsp;        KvEntry entry = switch (proto.getType()) {</b>
<b class="nc">&nbsp;            case BOOLEAN_V -&gt; new BooleanDataEntry(key, hasValue ? proto.getBoolV() : null);</b>
<b class="nc">&nbsp;            case LONG_V -&gt; new LongDataEntry(key, hasValue ? proto.getLongV() : null);</b>
<b class="nc">&nbsp;            case DOUBLE_V -&gt; new DoubleDataEntry(key, hasValue ? proto.getDoubleV() : null);</b>
<b class="nc">&nbsp;            case STRING_V -&gt; new StringDataEntry(key, hasValue ? proto.getStringV() : null);</b>
<b class="nc">&nbsp;            case JSON_V -&gt; new JsonDataEntry(key, hasValue ? proto.getJsonV() : null);</b>
<b class="nc">&nbsp;            default -&gt; null;</b>
&nbsp;        };
<b class="nc">&nbsp;        return new BaseAttributeKvEntry(entry, proto.getLastUpdateTs(), proto.hasVersion() ? proto.getVersion() : null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static BasicKvEntry basicKvEntryFromProto(TransportProtos.AttributeValueProto proto) {
<b class="nc">&nbsp;        boolean hasValue = proto.getHasV();</b>
<b class="nc">&nbsp;        String key = proto.getKey();</b>
<b class="nc">&nbsp;        return switch (proto.getType()) {</b>
<b class="nc">&nbsp;            case BOOLEAN_V -&gt; new BooleanDataEntry(key, hasValue ? proto.getBoolV() : null);</b>
<b class="nc">&nbsp;            case LONG_V -&gt; new LongDataEntry(key, hasValue ? proto.getLongV() : null);</b>
<b class="nc">&nbsp;            case DOUBLE_V -&gt; new DoubleDataEntry(key, hasValue ? proto.getDoubleV() : null);</b>
<b class="nc">&nbsp;            case STRING_V -&gt; new StringDataEntry(key, hasValue ? proto.getStringV() : null);</b>
<b class="nc">&nbsp;            case JSON_V -&gt; new JsonDataEntry(key, hasValue ? proto.getJsonV() : null);</b>
<b class="nc">&nbsp;            default -&gt; null;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static BasicKvEntry fromProto(KeyValueProto proto) {
<b class="nc">&nbsp;        String key = proto.getKey();</b>
<b class="nc">&nbsp;        return switch (proto.getType()) {</b>
<b class="nc">&nbsp;            case BOOLEAN_V -&gt; new BooleanDataEntry(key, proto.getBoolV());</b>
<b class="nc">&nbsp;            case LONG_V -&gt; new LongDataEntry(key, proto.getLongV());</b>
<b class="nc">&nbsp;            case DOUBLE_V -&gt; new DoubleDataEntry(key, proto.getDoubleV());</b>
<b class="nc">&nbsp;            case STRING_V -&gt; new StringDataEntry(key, proto.getStringV());</b>
<b class="nc">&nbsp;            case JSON_V -&gt; new JsonDataEntry(key, proto.getJsonV());</b>
<b class="nc">&nbsp;            default -&gt; null;</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static BasicKvEntry basicKvEntryFromKvEntry(KvEntry kvEntry) {
<b class="nc">&nbsp;        String key = kvEntry.getKey();</b>
<b class="nc">&nbsp;        return switch (kvEntry.getDataType()) {</b>
<b class="nc">&nbsp;            case BOOLEAN -&gt; new BooleanDataEntry(key, kvEntry.getBooleanValue().orElse(null));</b>
<b class="nc">&nbsp;            case LONG -&gt; new LongDataEntry(key, kvEntry.getLongValue().orElse(null));</b>
<b class="nc">&nbsp;            case DOUBLE -&gt; new DoubleDataEntry(key, kvEntry.getDoubleValue().orElse(null));</b>
<b class="nc">&nbsp;            case STRING -&gt; new StringDataEntry(key, kvEntry.getStrValue().orElse(null));</b>
<b class="nc">&nbsp;            case JSON -&gt; new JsonDataEntry(key, kvEntry.getJsonValue().orElse(null));</b>
&nbsp;        };
&nbsp;    }
&nbsp;
&nbsp;    public static TsKvEntry fromProto(TransportProtos.TsKvProto proto) {
<b class="nc">&nbsp;        TransportProtos.KeyValueProto kvProto = proto.getKv();</b>
<b class="nc">&nbsp;        String key = kvProto.getKey();</b>
<b class="nc">&nbsp;        KvEntry entry = switch (kvProto.getType()) {</b>
<b class="nc">&nbsp;            case BOOLEAN_V -&gt; new BooleanDataEntry(key, kvProto.getBoolV());</b>
<b class="nc">&nbsp;            case LONG_V -&gt; new LongDataEntry(key, kvProto.getLongV());</b>
<b class="nc">&nbsp;            case DOUBLE_V -&gt; new DoubleDataEntry(key, kvProto.getDoubleV());</b>
<b class="nc">&nbsp;            case STRING_V -&gt; new StringDataEntry(key, kvProto.getStringV());</b>
<b class="nc">&nbsp;            case JSON_V -&gt; new JsonDataEntry(key, kvProto.getJsonV());</b>
<b class="nc">&nbsp;            default -&gt; null;</b>
&nbsp;        };
<b class="nc">&nbsp;        return new BasicTsKvEntry(proto.getTs(), entry, proto.hasVersion() ? proto.getVersion() : null);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.TsKvProto toTsKvProto(TsKvEntry tsKvEntry) {
<b class="nc">&nbsp;        var builder = TransportProtos.TsKvProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTs(tsKvEntry.getTs())</b>
<b class="nc">&nbsp;                .setKv(toKeyValueProto(tsKvEntry));</b>
<b class="nc">&nbsp;        if (tsKvEntry.getVersion() != null) {</b>
<b class="nc">&nbsp;            builder.setVersion(tsKvEntry.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.KeyValueProto toKeyValueProto(KvEntry kvEntry) {
<b class="nc">&nbsp;        TransportProtos.KeyValueProto.Builder builder = TransportProtos.KeyValueProto.newBuilder();</b>
<b class="nc">&nbsp;        builder.setKey(kvEntry.getKey());</b>
<b class="nc">&nbsp;        switch (kvEntry.getDataType()) {</b>
&nbsp;            case BOOLEAN:
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.BOOLEAN_V)</b>
<b class="nc">&nbsp;                        .setBoolV(kvEntry.getBooleanValue().orElse(false));</b>
&nbsp;                break;
&nbsp;            case LONG:
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.LONG_V)</b>
<b class="nc">&nbsp;                        .setLongV(kvEntry.getLongValue().orElse(0L));</b>
&nbsp;                break;
&nbsp;            case DOUBLE:
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.DOUBLE_V)</b>
<b class="nc">&nbsp;                        .setDoubleV(kvEntry.getDoubleValue().orElse(0.0));</b>
&nbsp;                break;
&nbsp;            case STRING:
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.STRING_V)</b>
<b class="nc">&nbsp;                        .setStringV(kvEntry.getStrValue().orElse(&quot;&quot;));</b>
&nbsp;                break;
&nbsp;            case JSON:
<b class="nc">&nbsp;                builder.setType(TransportProtos.KeyValueType.JSON_V)</b>
<b class="nc">&nbsp;                        .setJsonV(kvEntry.getJsonValue().orElse(&quot;{}&quot;));</b>
&nbsp;                break;
&nbsp;            default:
<b class="nc">&nbsp;                throw new IllegalArgumentException(&quot;Unsupported KvEntry data type: &quot; + kvEntry.getDataType());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.DeviceProto toProto(Device device) {
<b class="nc">&nbsp;        var builder = TransportProtos.DeviceProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(device.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(device.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(device.getId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(device.getId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setCreatedTime(device.getCreatedTime())</b>
<b class="nc">&nbsp;                .setDeviceName(device.getName())</b>
<b class="nc">&nbsp;                .setDeviceType(device.getType())</b>
<b class="nc">&nbsp;                .setDeviceProfileIdMSB(device.getDeviceProfileId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceProfileIdLSB(device.getDeviceProfileId().getId().getLeastSignificantBits());</b>
&nbsp;
<b class="nc">&nbsp;        if (isNotNull(device.getCustomerId())) {</b>
<b class="nc">&nbsp;            builder.setCustomerIdMSB(getMsb(device.getCustomerId()))</b>
<b class="nc">&nbsp;                    .setCustomerIdLSB(getLsb(device.getCustomerId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getLabel())) {</b>
<b class="nc">&nbsp;            builder.setDeviceLabel(device.getLabel());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getAdditionalInfo())) {</b>
<b class="nc">&nbsp;            builder.setAdditionalInfo(JacksonUtil.toString(device.getAdditionalInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getFirmwareId())) {</b>
<b class="nc">&nbsp;            builder.setFirmwareIdMSB(getMsb(device.getFirmwareId()))</b>
<b class="nc">&nbsp;                    .setFirmwareIdLSB(getLsb(device.getFirmwareId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getSoftwareId())) {</b>
<b class="nc">&nbsp;            builder.setSoftwareIdMSB(getMsb(device.getSoftwareId()))</b>
<b class="nc">&nbsp;                    .setSoftwareIdLSB(getLsb(device.getSoftwareId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getExternalId())) {</b>
<b class="nc">&nbsp;            builder.setExternalIdMSB(getMsb(device.getExternalId()))</b>
<b class="nc">&nbsp;                    .setExternalIdLSB(getLsb(device.getExternalId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getDeviceDataBytes())) {</b>
<b class="nc">&nbsp;            builder.setDeviceData(ByteString.copyFrom(device.getDeviceDataBytes()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(device.getVersion())) {</b>
<b class="nc">&nbsp;            builder.setVersion(device.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Device fromProto(TransportProtos.DeviceProto proto) {
<b class="nc">&nbsp;        Device device = new Device(getEntityId(proto.getDeviceIdMSB(), proto.getDeviceIdLSB(), DeviceId::new));</b>
<b class="nc">&nbsp;        device.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        device.setTenantId(getEntityId(proto.getTenantIdMSB(), proto.getTenantIdLSB(), TenantId::fromUUID));</b>
<b class="nc">&nbsp;        device.setName(proto.getDeviceName());</b>
<b class="nc">&nbsp;        device.setType(proto.getDeviceType());</b>
<b class="nc">&nbsp;        device.setDeviceProfileId(getEntityId(proto.getDeviceProfileIdMSB(), proto.getDeviceProfileIdLSB(), DeviceProfileId::new));</b>
<b class="nc">&nbsp;        if (proto.hasCustomerIdMSB() &amp;&amp; proto.hasCustomerIdLSB()) {</b>
<b class="nc">&nbsp;            device.setCustomerId(getEntityId(proto.getCustomerIdMSB(), proto.getCustomerIdLSB(), CustomerId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDeviceLabel()) {</b>
<b class="nc">&nbsp;            device.setLabel(proto.getDeviceLabel());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasAdditionalInfo()) {</b>
<b class="nc">&nbsp;            device.setAdditionalInfo(JacksonUtil.toJsonNode(proto.getAdditionalInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasFirmwareIdMSB() &amp;&amp; proto.hasFirmwareIdLSB()) {</b>
<b class="nc">&nbsp;            device.setFirmwareId(getEntityId(proto.getFirmwareIdMSB(), proto.getFirmwareIdLSB(), OtaPackageId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasSoftwareIdMSB() &amp;&amp; proto.hasSoftwareIdLSB()) {</b>
<b class="nc">&nbsp;            device.setSoftwareId(getEntityId(proto.getSoftwareIdMSB(), proto.getSoftwareIdLSB(), OtaPackageId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasExternalIdMSB() &amp;&amp; proto.hasExternalIdLSB()) {</b>
<b class="nc">&nbsp;            device.setExternalId(getEntityId(proto.getExternalIdMSB(), proto.getExternalIdLSB(), DeviceId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDeviceData()) {</b>
<b class="nc">&nbsp;            device.setDeviceDataBytes(proto.getDeviceData().toByteArray());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasVersion()) {</b>
<b class="nc">&nbsp;            device.setVersion(proto.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return device;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.DeviceProfileProto toProto(DeviceProfile deviceProfile) {
<b class="nc">&nbsp;        var builder = TransportProtos.DeviceProfileProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(getMsb(deviceProfile.getTenantId()))</b>
<b class="nc">&nbsp;                .setTenantIdLSB(getLsb(deviceProfile.getTenantId()))</b>
<b class="nc">&nbsp;                .setDeviceProfileIdMSB(getMsb(deviceProfile.getId()))</b>
<b class="nc">&nbsp;                .setDeviceProfileIdLSB(getLsb(deviceProfile.getId()))</b>
<b class="nc">&nbsp;                .setCreatedTime(deviceProfile.getCreatedTime())</b>
<b class="nc">&nbsp;                .setName(deviceProfile.getName())</b>
<b class="nc">&nbsp;                .setIsDefault(deviceProfile.isDefault())</b>
<b class="nc">&nbsp;                .setType(deviceProfile.getType().name())</b>
<b class="nc">&nbsp;                .setTransportType(deviceProfile.getTransportType().name())</b>
<b class="nc">&nbsp;                .setProvisionType(deviceProfile.getProvisionType().name());</b>
&nbsp;
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getProfileDataBytes())) {</b>
<b class="nc">&nbsp;            builder.setDeviceProfileData(ByteString.copyFrom(deviceProfile.getProfileDataBytes()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getDescription())) {</b>
<b class="nc">&nbsp;            builder.setDescription(deviceProfile.getDescription());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getImage())) {</b>
<b class="nc">&nbsp;            builder.setImage(deviceProfile.getImage());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getDefaultRuleChainId())) {</b>
<b class="nc">&nbsp;            builder.setDefaultRuleChainIdMSB(getMsb(deviceProfile.getDefaultRuleChainId()))</b>
<b class="nc">&nbsp;                    .setDefaultRuleChainIdLSB(getLsb(deviceProfile.getDefaultRuleChainId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getDefaultDashboardId())) {</b>
<b class="nc">&nbsp;            builder.setDefaultDashboardIdMSB(getMsb(deviceProfile.getDefaultDashboardId()))</b>
<b class="nc">&nbsp;                    .setDefaultDashboardIdLSB(getLsb(deviceProfile.getDefaultDashboardId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getDefaultQueueName())) {</b>
<b class="nc">&nbsp;            builder.setDefaultQueueName(deviceProfile.getDefaultQueueName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getProvisionDeviceKey())) {</b>
<b class="nc">&nbsp;            builder.setProvisionDeviceKey(deviceProfile.getProvisionDeviceKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getFirmwareId())) {</b>
<b class="nc">&nbsp;            builder.setFirmwareIdMSB(getMsb(deviceProfile.getFirmwareId()))</b>
<b class="nc">&nbsp;                    .setFirmwareIdLSB(getLsb(deviceProfile.getFirmwareId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getSoftwareId())) {</b>
<b class="nc">&nbsp;            builder.setSoftwareIdMSB(getMsb(deviceProfile.getSoftwareId()))</b>
<b class="nc">&nbsp;                    .setSoftwareIdLSB(getLsb(deviceProfile.getSoftwareId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getExternalId())) {</b>
<b class="nc">&nbsp;            builder.setExternalIdMSB(getMsb(deviceProfile.getExternalId()))</b>
<b class="nc">&nbsp;                    .setExternalIdLSB(getLsb(deviceProfile.getExternalId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getDefaultEdgeRuleChainId())) {</b>
<b class="nc">&nbsp;            builder.setDefaultEdgeRuleChainIdMSB(getMsb(deviceProfile.getDefaultEdgeRuleChainId()))</b>
<b class="nc">&nbsp;                    .setDefaultEdgeRuleChainIdLSB(getLsb(deviceProfile.getDefaultEdgeRuleChainId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(deviceProfile.getVersion())) {</b>
<b class="nc">&nbsp;            builder.setVersion(deviceProfile.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static DeviceProfile fromProto(TransportProtos.DeviceProfileProto proto) {
<b class="nc">&nbsp;        DeviceProfile deviceProfile = new DeviceProfile(getEntityId(proto.getDeviceProfileIdMSB(), proto.getDeviceProfileIdLSB(), DeviceProfileId::new));</b>
<b class="nc">&nbsp;        deviceProfile.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        deviceProfile.setTenantId(getEntityId(proto.getTenantIdMSB(), proto.getTenantIdLSB(), TenantId::fromUUID));</b>
<b class="nc">&nbsp;        deviceProfile.setName(proto.getName());</b>
<b class="nc">&nbsp;        deviceProfile.setDefault(proto.getIsDefault());</b>
<b class="nc">&nbsp;        deviceProfile.setType(DeviceProfileType.valueOf(proto.getType()));</b>
<b class="nc">&nbsp;        deviceProfile.setTransportType(DeviceTransportType.valueOf(proto.getTransportType()));</b>
<b class="nc">&nbsp;        deviceProfile.setProvisionType(DeviceProfileProvisionType.valueOf(proto.getProvisionType()));</b>
<b class="nc">&nbsp;        if (proto.hasDeviceProfileData()) {</b>
<b class="nc">&nbsp;            deviceProfile.setProfileDataBytes(proto.getDeviceProfileData().toByteArray());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDescription()) {</b>
<b class="nc">&nbsp;            deviceProfile.setDescription(proto.getDescription());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasImage()) {</b>
<b class="nc">&nbsp;            deviceProfile.setImage(proto.getImage());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDefaultRuleChainIdMSB() &amp;&amp; proto.hasDefaultRuleChainIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setDefaultRuleChainId(getEntityId(proto.getDefaultRuleChainIdMSB(), proto.getDefaultRuleChainIdLSB(), RuleChainId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDefaultDashboardIdMSB() &amp;&amp; proto.hasDefaultDashboardIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setDefaultDashboardId(getEntityId(proto.getDefaultDashboardIdMSB(), proto.getDefaultDashboardIdLSB(), DashboardId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDefaultQueueName()) {</b>
<b class="nc">&nbsp;            deviceProfile.setDefaultQueueName(proto.getDefaultQueueName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasProvisionDeviceKey()) {</b>
<b class="nc">&nbsp;            deviceProfile.setProvisionDeviceKey(proto.getProvisionDeviceKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasFirmwareIdMSB() &amp;&amp; proto.hasFirmwareIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setFirmwareId(getEntityId(proto.getFirmwareIdMSB(), proto.getFirmwareIdLSB(), OtaPackageId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasSoftwareIdMSB() &amp;&amp; proto.hasSoftwareIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setSoftwareId(getEntityId(proto.getSoftwareIdMSB(), proto.getSoftwareIdLSB(), OtaPackageId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasExternalIdMSB() &amp;&amp; proto.hasExternalIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setExternalId(getEntityId(proto.getExternalIdMSB(), proto.getExternalIdLSB(), DeviceProfileId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDefaultEdgeRuleChainIdMSB() &amp;&amp; proto.hasDefaultEdgeRuleChainIdLSB()) {</b>
<b class="nc">&nbsp;            deviceProfile.setDefaultEdgeRuleChainId(getEntityId(proto.getDefaultEdgeRuleChainIdMSB(), proto.getDefaultEdgeRuleChainIdLSB(), RuleChainId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasVersion()) {</b>
<b class="nc">&nbsp;            deviceProfile.setVersion(proto.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return deviceProfile;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.TenantProto toProto(Tenant tenant) {
<b class="nc">&nbsp;        var builder = TransportProtos.TenantProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(getMsb(tenant.getTenantId()))</b>
<b class="nc">&nbsp;                .setTenantIdLSB(getLsb(tenant.getTenantId()))</b>
<b class="nc">&nbsp;                .setCreatedTime(tenant.getCreatedTime())</b>
<b class="nc">&nbsp;                .setTenantProfileIdMSB(getMsb(tenant.getTenantProfileId()))</b>
<b class="nc">&nbsp;                .setTenantProfileIdLSB(getLsb(tenant.getTenantProfileId()))</b>
<b class="nc">&nbsp;                .setTitle(tenant.getTitle());</b>
&nbsp;
<b class="nc">&nbsp;        if (isNotNull(tenant.getRegion())) {</b>
<b class="nc">&nbsp;            builder.setRegion(tenant.getRegion());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getCountry())) {</b>
<b class="nc">&nbsp;            builder.setCountry(tenant.getCountry());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getState())) {</b>
<b class="nc">&nbsp;            builder.setState(tenant.getState());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getCity())) {</b>
<b class="nc">&nbsp;            builder.setCity(tenant.getCity());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getAddress())) {</b>
<b class="nc">&nbsp;            builder.setAddress(tenant.getAddress());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getAddress2())) {</b>
<b class="nc">&nbsp;            builder.setAddress2(tenant.getAddress2());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getZip())) {</b>
<b class="nc">&nbsp;            builder.setZip(tenant.getZip());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getPhone())) {</b>
<b class="nc">&nbsp;            builder.setPhone(tenant.getPhone());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getEmail())) {</b>
<b class="nc">&nbsp;            builder.setEmail(tenant.getEmail());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getAdditionalInfo())) {</b>
<b class="nc">&nbsp;            builder.setAdditionalInfo(JacksonUtil.toString(tenant.getAdditionalInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenant.getVersion())) {</b>
<b class="nc">&nbsp;            builder.setVersion(tenant.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Tenant fromProto(TransportProtos.TenantProto proto) {
<b class="nc">&nbsp;        Tenant tenant = new Tenant(getEntityId(proto.getTenantIdMSB(), proto.getTenantIdLSB(), TenantId::fromUUID));</b>
<b class="nc">&nbsp;        tenant.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        tenant.setTenantProfileId(getEntityId(proto.getTenantProfileIdMSB(), proto.getTenantProfileIdLSB(), TenantProfileId::new));</b>
<b class="nc">&nbsp;        tenant.setTitle(proto.getTitle());</b>
&nbsp;
<b class="nc">&nbsp;        if (proto.hasRegion()) {</b>
<b class="nc">&nbsp;            tenant.setRegion(proto.getRegion());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasCountry()) {</b>
<b class="nc">&nbsp;            tenant.setCountry(proto.getCountry());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasState()) {</b>
<b class="nc">&nbsp;            tenant.setState(proto.getState());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasCity()) {</b>
<b class="nc">&nbsp;            tenant.setCity(proto.getCity());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasAddress()) {</b>
<b class="nc">&nbsp;            tenant.setAddress(proto.getAddress());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasAddress2()) {</b>
<b class="nc">&nbsp;            tenant.setAddress2(proto.getAddress2());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasZip()) {</b>
<b class="nc">&nbsp;            tenant.setZip(proto.getZip());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPhone()) {</b>
<b class="nc">&nbsp;            tenant.setPhone(proto.getPhone());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasEmail()) {</b>
<b class="nc">&nbsp;            tenant.setEmail(proto.getEmail());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasAdditionalInfo()) {</b>
<b class="nc">&nbsp;            tenant.setAdditionalInfo(JacksonUtil.toJsonNode(proto.getAdditionalInfo()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasVersion()) {</b>
<b class="nc">&nbsp;            tenant.setVersion(proto.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return tenant;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.TenantProfileProto toProto(TenantProfile tenantProfile) {
<b class="nc">&nbsp;        var builder = TransportProtos.TenantProfileProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantProfileIdMSB(getMsb(tenantProfile.getId()))</b>
<b class="nc">&nbsp;                .setTenantProfileIdLSB(getLsb(tenantProfile.getId()))</b>
<b class="nc">&nbsp;                .setCreatedTime(tenantProfile.getCreatedTime())</b>
<b class="nc">&nbsp;                .setName(tenantProfile.getName())</b>
<b class="nc">&nbsp;                .setIsDefault(tenantProfile.isDefault())</b>
<b class="nc">&nbsp;                .setIsolatedTbRuleEngine(tenantProfile.isIsolatedTbRuleEngine());</b>
&nbsp;
<b class="nc">&nbsp;        if (isNotNull(tenantProfile.getDescription())) {</b>
<b class="nc">&nbsp;            builder.setDescription(tenantProfile.getDescription());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(tenantProfile.getProfileDataBytes())) {</b>
<b class="nc">&nbsp;            builder.setProfileData(ByteString.copyFrom(tenantProfile.getProfileDataBytes()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TenantProfile fromProto(TransportProtos.TenantProfileProto proto) {
<b class="nc">&nbsp;        TenantProfile tenantProfile = new TenantProfile(getEntityId(proto.getTenantProfileIdMSB(), proto.getTenantProfileIdLSB(), TenantProfileId::new));</b>
<b class="nc">&nbsp;        tenantProfile.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        tenantProfile.setName(proto.getName());</b>
<b class="nc">&nbsp;        tenantProfile.setDefault(proto.getIsDefault());</b>
<b class="nc">&nbsp;        tenantProfile.setIsolatedTbRuleEngine(proto.getIsolatedTbRuleEngine());</b>
<b class="nc">&nbsp;        if (proto.hasDescription()) {</b>
<b class="nc">&nbsp;            tenantProfile.setDescription(proto.getDescription());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasProfileData()) {</b>
<b class="nc">&nbsp;            tenantProfile.setProfileDataBytes(proto.getProfileData().toByteArray());</b>
&nbsp;        }
<b class="nc">&nbsp;        return tenantProfile;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.TbResourceProto toProto(TbResource resource) {
<b class="nc">&nbsp;        var builder = TransportProtos.TbResourceProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(getMsb(resource.getTenantId()))</b>
<b class="nc">&nbsp;                .setTenantIdLSB(getLsb(resource.getTenantId()))</b>
<b class="nc">&nbsp;                .setResourceIdMSB(getMsb(resource.getId()))</b>
<b class="nc">&nbsp;                .setResourceIdLSB(getLsb(resource.getId()))</b>
<b class="nc">&nbsp;                .setCreatedTime(resource.getCreatedTime())</b>
<b class="nc">&nbsp;                .setTitle(resource.getTitle())</b>
<b class="nc">&nbsp;                .setResourceType(resource.getResourceType().name())</b>
<b class="nc">&nbsp;                .setResourceKey(resource.getResourceKey())</b>
<b class="nc">&nbsp;                .setIsPublic(resource.isPublic())</b>
<b class="nc">&nbsp;                .setSearchText(resource.getSearchText())</b>
<b class="nc">&nbsp;                .setFileName(resource.getFileName());</b>
<b class="nc">&nbsp;        if (isNotNull(resource.getPublicResourceKey())) {</b>
<b class="nc">&nbsp;            builder.setPublicResourceKey(resource.getPublicResourceKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getEtag())) {</b>
<b class="nc">&nbsp;            builder.setEtag(resource.getEtag());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getDescriptor())) {</b>
<b class="nc">&nbsp;            builder.setResourceDescriptor(JacksonUtil.toString(resource.getDescriptor()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getExternalId())) {</b>
<b class="nc">&nbsp;            builder.setExternalIdMSB(getMsb(resource.getExternalId()))</b>
<b class="nc">&nbsp;                    .setExternalIdLSB(getLsb(resource.getExternalId()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getData())) {</b>
<b class="nc">&nbsp;            builder.setData(ByteString.copyFrom(resource.getData()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getPreview())) {</b>
<b class="nc">&nbsp;            builder.setPreview(ByteString.copyFrom(resource.getPreview()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(resource.getResourceSubType())) {</b>
<b class="nc">&nbsp;            builder.setResourceSubType(resource.getResourceSubType().name());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TbResource fromProto(TransportProtos.TbResourceProto proto) {
<b class="nc">&nbsp;        TbResource resource = new TbResource(getEntityId(proto.getResourceIdMSB(), proto.getResourceIdLSB(), TbResourceId::new));</b>
<b class="nc">&nbsp;        resource.setTenantId(getEntityId(proto.getTenantIdMSB(), proto.getTenantIdLSB(), TenantId::fromUUID));</b>
<b class="nc">&nbsp;        resource.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        resource.setTitle(proto.getTitle());</b>
<b class="nc">&nbsp;        resource.setResourceType(ResourceType.valueOf(proto.getResourceType()));</b>
<b class="nc">&nbsp;        resource.setResourceKey(proto.getResourceKey());</b>
<b class="nc">&nbsp;        resource.setPublic(proto.getIsPublic());</b>
<b class="nc">&nbsp;        resource.setSearchText(proto.getSearchText());</b>
<b class="nc">&nbsp;        resource.setFileName(proto.getFileName());</b>
<b class="nc">&nbsp;        if (proto.hasPublicResourceKey()) {</b>
<b class="nc">&nbsp;            resource.setPublicResourceKey(proto.getPublicResourceKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasEtag()) {</b>
<b class="nc">&nbsp;            resource.setEtag(proto.getEtag());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasResourceDescriptor()) {</b>
<b class="nc">&nbsp;            resource.setDescriptor(JacksonUtil.toJsonNode(proto.getResourceDescriptor()));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasExternalIdMSB() &amp;&amp; proto.hasExternalIdLSB()) {</b>
<b class="nc">&nbsp;            resource.setExternalId(getEntityId(proto.getExternalIdMSB(), proto.getExternalIdLSB(), TbResourceId::new));</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasData()) {</b>
<b class="nc">&nbsp;            resource.setData(proto.getData().toByteArray());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPreview()) {</b>
<b class="nc">&nbsp;            resource.setPreview(proto.getPreview().toByteArray());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasResourceSubType()) {</b>
<b class="nc">&nbsp;            resource.setResourceSubType(ResourceSubType.valueOf(proto.getResourceSubType()));</b>
&nbsp;        }
<b class="nc">&nbsp;        return resource;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.ApiUsageStateProto toProto(ApiUsageState apiUsageState) {
<b class="nc">&nbsp;        return TransportProtos.ApiUsageStateProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantProfileIdMSB(getMsb(apiUsageState.getTenantId()))</b>
<b class="nc">&nbsp;                .setTenantProfileIdLSB(getLsb(apiUsageState.getTenantId()))</b>
<b class="nc">&nbsp;                .setApiUsageStateIdMSB(getMsb(apiUsageState.getId()))</b>
<b class="nc">&nbsp;                .setApiUsageStateIdLSB(getLsb(apiUsageState.getId()))</b>
<b class="nc">&nbsp;                .setCreatedTime(apiUsageState.getCreatedTime())</b>
<b class="nc">&nbsp;                .setEntityType(toProto(apiUsageState.getEntityId().getEntityType()))</b>
<b class="nc">&nbsp;                .setEntityIdMSB(getMsb(apiUsageState.getEntityId()))</b>
<b class="nc">&nbsp;                .setEntityIdLSB(getLsb(apiUsageState.getEntityId()))</b>
<b class="nc">&nbsp;                .setTransportState(apiUsageState.getTransportState().name())</b>
<b class="nc">&nbsp;                .setDbStorageState(apiUsageState.getDbStorageState().name())</b>
<b class="nc">&nbsp;                .setReExecState(apiUsageState.getReExecState().name())</b>
<b class="nc">&nbsp;                .setJsExecState(apiUsageState.getJsExecState().name())</b>
<b class="nc">&nbsp;                .setTbelExecState(apiUsageState.getTbelExecState().name())</b>
<b class="nc">&nbsp;                .setEmailExecState(apiUsageState.getEmailExecState().name())</b>
<b class="nc">&nbsp;                .setSmsExecState(apiUsageState.getSmsExecState().name())</b>
<b class="nc">&nbsp;                .setAlarmExecState(apiUsageState.getAlarmExecState().name())</b>
<b class="nc">&nbsp;                .setVersion(apiUsageState.getVersion())</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static ApiUsageState fromProto(TransportProtos.ApiUsageStateProto proto) {
<b class="nc">&nbsp;        ApiUsageState apiUsageState = new ApiUsageState(getEntityId(proto.getApiUsageStateIdMSB(), proto.getApiUsageStateIdLSB(), ApiUsageStateId::new));</b>
<b class="nc">&nbsp;        apiUsageState.setTenantId(getEntityId(proto.getTenantProfileIdMSB(), proto.getTenantProfileIdLSB(), TenantId::fromUUID));</b>
<b class="nc">&nbsp;        apiUsageState.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        apiUsageState.setEntityId(EntityIdFactory.getByTypeAndUuid(fromProto(proto.getEntityType()), new UUID(proto.getEntityIdMSB(), proto.getEntityIdLSB())));</b>
<b class="nc">&nbsp;        apiUsageState.setTransportState(ApiUsageStateValue.valueOf(proto.getTransportState()));</b>
<b class="nc">&nbsp;        apiUsageState.setDbStorageState(ApiUsageStateValue.valueOf(proto.getDbStorageState()));</b>
<b class="nc">&nbsp;        apiUsageState.setReExecState(ApiUsageStateValue.valueOf(proto.getReExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setJsExecState(ApiUsageStateValue.valueOf(proto.getJsExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setTbelExecState(ApiUsageStateValue.valueOf(proto.getTbelExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setEmailExecState(ApiUsageStateValue.valueOf(proto.getEmailExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setSmsExecState(ApiUsageStateValue.valueOf(proto.getSmsExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setAlarmExecState(ApiUsageStateValue.valueOf(proto.getAlarmExecState()));</b>
<b class="nc">&nbsp;        apiUsageState.setVersion(proto.getVersion());</b>
<b class="nc">&nbsp;        return apiUsageState;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.RepositorySettingsProto toProto(RepositorySettings repositorySettings) {
<b class="nc">&nbsp;        var builder = TransportProtos.RepositorySettingsProto.newBuilder()</b>
<b class="nc">&nbsp;                .setRepositoryUri(repositorySettings.getRepositoryUri())</b>
<b class="nc">&nbsp;                .setAuthMethod(repositorySettings.getAuthMethod().name())</b>
<b class="nc">&nbsp;                .setReadOnly(repositorySettings.isReadOnly())</b>
<b class="nc">&nbsp;                .setShowMergeCommits(repositorySettings.isShowMergeCommits())</b>
<b class="nc">&nbsp;                .setLocalOnly(repositorySettings.isLocalOnly());</b>
&nbsp;
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getUsername())) {</b>
<b class="nc">&nbsp;            builder.setUsername(repositorySettings.getUsername());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getPassword())) {</b>
<b class="nc">&nbsp;            builder.setPassword(repositorySettings.getPassword());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getPrivateKeyFileName())) {</b>
<b class="nc">&nbsp;            builder.setPrivateKeyFileName(repositorySettings.getPrivateKeyFileName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getPrivateKey())) {</b>
<b class="nc">&nbsp;            builder.setPrivateKey(repositorySettings.getPrivateKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getPrivateKeyPassword())) {</b>
<b class="nc">&nbsp;            builder.setPrivateKeyPassword(repositorySettings.getPrivateKeyPassword());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (isNotNull(repositorySettings.getDefaultBranch())) {</b>
<b class="nc">&nbsp;            builder.setDefaultBranch(repositorySettings.getDefaultBranch());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static RepositorySettings fromProto(TransportProtos.RepositorySettingsProto proto) {
<b class="nc">&nbsp;        RepositorySettings repositorySettings = new RepositorySettings();</b>
<b class="nc">&nbsp;        repositorySettings.setRepositoryUri(proto.getRepositoryUri());</b>
<b class="nc">&nbsp;        repositorySettings.setAuthMethod(RepositoryAuthMethod.valueOf(proto.getAuthMethod()));</b>
<b class="nc">&nbsp;        repositorySettings.setReadOnly(proto.getReadOnly());</b>
<b class="nc">&nbsp;        repositorySettings.setShowMergeCommits(proto.getShowMergeCommits());</b>
<b class="nc">&nbsp;        repositorySettings.setLocalOnly(proto.getLocalOnly());</b>
<b class="nc">&nbsp;        if (proto.hasUsername()) {</b>
<b class="nc">&nbsp;            repositorySettings.setUsername(proto.getUsername());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPassword()) {</b>
<b class="nc">&nbsp;            repositorySettings.setPassword(proto.getPassword());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPrivateKeyFileName()) {</b>
<b class="nc">&nbsp;            repositorySettings.setPrivateKeyFileName(proto.getPrivateKeyFileName());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPrivateKey()) {</b>
<b class="nc">&nbsp;            repositorySettings.setPrivateKey(proto.getPrivateKey());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasPrivateKeyPassword()) {</b>
<b class="nc">&nbsp;            repositorySettings.setPrivateKeyPassword(proto.getPrivateKeyPassword());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (proto.hasDefaultBranch()) {</b>
<b class="nc">&nbsp;            repositorySettings.setDefaultBranch(proto.getDefaultBranch());</b>
&nbsp;        }
<b class="nc">&nbsp;        return repositorySettings;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.DeviceCredentialsProto toProto(DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        TransportProtos.DeviceCredentialsProto.Builder builder = TransportProtos.DeviceCredentialsProto.newBuilder()</b>
<b class="nc">&nbsp;                .setCredentialsIdMSB(deviceCredentials.getId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setCredentialsIdLSB(deviceCredentials.getId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setCreatedTime(deviceCredentials.getCreatedTime())</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(getMsb(deviceCredentials.getDeviceId()))</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(getLsb(deviceCredentials.getDeviceId()))</b>
<b class="nc">&nbsp;                .setCredentialsId(deviceCredentials.getCredentialsId())</b>
<b class="nc">&nbsp;                .setCredentialsType(TransportProtos.CredentialsType.valueOf(deviceCredentials.getCredentialsType().name()));</b>
&nbsp;
<b class="nc">&nbsp;        if (deviceCredentials.getCredentialsValue() != null) {</b>
<b class="nc">&nbsp;            builder.setCredentialsValue(deviceCredentials.getCredentialsValue());</b>
&nbsp;        }
<b class="nc">&nbsp;        if (deviceCredentials.getVersion() != null) {</b>
<b class="nc">&nbsp;            builder.setVersion(deviceCredentials.getVersion());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static DeviceCredentials fromProto(TransportProtos.DeviceCredentialsProto proto) {
<b class="nc">&nbsp;        DeviceCredentials deviceCredentials =</b>
<b class="nc">&nbsp;                new DeviceCredentials(new DeviceCredentialsId(new UUID(proto.getCredentialsIdMSB(), proto.getCredentialsIdLSB())));</b>
<b class="nc">&nbsp;        deviceCredentials.setCreatedTime(proto.getCreatedTime());</b>
<b class="nc">&nbsp;        deviceCredentials.setDeviceId(getEntityId(proto.getDeviceIdMSB(), proto.getDeviceIdLSB(), DeviceId::new));</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsId(proto.getCredentialsId());</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsType(DeviceCredentialsType.valueOf(proto.getCredentialsType().name()));</b>
<b class="nc">&nbsp;        deviceCredentials.setCredentialsValue(proto.hasCredentialsValue() ? proto.getCredentialsValue() : null);</b>
<b class="nc">&nbsp;        deviceCredentials.setVersion(proto.hasVersion() ? proto.getVersion() : null);</b>
<b class="nc">&nbsp;        return deviceCredentials;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static &lt;T&gt; TransportProtos.EntityUpdateMsg toEntityUpdateProto(T entity) {
<b class="nc">&nbsp;        var builder = TransportProtos.EntityUpdateMsg.newBuilder();</b>
<b class="nc">&nbsp;        if (entity instanceof Device) {</b>
<b class="nc">&nbsp;            builder.setDevice(toProto((Device) entity));</b>
<b class="nc">&nbsp;        } else if (entity instanceof DeviceProfile) {</b>
<b class="nc">&nbsp;            builder.setDeviceProfile(toProto((DeviceProfile) entity));</b>
<b class="nc">&nbsp;        } else if (entity instanceof Tenant) {</b>
<b class="nc">&nbsp;            builder.setTenant(toProto((Tenant) entity));</b>
<b class="nc">&nbsp;        } else if (entity instanceof TenantProfile) {</b>
<b class="nc">&nbsp;            builder.setTenantProfile(toProto((TenantProfile) entity));</b>
<b class="nc">&nbsp;        } else if (entity instanceof ApiUsageState) {</b>
<b class="nc">&nbsp;            builder.setApiUsageState(toProto((ApiUsageState) entity));</b>
&nbsp;        } else {
<b class="nc">&nbsp;            log.warn(&quot;[{}] entity does not support toProto serialization .&quot;, entity.getClass().getSimpleName());</b>
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.DeviceInfoProto toDeviceInfoProto(Device device) throws JsonProcessingException {
<b class="nc">&nbsp;        TransportProtos.DeviceInfoProto.Builder builder = TransportProtos.DeviceInfoProto.newBuilder()</b>
<b class="nc">&nbsp;                .setTenantIdMSB(device.getTenantId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setTenantIdLSB(device.getTenantId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setCustomerIdMSB(getMsb(device.getCustomerId()))</b>
<b class="nc">&nbsp;                .setCustomerIdLSB(getLsb(device.getCustomerId()))</b>
<b class="nc">&nbsp;                .setDeviceIdMSB(device.getId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceIdLSB(device.getId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceName(device.getName())</b>
<b class="nc">&nbsp;                .setDeviceType(device.getType())</b>
<b class="nc">&nbsp;                .setDeviceProfileIdMSB(device.getDeviceProfileId().getId().getMostSignificantBits())</b>
<b class="nc">&nbsp;                .setDeviceProfileIdLSB(device.getDeviceProfileId().getId().getLeastSignificantBits())</b>
<b class="nc">&nbsp;                .setAdditionalInfo(JacksonUtil.toString(device.getAdditionalInfo()));</b>
&nbsp;
<b class="nc">&nbsp;        if (device.getAdditionalInfo().has(GATEWAY_PARAMETER)) {</b>
<b class="nc">&nbsp;            builder.setIsGateway(device.getAdditionalInfo().get(GATEWAY_PARAMETER).booleanValue());</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        PowerSavingConfiguration psmConfiguration = switch (device.getDeviceData().getTransportConfiguration().getType()) {</b>
<b class="nc">&nbsp;            case LWM2M -&gt; (Lwm2mDeviceTransportConfiguration) device.getDeviceData().getTransportConfiguration();</b>
<b class="nc">&nbsp;            case COAP -&gt; (CoapDeviceTransportConfiguration) device.getDeviceData().getTransportConfiguration();</b>
<b class="nc">&nbsp;            default -&gt; null;</b>
&nbsp;        };
&nbsp;
<b class="nc">&nbsp;        if (psmConfiguration != null) {</b>
<b class="nc">&nbsp;            PowerMode powerMode = psmConfiguration.getPowerMode();</b>
<b class="nc">&nbsp;            if (powerMode != null) {</b>
<b class="nc">&nbsp;                builder.setPowerMode(powerMode.name());</b>
<b class="nc">&nbsp;                if (powerMode.equals(PowerMode.PSM)) {</b>
<b class="nc">&nbsp;                    builder.setPsmActivityTimer(checkLong(psmConfiguration.getPsmActivityTimer()));</b>
<b class="nc">&nbsp;                } else if (powerMode.equals(PowerMode.E_DRX)) {</b>
<b class="nc">&nbsp;                    builder.setEdrxCycle(checkLong(psmConfiguration.getEdrxCycle()));</b>
<b class="nc">&nbsp;                    builder.setPagingTransmissionWindow(checkLong(psmConfiguration.getPagingTransmissionWindow()));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return builder.build();</b>
&nbsp;    }
&nbsp;
&nbsp;    @Deprecated(forRemoval = true, since = &quot;4.1&quot;)
&nbsp;    public static MsgProtos.TbMsgProto getTbMsgProto(TransportProtos.ToRuleEngineMsg ruleEngineMsg) throws InvalidProtocolBufferException {
<b class="nc">&nbsp;        if (ruleEngineMsg.getTbMsg().isEmpty()) {</b>
<b class="nc">&nbsp;            return ruleEngineMsg.getTbMsgProto();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            return MsgProtos.TbMsgProto.parseFrom(ruleEngineMsg.getTbMsg());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    @SneakyThrows</b>
&nbsp;    @Deprecated(forRemoval = true, since = &quot;4.1&quot;) // inline to TbMsg.fromProto(queueName, ruleEngineMsg.getTbMsgProto(), callback)
&nbsp;    public static TbMsg fromTbMsgProto(String queueName, TransportProtos.ToRuleEngineMsg ruleEngineMsg, TbMsgCallback callback) {
<b class="nc">&nbsp;        return TbMsg.fromProto(queueName, getTbMsgProto(ruleEngineMsg), callback);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static TransportProtos.EntityIdProto toProto(EntityId entityId) {
<b class="nc">&nbsp;        return TransportProtos.EntityIdProto.newBuilder()</b>
<b class="nc">&nbsp;                .setEntityIdMSB(getMsb(entityId))</b>
<b class="nc">&nbsp;                .setEntityIdLSB(getLsb(entityId))</b>
<b class="nc">&nbsp;                .setType(toProto(entityId.getEntityType()))</b>
<b class="nc">&nbsp;                .build();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static EntityId fromProto(TransportProtos.EntityIdProto entityIdProto) {
<b class="nc">&nbsp;        return EntityIdFactory.getByTypeAndUuid(fromProto(entityIdProto.getType()), new UUID(entityIdProto.getEntityIdMSB(), entityIdProto.getEntityIdLSB()));</b>
&nbsp;    }
&nbsp;
&nbsp;    private static boolean isNotNull(Object obj) {
<b class="nc">&nbsp;        return obj != null;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static &lt;T extends EntityId&gt; T getEntityId(long msb, long lsb, Function&lt;UUID, T&gt; entityId) {
<b class="nc">&nbsp;        return entityId.apply(new UUID(msb, lsb));</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Long getMsb(EntityId entityId) {
<b class="nc">&nbsp;        if (isNotNull(entityId)) {</b>
<b class="nc">&nbsp;            return entityId.getId().getMostSignificantBits();</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0L;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Long getLsb(EntityId entityId) {
<b class="nc">&nbsp;        if (isNotNull(entityId)) {</b>
<b class="nc">&nbsp;            return entityId.getId().getLeastSignificantBits();</b>
&nbsp;        }
<b class="nc">&nbsp;        return 0L;</b>
&nbsp;    }
&nbsp;
&nbsp;    private static Long checkLong(Long l) {
<b class="nc">&nbsp;        return isNotNull(l) ? l : 0;</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
