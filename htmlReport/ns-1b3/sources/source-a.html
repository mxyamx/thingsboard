<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > TbCoreConsumerStats</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.service.queue</a>
</div>

<h1>Coverage Summary for Class: TbCoreConsumerStats (org.thingsboard.server.service.queue)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">TbCoreConsumerStats</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/15)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/32)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/84)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.service.queue;
&nbsp;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.thingsboard.server.common.stats.StatsCounter;
&nbsp;import org.thingsboard.server.common.stats.StatsFactory;
&nbsp;import org.thingsboard.server.common.stats.StatsType;
&nbsp;import org.thingsboard.server.gen.transport.TransportProtos;
&nbsp;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.List;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;public class TbCoreConsumerStats {
&nbsp;    public static final String TOTAL_MSGS = &quot;totalMsgs&quot;;
&nbsp;    public static final String SESSION_EVENTS = &quot;sessionEvents&quot;;
&nbsp;    public static final String GET_ATTRIBUTE = &quot;getAttr&quot;;
&nbsp;    public static final String ATTRIBUTE_SUBSCRIBES = &quot;subToAttr&quot;;
&nbsp;    public static final String RPC_SUBSCRIBES = &quot;subToRpc&quot;;
&nbsp;    public static final String TO_DEVICE_RPC_CALL_RESPONSES = &quot;toDevRpc&quot;;
&nbsp;    public static final String SUBSCRIPTION_INFO = &quot;subInfo&quot;;
&nbsp;    public static final String DEVICE_CLAIMS = &quot;claimDevice&quot;;
&nbsp;    public static final String DEVICE_STATES = &quot;deviceState&quot;;
&nbsp;    public static final String SUBSCRIPTION_MSGS = &quot;subMsgs&quot;;
&nbsp;    public static final String DEVICE_CONNECTS = &quot;deviceConnect&quot;;
&nbsp;    public static final String DEVICE_ACTIVITIES = &quot;deviceActivity&quot;;
&nbsp;    public static final String DEVICE_DISCONNECTS = &quot;deviceDisconnect&quot;;
&nbsp;    public static final String DEVICE_INACTIVITIES = &quot;deviceInactivity&quot;;
&nbsp;    public static final String DEVICE_INACTIVITY_TIMEOUT_UPDATES = &quot;deviceInactivityTimeoutUpdate&quot;;
&nbsp;
&nbsp;    public static final String TO_CORE_NF_OTHER = &quot;coreNfOther&quot;; // normally, there is no messages when codebase is fine
&nbsp;    public static final String TO_CORE_NF_COMPONENT_LIFECYCLE = &quot;coreNfCompLfcl&quot;;
&nbsp;    public static final String TO_CORE_NF_DEVICE_RPC_RESPONSE = &quot;coreNfDevRpcRsp&quot;;
&nbsp;    public static final String TO_CORE_NF_NOTIFICATION_RULE_PROCESSOR = &quot;coreNfNfRlProc&quot;;
&nbsp;    public static final String TO_CORE_NF_QUEUE_UPDATE = &quot;coreNfQueueUpd&quot;;
&nbsp;    public static final String TO_CORE_NF_QUEUE_DELETE = &quot;coreNfQueueDel&quot;;
&nbsp;    public static final String TO_CORE_NF_SUBSCRIPTION_SERVICE = &quot;coreNfSubSvc&quot;;
&nbsp;    public static final String TO_CORE_NF_SUBSCRIPTION_MANAGER = &quot;coreNfSubMgr&quot;;
&nbsp;    public static final String TO_CORE_NF_VC_RESPONSE = &quot;coreNfVCRsp&quot;;
&nbsp;
&nbsp;    private final StatsCounter totalCounter;
&nbsp;    private final StatsCounter sessionEventCounter;
&nbsp;    private final StatsCounter getAttributesCounter;
&nbsp;    private final StatsCounter subscribeToAttributesCounter;
&nbsp;    private final StatsCounter subscribeToRPCCounter;
&nbsp;    private final StatsCounter toDeviceRPCCallResponseCounter;
&nbsp;    private final StatsCounter subscriptionInfoCounter;
&nbsp;    private final StatsCounter claimDeviceCounter;
&nbsp;    private final StatsCounter deviceStateCounter;
&nbsp;    private final StatsCounter subscriptionMsgCounter;
&nbsp;    private final StatsCounter deviceConnectsCounter;
&nbsp;    private final StatsCounter deviceActivitiesCounter;
&nbsp;    private final StatsCounter deviceDisconnectsCounter;
&nbsp;    private final StatsCounter deviceInactivitiesCounter;
&nbsp;    private final StatsCounter deviceInactivityTimeoutUpdatesCounter;
&nbsp;
&nbsp;    private final StatsCounter toCoreNfOtherCounter;
&nbsp;    private final StatsCounter toCoreNfComponentLifecycleCounter;
&nbsp;    private final StatsCounter toCoreNfDeviceRpcResponseCounter;
&nbsp;    private final StatsCounter toCoreNfNotificationRuleProcessorCounter;
&nbsp;    private final StatsCounter toCoreNfQueueUpdateCounter;
&nbsp;    private final StatsCounter toCoreNfQueueDeleteCounter;
&nbsp;    private final StatsCounter toCoreNfSubscriptionServiceCounter;
&nbsp;    private final StatsCounter toCoreNfSubscriptionManagerCounter;
&nbsp;    private final StatsCounter toCoreNfVersionControlResponseCounter;
&nbsp;
<b class="nc">&nbsp;    private final List&lt;StatsCounter&gt; counters = new ArrayList&lt;&gt;(23);</b>
&nbsp;
<b class="nc">&nbsp;    public TbCoreConsumerStats(StatsFactory statsFactory) {</b>
<b class="nc">&nbsp;        String statsKey = StatsType.CORE.getName();</b>
&nbsp;
<b class="nc">&nbsp;        this.totalCounter = register(statsFactory.createStatsCounter(statsKey, TOTAL_MSGS));</b>
<b class="nc">&nbsp;        this.sessionEventCounter = register(statsFactory.createStatsCounter(statsKey, SESSION_EVENTS));</b>
<b class="nc">&nbsp;        this.getAttributesCounter = register(statsFactory.createStatsCounter(statsKey, GET_ATTRIBUTE));</b>
<b class="nc">&nbsp;        this.subscribeToAttributesCounter = register(statsFactory.createStatsCounter(statsKey, ATTRIBUTE_SUBSCRIBES));</b>
<b class="nc">&nbsp;        this.subscribeToRPCCounter = register(statsFactory.createStatsCounter(statsKey, RPC_SUBSCRIBES));</b>
<b class="nc">&nbsp;        this.toDeviceRPCCallResponseCounter = register(statsFactory.createStatsCounter(statsKey, TO_DEVICE_RPC_CALL_RESPONSES));</b>
<b class="nc">&nbsp;        this.subscriptionInfoCounter = register(statsFactory.createStatsCounter(statsKey, SUBSCRIPTION_INFO));</b>
<b class="nc">&nbsp;        this.claimDeviceCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_CLAIMS));</b>
<b class="nc">&nbsp;        this.deviceStateCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_STATES));</b>
<b class="nc">&nbsp;        this.subscriptionMsgCounter = register(statsFactory.createStatsCounter(statsKey, SUBSCRIPTION_MSGS));</b>
<b class="nc">&nbsp;        this.deviceConnectsCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_CONNECTS));</b>
<b class="nc">&nbsp;        this.deviceActivitiesCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_ACTIVITIES));</b>
<b class="nc">&nbsp;        this.deviceDisconnectsCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_DISCONNECTS));</b>
<b class="nc">&nbsp;        this.deviceInactivitiesCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_INACTIVITIES));</b>
<b class="nc">&nbsp;        this.deviceInactivityTimeoutUpdatesCounter = register(statsFactory.createStatsCounter(statsKey, DEVICE_INACTIVITY_TIMEOUT_UPDATES));</b>
&nbsp;
&nbsp;        // Core notification counters
<b class="nc">&nbsp;        this.toCoreNfOtherCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_OTHER));</b>
<b class="nc">&nbsp;        this.toCoreNfComponentLifecycleCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_COMPONENT_LIFECYCLE));</b>
<b class="nc">&nbsp;        this.toCoreNfDeviceRpcResponseCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_DEVICE_RPC_RESPONSE));</b>
<b class="nc">&nbsp;        this.toCoreNfNotificationRuleProcessorCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_NOTIFICATION_RULE_PROCESSOR));</b>
<b class="nc">&nbsp;        this.toCoreNfQueueUpdateCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_QUEUE_UPDATE));</b>
<b class="nc">&nbsp;        this.toCoreNfQueueDeleteCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_QUEUE_DELETE));</b>
<b class="nc">&nbsp;        this.toCoreNfSubscriptionServiceCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_SUBSCRIPTION_SERVICE));</b>
<b class="nc">&nbsp;        this.toCoreNfSubscriptionManagerCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_SUBSCRIPTION_MANAGER));</b>
<b class="nc">&nbsp;        this.toCoreNfVersionControlResponseCounter = register(statsFactory.createStatsCounter(statsKey, TO_CORE_NF_VC_RESPONSE));</b>
&nbsp;    }
&nbsp;
&nbsp;    private StatsCounter register(StatsCounter counter) {
<b class="nc">&nbsp;        counters.add(counter);</b>
<b class="nc">&nbsp;        return counter;</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.TransportToDeviceActorMsg msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        if (msg.hasSessionEvent()) {</b>
<b class="nc">&nbsp;            sessionEventCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasGetAttributes()) {</b>
<b class="nc">&nbsp;            getAttributesCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasSubscribeToAttributes()) {</b>
<b class="nc">&nbsp;            subscribeToAttributesCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasSubscribeToRPC()) {</b>
<b class="nc">&nbsp;            subscribeToRPCCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasToDeviceRPCCallResponse()) {</b>
<b class="nc">&nbsp;            toDeviceRPCCallResponseCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasSubscriptionInfo()) {</b>
<b class="nc">&nbsp;            subscriptionInfoCounter.increment();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (msg.hasClaimDevice()) {</b>
<b class="nc">&nbsp;            claimDeviceCounter.increment();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceStateServiceMsgProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceStateCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceConnectProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceConnectsCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceActivityProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceActivitiesCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceDisconnectProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceDisconnectsCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceInactivityProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceInactivitiesCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.DeviceInactivityTimeoutUpdateProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        deviceInactivityTimeoutUpdatesCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.SubscriptionMgrMsgProto msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        subscriptionMsgCounter.increment();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void log(TransportProtos.ToCoreNotificationMsg msg) {
<b class="nc">&nbsp;        totalCounter.increment();</b>
<b class="nc">&nbsp;        if (msg.hasToLocalSubscriptionServiceMsg()) {</b>
<b class="nc">&nbsp;            toCoreNfSubscriptionServiceCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.hasFromDeviceRpcResponse()) {</b>
<b class="nc">&nbsp;            toCoreNfDeviceRpcResponseCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.hasComponentLifecycle()) {</b>
<b class="nc">&nbsp;            toCoreNfComponentLifecycleCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.getQueueUpdateMsgsCount() &gt; 0) {</b>
<b class="nc">&nbsp;            toCoreNfQueueUpdateCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.getQueueDeleteMsgsCount() &gt; 0) {</b>
<b class="nc">&nbsp;            toCoreNfQueueDeleteCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.hasVcResponseMsg()) {</b>
<b class="nc">&nbsp;            toCoreNfVersionControlResponseCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.hasToSubscriptionMgrMsg()) {</b>
<b class="nc">&nbsp;            toCoreNfSubscriptionManagerCounter.increment();</b>
<b class="nc">&nbsp;        } else if (msg.hasNotificationRuleProcessorMsg()) {</b>
<b class="nc">&nbsp;            toCoreNfNotificationRuleProcessorCounter.increment();</b>
&nbsp;        } else {
<b class="nc">&nbsp;            toCoreNfOtherCounter.increment();</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void printStats() {
<b class="nc">&nbsp;        int total = totalCounter.get();</b>
<b class="nc">&nbsp;        if (total &gt; 0) {</b>
<b class="nc">&nbsp;            StringBuilder stats = new StringBuilder();</b>
<b class="nc">&nbsp;            counters.forEach(counter -&gt;</b>
<b class="nc">&nbsp;                    stats.append(counter.getName()).append(&quot; = [&quot;).append(counter.get()).append(&quot;] &quot;));</b>
<b class="nc">&nbsp;            log.info(&quot;Core Stats: {}&quot;, stats);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void reset() {
<b class="nc">&nbsp;        counters.forEach(StatsCounter::clear);</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
