<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > LwM2mValueConverterImpl</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.transport.lwm2m.utils</a>
</div>

<h1>Coverage Summary for Class: LwM2mValueConverterImpl (org.thingsboard.server.transport.lwm2m.utils)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">LwM2mValueConverterImpl</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/60)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/73)
  </span>
</td>
</tr>
  <tr>
    <td class="name">LwM2mValueConverterImpl$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/60)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/74)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.transport.lwm2m.utils;
&nbsp;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.eclipse.leshan.core.model.ResourceModel.Type;
&nbsp;import org.eclipse.leshan.core.node.LwM2mPath;
&nbsp;import org.eclipse.leshan.core.node.ObjectLink;
&nbsp;import org.eclipse.leshan.core.node.codec.CodecException;
&nbsp;import org.eclipse.leshan.core.node.codec.LwM2mValueConverter;
&nbsp;import org.eclipse.leshan.core.util.Hex;
&nbsp;import org.thingsboard.server.common.data.StringUtils;
&nbsp;
&nbsp;import java.math.BigInteger;
&nbsp;import java.nio.ByteBuffer;
&nbsp;import java.text.DateFormat;
&nbsp;import java.text.SimpleDateFormat;
&nbsp;import java.util.Base64;
&nbsp;import java.util.Date;
&nbsp;
&nbsp;import static org.eclipse.leshan.core.model.ResourceModel.Type.NONE;
&nbsp;import static org.eclipse.leshan.core.model.ResourceModel.Type.OPAQUE;
&nbsp;import static org.eclipse.leshan.core.model.ResourceModel.Type.TIME;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
<b class="nc">&nbsp;public class LwM2mValueConverterImpl implements LwM2mValueConverter {</b>
&nbsp;
<b class="nc">&nbsp;    private static final LwM2mValueConverterImpl INSTANCE = new LwM2mValueConverterImpl();</b>
&nbsp;
&nbsp;    public static LwM2mValueConverterImpl getInstance() {
<b class="nc">&nbsp;        return INSTANCE;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Object convertValue(Object value, Type currentType, Type expectedType, LwM2mPath resourcePath)
&nbsp;            throws CodecException {
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;           return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (expectedType == null) {</b>
&nbsp;            /** unknown resource, trusted value */
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (currentType == null) {</b>
<b class="nc">&nbsp;            currentType = OPAQUE;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (currentType == expectedType || currentType == NONE || currentType == TIME) {</b>
&nbsp;            /** expected type */
<b class="nc">&nbsp;            return value;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        switch (expectedType) {</b>
&nbsp;            case INTEGER:
<b class="nc">&nbsp;                switch (currentType) {</b>
&nbsp;                    case FLOAT:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert float value [{}] to Integer&quot;, value);</b>
<b class="nc">&nbsp;                        Long longValue = ((Double) value).longValue();</b>
<b class="nc">&nbsp;                        if ((double) value == longValue.doubleValue()) {</b>
<b class="nc">&nbsp;                            return longValue;</b>
&nbsp;                        }
&nbsp;                    case STRING:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert String value [{}] to Integer&quot;, value);</b>
<b class="nc">&nbsp;                        return Long.parseLong((String) value);</b>
&nbsp;                    default:
&nbsp;                        break;
&nbsp;                }
&nbsp;                break;
&nbsp;            case FLOAT:
<b class="nc">&nbsp;                switch (currentType) {</b>
&nbsp;                    case INTEGER:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert integer value [{}] to float&quot;, value);</b>
<b class="nc">&nbsp;                        Double floatValue = ((Long) value).doubleValue();</b>
<b class="nc">&nbsp;                        if ((long) value == floatValue.longValue()) {</b>
<b class="nc">&nbsp;                            return floatValue;</b>
&nbsp;                        }
&nbsp;                    case STRING:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert String value [{}] to Float&quot;, value);</b>
<b class="nc">&nbsp;                        return Float.valueOf((String) value);</b>
&nbsp;                    default:
&nbsp;                        break;
&nbsp;                }
&nbsp;                break;
&nbsp;            case BOOLEAN:
<b class="nc">&nbsp;                switch (currentType) {</b>
&nbsp;                    case STRING:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert string value {} to boolean&quot;, value);</b>
<b class="nc">&nbsp;                        if (StringUtils.equalsIgnoreCase((String) value, &quot;true&quot;)) {</b>
<b class="nc">&nbsp;                            return true;</b>
<b class="nc">&nbsp;                        } else if (StringUtils.equalsIgnoreCase((String) value, &quot;false&quot;)) {</b>
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
&nbsp;                        break;
&nbsp;                    case INTEGER:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert int value {} to boolean&quot;, value);</b>
<b class="nc">&nbsp;                        Long val = (Long) value;</b>
<b class="nc">&nbsp;                        if (val == 1) {</b>
<b class="nc">&nbsp;                            return true;</b>
<b class="nc">&nbsp;                        } else if (val == 0) {</b>
<b class="nc">&nbsp;                            return false;</b>
&nbsp;                        }
&nbsp;                        break;
&nbsp;                    default:
&nbsp;                        break;
&nbsp;                }
&nbsp;                break;
&nbsp;            case TIME:
<b class="nc">&nbsp;                switch (currentType) {</b>
&nbsp;                    case INTEGER:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert long value {} to date&quot;, value);</b>
&nbsp;                        /* let&#39;s assume we received the millisecond since 1970/1/1 */
<b class="nc">&nbsp;                        return new Date(((Number) value).longValue() * 1000L);</b>
&nbsp;                    case STRING:
<b class="nc">&nbsp;                        log.debug(&quot;Trying to convert string value {} to date&quot;, value);</b>
&nbsp;                        /** let&#39;s assume we received an ISO 8601 format date */
&nbsp;                        try {
<b class="nc">&nbsp;                            return new Date(Long.decode(value.toString()));</b>
&nbsp;                            /**
&nbsp;                            DatatypeFactory datatypeFactory = DatatypeFactory.newInstance();
&nbsp;                            XMLGregorianCalendar cal = datatypeFactory.newXMLGregorianCalendar((String) value);
&nbsp;                            return cal.toGregorianCalendar().getTime();
&nbsp;                             **/
&nbsp;                        } catch (IllegalArgumentException e) {
<b class="nc">&nbsp;                            log.debug(&quot;Unable to convert string to date&quot;, e);</b>
<b class="nc">&nbsp;                            throw new CodecException(&quot;Unable to convert string (%s) to %s for resource %s&quot;, value, TIME.name(),</b>
&nbsp;                                    resourcePath);
&nbsp;                        }
&nbsp;                    default:
&nbsp;                        break;
&nbsp;                }
&nbsp;                break;
&nbsp;            case STRING:
<b class="nc">&nbsp;                switch (currentType) {</b>
&nbsp;                    case BOOLEAN:
&nbsp;                    case INTEGER:
&nbsp;                    case FLOAT:
<b class="nc">&nbsp;                        return String.valueOf(value);</b>
&nbsp;                    case TIME:
<b class="nc">&nbsp;                        String DATE_FORMAT = &quot;yyyy-MM-dd[[ ][&#39;T&#39;]HH:mm[:ss[.SSS]][ ][XXX][Z][z][VV][O]]&quot;;</b>
&nbsp;                        Long timeValue;
&nbsp;                        try {
<b class="nc">&nbsp;                            timeValue = ((Date) value).getTime();</b>
&nbsp;                        }
&nbsp;                        catch (Exception e){
<b class="nc">&nbsp;                           timeValue = new BigInteger((byte [])value).longValue();</b>
&nbsp;                        }
<b class="nc">&nbsp;                        DateFormat formatter = new SimpleDateFormat(DATE_FORMAT);</b>
<b class="nc">&nbsp;                        return formatter.format(new Date(timeValue));</b>
&nbsp;                    case OPAQUE:
<b class="nc">&nbsp;                        return Hex.encodeHexString((byte[])value);</b>
&nbsp;                    case OBJLNK:
<b class="nc">&nbsp;                        return ObjectLink.decodeFromString((String) value);</b>
&nbsp;                    default:
&nbsp;                        break;
&nbsp;                }
&nbsp;                break;
&nbsp;            case OPAQUE:
<b class="nc">&nbsp;                if (currentType == Type.INTEGER) {</b>
<b class="nc">&nbsp;                    if (value instanceof Integer) {</b>
<b class="nc">&nbsp;                        return ByteBuffer.allocate(4).putInt((Integer) value).array();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        return ByteBuffer.allocate(8).putLong((Long) value).array();</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (currentType == Type.FLOAT) {</b>
<b class="nc">&nbsp;                    if (value instanceof Float) {</b>
<b class="nc">&nbsp;                        return ByteBuffer.allocate(4).putFloat((Float) value).array();</b>
&nbsp;                    } else {
<b class="nc">&nbsp;                        return ByteBuffer.allocate(8).putDouble((Double) value).array();</b>
&nbsp;                    }
<b class="nc">&nbsp;                } else if (currentType == Type.STRING) {</b>
&nbsp;                    /** let&#39;s assume we received an hexadecimal string */
<b class="nc">&nbsp;                    log.debug(&quot;Trying to convert hexadecimal/base64 string [{}] to byte array&quot;, value);</b>
&nbsp;                    try {
<b class="nc">&nbsp;                        return Hex.decodeHex(((String)value).toCharArray());</b>
&nbsp;                    } catch (IllegalArgumentException e) {
&nbsp;                        try {
<b class="nc">&nbsp;                            return Base64.getDecoder().decode(((String) value).getBytes());</b>
&nbsp;                        } catch (IllegalArgumentException ea) {
<b class="nc">&nbsp;                            throw new CodecException(&quot;Unable to convert hexastring or base64 [%s] to byte array for resource %s&quot;,</b>
&nbsp;                                    value, resourcePath);
&nbsp;                        }
&nbsp;                    }
<b class="nc">&nbsp;                } else if (currentType == Type.BOOLEAN) {</b>
<b class="nc">&nbsp;                    return  new byte[] {(byte)((boolean)value ? 1 : 0)};</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            case OBJLNK:
<b class="nc">&nbsp;                if (currentType == Type.STRING) {</b>
<b class="nc">&nbsp;                    return ObjectLink.fromPath(value.toString());</b>
&nbsp;                }
&nbsp;            default:
&nbsp;        }
<b class="nc">&nbsp;        throw new CodecException(&quot;Invalid value type for resource %s, expected %s, got %s&quot;, resourcePath, expectedType,</b>
&nbsp;                currentType);
&nbsp;    }
&nbsp; }
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
