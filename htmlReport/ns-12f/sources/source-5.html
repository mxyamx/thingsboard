<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > DeviceConnectivityUtil</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.dao.util</a>
</div>

<h1>Coverage Summary for Class: DeviceConnectivityUtil (org.thingsboard.server.dao.util)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">DeviceConnectivityUtil</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/13)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/61)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/133)
  </span>
</td>
</tr>
  <tr>
    <td class="name">DeviceConnectivityUtil$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/14)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/61)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/134)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.dao.util;
&nbsp;
&nbsp;import org.springframework.core.io.ByteArrayResource;
&nbsp;import org.springframework.core.io.Resource;
&nbsp;import org.thingsboard.common.util.JacksonUtil;
&nbsp;import org.thingsboard.server.common.data.StringUtils;
&nbsp;import org.thingsboard.server.common.data.device.credentials.BasicMqttCredentials;
&nbsp;import org.thingsboard.server.common.data.security.DeviceCredentials;
&nbsp;import org.thingsboard.server.dao.device.DeviceConnectivityInfo;
&nbsp;
&nbsp;import java.net.Inet6Address;
&nbsp;import java.net.InetAddress;
&nbsp;import java.net.URI;
&nbsp;import java.net.URISyntaxException;
&nbsp;import java.net.UnknownHostException;
&nbsp;import java.nio.charset.StandardCharsets;
&nbsp;import java.util.regex.Pattern;
&nbsp;
<b class="nc">&nbsp;public class DeviceConnectivityUtil {</b>
&nbsp;
&nbsp;    public static final String HTTP = &quot;http&quot;;
&nbsp;    public static final String HTTPS = &quot;https&quot;;
&nbsp;    public static final String MQTT = &quot;mqtt&quot;;
&nbsp;    public static final String DOCKER = &quot;docker&quot;;
&nbsp;    public static final String MQTTS = &quot;mqtts&quot;;
&nbsp;    public static final String COAP = &quot;coap&quot;;
&nbsp;    public static final String COAPS = &quot;coaps&quot;;
&nbsp;    public static final String CA_ROOT_CERT_PEM = &quot;ca-root.pem&quot;;
&nbsp;    public static final String DOCKER_COMPOSE_YML = &quot;docker-compose.yml&quot;;
&nbsp;    public static final String CHECK_DOCUMENTATION = &quot;Check documentation&quot;;
&nbsp;    public static final String JSON_EXAMPLE_PAYLOAD = &quot;\&quot;{temperature:25}\&quot;&quot;;
&nbsp;    public static final String DOCKER_RUN = &quot;docker run --rm -it &quot;;
&nbsp;    public static final String HOST_DOCKER_INTERNAL = &quot;host.docker.internal&quot;;
&nbsp;    public static final String ADD_DOCKER_INTERNAL_HOST = &quot;--add-host=&quot; + HOST_DOCKER_INTERNAL + &quot;:host-gateway &quot;;
&nbsp;    public static final String MQTT_IMAGE = &quot;thingsboard/mosquitto-clients &quot;;
&nbsp;    public static final String COAP_IMAGE = &quot;thingsboard/coap-clients &quot;;
<b class="nc">&nbsp;    private final static Pattern VALID_URL_PATTERN = Pattern.compile(&quot;^(https?)://[-a-zA-Z0-9+&amp;@#/%?=~_|!:,.;]*[-a-zA-Z0-9+&amp;@#/%=~_|]&quot;);</b>
&nbsp;
&nbsp;    public static String getHttpPublishCommand(String protocol, String host, String port, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        return String.format(&quot;curl -v -X POST %s://%s%s/api/v1/%s/telemetry --header Content-Type:application/json --data &quot; + JSON_EXAMPLE_PAYLOAD,</b>
<b class="nc">&nbsp;                protocol, host, port, deviceCredentials.getCredentialsId());</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getMqttPublishCommand(String protocol, String host, String port, String deviceTelemetryTopic, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        StringBuilder command = new StringBuilder(&quot;mosquitto_pub -d -q 1&quot;);</b>
<b class="nc">&nbsp;        if (MQTTS.equals(protocol)) {</b>
<b class="nc">&nbsp;            command.append(&quot; --cafile &quot;).append(CA_ROOT_CERT_PEM);</b>
&nbsp;        }
<b class="nc">&nbsp;        command.append(&quot; -h &quot;).append(host).append(StringUtils.isBlank(port) ? &quot;&quot; : &quot; -p &quot; + port);</b>
<b class="nc">&nbsp;        command.append(&quot; -t &quot;).append(deviceTelemetryTopic);</b>
&nbsp;
<b class="nc">&nbsp;        switch (deviceCredentials.getCredentialsType()) {</b>
&nbsp;            case ACCESS_TOKEN:
<b class="nc">&nbsp;                command.append(&quot; -u \&quot;&quot;).append(deviceCredentials.getCredentialsId()).append(&quot;\&quot;&quot;);</b>
&nbsp;                break;
&nbsp;            case MQTT_BASIC:
<b class="nc">&nbsp;                BasicMqttCredentials credentials = JacksonUtil.fromString(deviceCredentials.getCredentialsValue(),</b>
&nbsp;                        BasicMqttCredentials.class);
<b class="nc">&nbsp;                if (credentials != null) {</b>
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getClientId())) {</b>
<b class="nc">&nbsp;                        command.append(&quot; -i \&quot;&quot;).append(credentials.getClientId()).append(&quot;\&quot;&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getUserName())) {</b>
<b class="nc">&nbsp;                        command.append(&quot; -u \&quot;&quot;).append(credentials.getUserName()).append(&quot;\&quot;&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getPassword())) {</b>
<b class="nc">&nbsp;                        command.append(&quot; -P \&quot;&quot;).append(credentials.getPassword()).append(&quot;\&quot;&quot;);</b>
&nbsp;                    }
&nbsp;                } else {
<b class="nc">&nbsp;                    return null;</b>
&nbsp;                }
&nbsp;                break;
&nbsp;            default:
<b class="nc">&nbsp;                return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        command.append(&quot; -m &quot; + JSON_EXAMPLE_PAYLOAD);</b>
<b class="nc">&nbsp;        return command.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static Resource getGatewayDockerComposeFile(String host, String gatewayImageVersion, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        StringBuilder dockerComposeBuilder = new StringBuilder();</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;version: &#39;3.4&#39;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;services:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;  # ThingsBoard IoT Gateway Service Configuration\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;  tb-gateway:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    image: thingsboard/tb-gateway:&quot;).append(gatewayImageVersion).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    container_name: tb-gateway\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    restart: always\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    # Ports bindings - required by some connectors\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    ports:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;        - \&quot;5000:5000\&quot; # Comment if you don&#39;t use REST connector and change if you use another port\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;        # Uncomment and modify the following ports based on connector usage:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;#        - \&quot;1052:1052\&quot; # BACnet connector\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;#        - \&quot;5026:5026\&quot; # Modbus TCP connector (Modbus Slave)\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;#        - \&quot;50000:50000/tcp\&quot; # Socket connector with type TCP\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;#        - \&quot;50000:50000/udp\&quot; # Socket connector with type UDP\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    # Necessary mapping for Linux\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    extra_hosts:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - \&quot;host.docker.internal:host-gateway\&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    # Environment variables\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    environment:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - TB_GW_HOST=&quot;).append(isLocalhost(host) ? HOST_DOCKER_INTERNAL : host).append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - TB_GW_PORT=1883\n&quot;);</b>
<b class="nc">&nbsp;        switch (deviceCredentials.getCredentialsType()) {</b>
&nbsp;            case ACCESS_TOKEN:
<b class="nc">&nbsp;                dockerComposeBuilder.append(&quot;      - TB_GW_SECURITY_TYPE=accessToken\n&quot;);</b>
<b class="nc">&nbsp;                dockerComposeBuilder.append(&quot;      - TB_GW_ACCESS_TOKEN=&quot;).append(deviceCredentials.getCredentialsId()).append(&quot;\n&quot;);</b>
&nbsp;                break;
&nbsp;            case MQTT_BASIC:
<b class="nc">&nbsp;                dockerComposeBuilder.append(&quot;      - TB_GW_SECURITY_TYPE=usernamePassword\n&quot;);</b>
<b class="nc">&nbsp;                BasicMqttCredentials credentials = JacksonUtil.fromString(deviceCredentials.getCredentialsValue(),</b>
&nbsp;                        BasicMqttCredentials.class);
<b class="nc">&nbsp;                if (credentials != null) {</b>
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getClientId())) {</b>
<b class="nc">&nbsp;                        dockerComposeBuilder.append(&quot;      - TB_GW_CLIENT_ID=&quot;).append(credentials.getClientId()).append(&quot;\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getUserName())) {</b>
<b class="nc">&nbsp;                        dockerComposeBuilder.append(&quot;      - TB_GW_USERNAME=&quot;).append(credentials.getUserName()).append(&quot;\n&quot;);</b>
&nbsp;                    }
<b class="nc">&nbsp;                    if (StringUtils.isNotEmpty(credentials.getPassword())) {</b>
<b class="nc">&nbsp;                        dockerComposeBuilder.append(&quot;      - TB_GW_PASSWORD=&quot;).append(credentials.getPassword()).append(&quot;\n&quot;);</b>
&nbsp;                    }
&nbsp;                }
&nbsp;                break;
&nbsp;        }
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    # Volumes bind\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    volumes:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - tb-gw-config:/thingsboard_gateway/config\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - tb-gw-logs:/thingsboard_gateway/logs\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;      - tb-gw-extensions:/thingsboard_gateway/extensions\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;# Volumes declaration for configurations, extensions and configuration\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;volumes:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;  tb-gw-config:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    name: tb-gw-config\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;  tb-gw-logs:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    name: tb-gw-logs\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;  tb-gw-extensions:\n&quot;);</b>
<b class="nc">&nbsp;        dockerComposeBuilder.append(&quot;    name: tb-gw-extensions\n&quot;);</b>
&nbsp;
<b class="nc">&nbsp;        return new ByteArrayResource(dockerComposeBuilder.toString().getBytes(StandardCharsets.UTF_8));</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getDockerMqttPublishCommand(String protocol, String baseUrl, String host, String port, String deviceTelemetryTopic, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        String mqttCommand = getMqttPublishCommand(protocol, host, port, deviceTelemetryTopic, deviceCredentials);</b>
&nbsp;
<b class="nc">&nbsp;        if (mqttCommand == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        StringBuilder mqttDockerCommand = new StringBuilder();</b>
<b class="nc">&nbsp;        mqttDockerCommand.append(DOCKER_RUN).append(isLocalhost(host) ? ADD_DOCKER_INTERNAL_HOST : &quot;&quot;).append(MQTT_IMAGE);</b>
&nbsp;
<b class="nc">&nbsp;        if (isLocalhost(host)) {</b>
<b class="nc">&nbsp;            mqttCommand = mqttCommand.replace(host, HOST_DOCKER_INTERNAL);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (MQTTS.equals(protocol)) {</b>
<b class="nc">&nbsp;            mqttDockerCommand.append(&quot;/bin/sh -c \&quot;&quot;)</b>
<b class="nc">&nbsp;                    .append(getCurlPemCertCommand(baseUrl, protocol))</b>
<b class="nc">&nbsp;                    .append(&quot; &amp;&amp; &quot;)</b>
<b class="nc">&nbsp;                    .append(mqttCommand)</b>
<b class="nc">&nbsp;                    .append(&quot;\&quot;&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            mqttDockerCommand.append(mqttCommand);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return mqttDockerCommand.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getCurlPemCertCommand(String baseUrl, String protocol) {
<b class="nc">&nbsp;        return getCurlPemCertCommand(baseUrl, protocol, CA_ROOT_CERT_PEM);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getCurlPemCertCommand(String baseUrl, String protocol, String caCertFilePath) {
<b class="nc">&nbsp;        return String.format(&quot;curl -f -S -o %s %s/api/device-connectivity/%s/certificate/download&quot;, caCertFilePath, baseUrl, protocol);</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getCoapPublishCommand(String protocol, String host, String port, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        switch (deviceCredentials.getCredentialsType()) {</b>
&nbsp;            case ACCESS_TOKEN:
<b class="nc">&nbsp;                String client = COAPS.equals(protocol) ? &quot;coap-client-openssl&quot; : &quot;coap-client&quot;;</b>
<b class="nc">&nbsp;                String certificate = COAPS.equals(protocol) ? &quot; -R &quot; + CA_ROOT_CERT_PEM : &quot;&quot;;</b>
<b class="nc">&nbsp;                return String.format(&quot;%s -v 6 -m POST%s -t \&quot;application/json\&quot; -e %s %s://%s%s/api/v1/%s/telemetry&quot;,</b>
<b class="nc">&nbsp;                        client, certificate, JSON_EXAMPLE_PAYLOAD, protocol, host, port, deviceCredentials.getCredentialsId());</b>
&nbsp;            default:
<b class="nc">&nbsp;                return null;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static String getDockerCoapPublishCommand(String protocol, String baseUrl, String host, String port, DeviceCredentials deviceCredentials) {
<b class="nc">&nbsp;        String coapCommand = getCoapPublishCommand(protocol, host, port, deviceCredentials);</b>
&nbsp;
<b class="nc">&nbsp;        if (coapCommand == null) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        StringBuilder coapDockerCommand = new StringBuilder();</b>
<b class="nc">&nbsp;        coapDockerCommand.append(DOCKER_RUN).append(isLocalhost(host) ? ADD_DOCKER_INTERNAL_HOST : &quot;&quot;).append(COAP_IMAGE);</b>
&nbsp;
<b class="nc">&nbsp;        if (isLocalhost(host)) {</b>
<b class="nc">&nbsp;            coapCommand = coapCommand.replace(host, HOST_DOCKER_INTERNAL);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (COAPS.equals(protocol)) {</b>
<b class="nc">&nbsp;            coapDockerCommand.append(&quot;/bin/sh -c \&quot;&quot;)</b>
<b class="nc">&nbsp;                    .append(getCurlPemCertCommand(baseUrl, protocol))</b>
<b class="nc">&nbsp;                    .append(&quot; &amp;&amp; &quot;)</b>
<b class="nc">&nbsp;                    .append(coapCommand)</b>
<b class="nc">&nbsp;                    .append(&quot;\&quot;&quot;);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            coapDockerCommand.append(coapCommand);</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        return coapDockerCommand.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getHost(String baseUrl, DeviceConnectivityInfo properties, String protocol) throws URISyntaxException {
<b class="nc">&nbsp;        String initialHost = StringUtils.isBlank(properties.getHost()) ? baseUrl : properties.getHost();</b>
&nbsp;        InetAddress inetAddress;
<b class="nc">&nbsp;        String host = null;</b>
<b class="nc">&nbsp;        if (VALID_URL_PATTERN.matcher(initialHost).matches()) {</b>
<b class="nc">&nbsp;            host = new URI(initialHost).getHost();</b>
&nbsp;        }
<b class="nc">&nbsp;        if (host == null) {</b>
<b class="nc">&nbsp;            host = initialHost;</b>
&nbsp;        }
&nbsp;        try {
<b class="nc">&nbsp;            host = host.replaceAll(&quot;^https?://&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;            inetAddress = InetAddress.getByName(host);</b>
&nbsp;        } catch (UnknownHostException e) {
<b class="nc">&nbsp;            return host;</b>
&nbsp;        }
<b class="nc">&nbsp;        if (inetAddress instanceof Inet6Address) {</b>
<b class="nc">&nbsp;            host = host.replaceAll(&quot;[\\[\\]]&quot;, &quot;&quot;);</b>
<b class="nc">&nbsp;            if (!MQTT.equals(protocol) &amp;&amp; !MQTTS.equals(protocol)) {</b>
<b class="nc">&nbsp;                host = &quot;[&quot; + host + &quot;]&quot;;</b>
&nbsp;            }
&nbsp;        }
<b class="nc">&nbsp;        return host;</b>
&nbsp;    }
&nbsp;
&nbsp;    public static String getPort(DeviceConnectivityInfo properties) {
<b class="nc">&nbsp;        return StringUtils.isBlank(properties.getPort()) ? &quot;&quot; : properties.getPort();</b>
&nbsp;    }
&nbsp;
&nbsp;    public static boolean isLocalhost(String host) {
&nbsp;        try {
<b class="nc">&nbsp;            InetAddress inetAddress = InetAddress.getByName(host);</b>
<b class="nc">&nbsp;            return inetAddress.isLoopbackAddress();</b>
&nbsp;        } catch (UnknownHostException e) {
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
