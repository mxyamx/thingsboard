<!--

    Copyright © 2016-2026 The Thingsboard Authors

    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at

        http://www.apache.org/licenses/LICENSE-2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.

-->



<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > SqlQueryContext</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.thingsboard.server.dao.sql.query</a>
</div>

<h1>Coverage Summary for Class: SqlQueryContext (org.thingsboard.server.dao.sql.query)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">SqlQueryContext</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/22)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
</tr>
  <tr>
    <td class="name">SqlQueryContext$Parameter</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/23)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/38)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/**
&nbsp; * Copyright © 2016-2026 The Thingsboard Authors
&nbsp; *
&nbsp; * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
&nbsp; * you may not use this file except in compliance with the License.
&nbsp; * You may obtain a copy of the License at
&nbsp; *
&nbsp; *     http://www.apache.org/licenses/LICENSE-2.0
&nbsp; *
&nbsp; * Unless required by applicable law or agreed to in writing, software
&nbsp; * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
&nbsp; * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
&nbsp; * See the License for the specific language governing permissions and
&nbsp; * limitations under the License.
&nbsp; */
&nbsp;package org.thingsboard.server.dao.sql.query;
&nbsp;
&nbsp;import lombok.extern.slf4j.Slf4j;
&nbsp;import org.hibernate.type.descriptor.jdbc.UUIDJdbcType;
&nbsp;import org.springframework.jdbc.core.namedparam.SqlParameterSource;
&nbsp;import org.thingsboard.server.common.data.EntityType;
&nbsp;import org.thingsboard.server.common.data.id.CustomerId;
&nbsp;import org.thingsboard.server.common.data.id.TenantId;
&nbsp;import org.thingsboard.server.common.data.permission.QueryContext;
&nbsp;
&nbsp;import java.sql.Types;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.UUID;
&nbsp;
<b class="nc">&nbsp;@Slf4j</b>
&nbsp;public class SqlQueryContext implements SqlParameterSource {
<b class="nc">&nbsp;    private static final UUIDJdbcType UUID_TYPE = UUIDJdbcType.INSTANCE;</b>
&nbsp;
&nbsp;    private final QueryContext securityCtx;
&nbsp;    private final StringBuilder query;
&nbsp;    private final Map&lt;String, Parameter&gt; params;
&nbsp;
<b class="nc">&nbsp;    public SqlQueryContext(QueryContext securityCtx) {</b>
<b class="nc">&nbsp;        this.securityCtx = securityCtx;</b>
<b class="nc">&nbsp;        query = new StringBuilder();</b>
<b class="nc">&nbsp;        params = new HashMap&lt;&gt;();</b>
&nbsp;    }
&nbsp;
&nbsp;    void addParameter(String name, Object value, int type, String typeName) {
<b class="nc">&nbsp;        Parameter newParam = new Parameter(value, type, typeName);</b>
<b class="nc">&nbsp;        Parameter oldParam = params.put(name, newParam);</b>
<b class="nc">&nbsp;        if (oldParam != null &amp;&amp; oldParam.value != null &amp;&amp; !oldParam.value.equals(newParam.value)) {</b>
<b class="nc">&nbsp;            throw new RuntimeException(&quot;Parameter with name: &quot; + name + &quot; was already registered!&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        if (value == null) {</b>
<b class="nc">&nbsp;            log.warn(&quot;[{}][{}][{}] Trying to set null value&quot;, getTenantId(), getCustomerId(), name);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void append(String s) {
<b class="nc">&nbsp;        query.append(s);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public boolean hasValue(String paramName) {
<b class="nc">&nbsp;        return params.containsKey(paramName);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public Object getValue(String paramName) throws IllegalArgumentException {
<b class="nc">&nbsp;        return checkParameter(paramName).value;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public int getSqlType(String paramName) {
<b class="nc">&nbsp;        return checkParameter(paramName).type;</b>
&nbsp;    }
&nbsp;
&nbsp;    private Parameter checkParameter(String paramName) {
<b class="nc">&nbsp;        Parameter param = params.get(paramName);</b>
<b class="nc">&nbsp;        if (param == null) {</b>
<b class="nc">&nbsp;            throw new RuntimeException(&quot;Parameter with name: &quot; + paramName + &quot; is not set!&quot;);</b>
&nbsp;        }
<b class="nc">&nbsp;        return param;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String getTypeName(String paramName) {
<b class="nc">&nbsp;        return params.get(paramName).name;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public String[] getParameterNames() {
<b class="nc">&nbsp;        return params.keySet().toArray(new String[]{});</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addUuidParameter(String name, UUID value) {
<b class="nc">&nbsp;        addParameter(name, value, UUID_TYPE.getJdbcTypeCode(), UUID_TYPE.getFriendlyName());</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addStringParameter(String name, String value) {
<b class="nc">&nbsp;        addParameter(name, value, Types.VARCHAR, &quot;VARCHAR&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addDoubleParameter(String name, double value) {
<b class="nc">&nbsp;        addParameter(name, value, Types.DOUBLE, &quot;DOUBLE&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addLongParameter(String name, long value) {
<b class="nc">&nbsp;        addParameter(name, value, Types.BIGINT, &quot;BIGINT&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addStringListParameter(String name, List&lt;String&gt; value) {
<b class="nc">&nbsp;        addParameter(name, value, Types.VARCHAR, &quot;VARCHAR&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addBooleanParameter(String name, boolean value) {
<b class="nc">&nbsp;        addParameter(name, value, Types.BOOLEAN, &quot;BOOLEAN&quot;);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addUuidListParameter(String name, List&lt;UUID&gt; value) {
<b class="nc">&nbsp;        addParameter(name, value, UUID_TYPE.getJdbcTypeCode(), UUID_TYPE.getFriendlyName());</b>
&nbsp;    }
&nbsp;
&nbsp;    public String getQuery() {
<b class="nc">&nbsp;        return query.toString();</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    public static class Parameter {
&nbsp;        private final Object value;
&nbsp;        private final int type;
&nbsp;        private final String name;
&nbsp;
<b class="nc">&nbsp;        public Parameter(Object value, int type, String name) {</b>
<b class="nc">&nbsp;            this.value = value;</b>
<b class="nc">&nbsp;            this.type = type;</b>
<b class="nc">&nbsp;            this.name = name;</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public TenantId getTenantId() {
<b class="nc">&nbsp;        return securityCtx.getTenantId();</b>
&nbsp;    }
&nbsp;
&nbsp;    public CustomerId getCustomerId() {
<b class="nc">&nbsp;        return securityCtx.getCustomerId();</b>
&nbsp;    }
&nbsp;
&nbsp;    public EntityType getEntityType() {
<b class="nc">&nbsp;        return securityCtx.getEntityType();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean isIgnorePermissionCheck() {
<b class="nc">&nbsp;        return securityCtx.isIgnorePermissionCheck();</b>
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2026-02-07 20:03</div>
</div>
</body>
</html>
